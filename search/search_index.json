{"config":{"lang":["zh","en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Shortener \u6587\u6863","text":"<p>\u6b22\u8fce\u4f7f\u7528 Shortener - \u4e00\u4e2a\u4f7f\u7528 Rust \u7f16\u5199\u7684\u9ad8\u6027\u80fd URL \u77ed\u94fe\u63a5\u670d\u52a1\uff01</p>"},{"location":"#_1","title":"\ud83c\udfaf \u9879\u76ee\u7b80\u4ecb","text":"<p>Shortener \u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u77ed\u94fe\u63a5\u89e3\u51b3\u65b9\u6848\uff0c\u5305\u542b\uff1a</p> <ul> <li>\u670d\u52a1\u5668\u7aef: \u57fa\u4e8e Rust + Axum \u7684\u9ad8\u6027\u80fd RESTful API \u670d\u52a1</li> <li>\u524d\u7aef\u754c\u9762: \u57fa\u4e8e React + Semi Design \u7684\u73b0\u4ee3\u5316\u7ba1\u7406\u754c\u9762</li> <li>CLI \u5de5\u5177: \u529f\u80fd\u5b8c\u6574\u7684\u547d\u4ee4\u884c\u7ba1\u7406\u5de5\u5177</li> <li>\u591a\u6570\u636e\u5e93: \u652f\u6301 SQLite\u3001PostgreSQL \u548c MySQL</li> <li>\u7f13\u5b58\u652f\u6301: \u96c6\u6210 Redis/Valkey \u63d0\u5347\u6027\u80fd</li> <li>\u5730\u7406\u4f4d\u7f6e: \u4f7f\u7528 ip2region \u8ffd\u8e2a\u8bbf\u5ba2\u4fe1\u606f</li> </ul>"},{"location":"#_2","title":"\ud83d\ude80 \u5feb\u901f\u5f00\u59cb","text":""},{"location":"#_3","title":"\u4e00\u952e\u5b89\u88c5","text":"<pre><code>curl -sSL https://raw.githubusercontent.com/jetsung/shortener/main/scripts/install.sh | bash\n</code></pre>"},{"location":"#docker","title":"Docker \u90e8\u7f72","text":"<pre><code>git clone https://github.com/jetsung/shortener.git\ncd shortener\ndocker compose -f docker/docker-compose.yml up -d\n</code></pre>"},{"location":"#_4","title":"\u4ece\u6e90\u7801\u6784\u5efa","text":"<pre><code># \u514b\u9686\u4ed3\u5e93\ngit clone https://github.com/jetsung/shortener.git\ncd shortener\n\n# \u6784\u5efa\u670d\u52a1\u5668\ncargo build --release -p shortener-server\n\n# \u8fd0\u884c\u670d\u52a1\u5668\n./target/release/shortener-server\n</code></pre>"},{"location":"#_5","title":"\ud83d\udcda \u6587\u6863\u5bfc\u822a","text":""},{"location":"#_6","title":"\u5165\u95e8\u6307\u5357","text":"<ul> <li>\u5b89\u88c5\u6307\u5357 - \u8be6\u7ec6\u7684\u5b89\u88c5\u8bf4\u660e</li> <li>\u914d\u7f6e\u6307\u5357 - \u914d\u7f6e\u9009\u9879\u8bf4\u660e</li> <li>\u914d\u7f6e\u6587\u4ef6 - \u914d\u7f6e\u6587\u4ef6\u8be6\u89e3</li> </ul>"},{"location":"#_7","title":"\u7ec4\u4ef6\u6587\u6863","text":"<ul> <li>\u670d\u52a1\u5668\u6587\u6863 - API \u670d\u52a1\u5668\u4f7f\u7528\u8bf4\u660e</li> <li>\u524d\u7aef\u6587\u6863 - Web \u754c\u9762\u4f7f\u7528\u8bf4\u660e</li> <li>CLI \u6587\u6863 - \u547d\u4ee4\u884c\u5de5\u5177\u4f7f\u7528\u8bf4\u660e</li> </ul>"},{"location":"#_8","title":"\u90e8\u7f72\u6307\u5357","text":"<ul> <li>\u90e8\u7f72\u6982\u8ff0 - \u90e8\u7f72\u65b9\u5f0f\u603b\u89c8</li> <li>Docker \u540e\u7aef\u90e8\u7f72 - \u4f7f\u7528 Docker \u90e8\u7f72\u540e\u7aef\u670d\u52a1</li> <li>Docker \u524d\u7aef\u90e8\u7f72 - \u4f7f\u7528 Docker \u90e8\u7f72\u524d\u7aef\u5e94\u7528</li> <li>\u524d\u7aef\u90e8\u7f72\u6307\u5357 - \u524d\u7aef\u90e8\u7f72\u8be6\u7ec6\u8bf4\u660e</li> <li>\u751f\u4ea7\u90e8\u7f72 - \u751f\u4ea7\u73af\u5883\u90e8\u7f72</li> <li>DEB \u6253\u5305 - Debian \u5305\u5236\u4f5c</li> </ul>"},{"location":"#api","title":"API \u53c2\u8003","text":"<ul> <li>API \u6587\u6863 - RESTful API \u5b8c\u6574\u53c2\u8003</li> <li>\u6027\u80fd\u57fa\u51c6 - \u6027\u80fd\u6d4b\u8bd5\u7ed3\u679c</li> </ul>"},{"location":"#_9","title":"\u2728 \u4e3b\u8981\u7279\u6027","text":""},{"location":"#_10","title":"\u9ad8\u6027\u80fd","text":"<ul> <li>\u57fa\u4e8e Rust \u548c async/await \u6784\u5efa</li> <li>\u652f\u6301\u9ad8\u5e76\u53d1\u8bf7\u6c42\u5904\u7406</li> <li>\u5185\u7f6e\u7f13\u5b58\u673a\u5236</li> <li>\u4f18\u5316\u7684\u6570\u636e\u5e93\u67e5\u8be2</li> </ul>"},{"location":"#_11","title":"\u6613\u4e8e\u4f7f\u7528","text":"<ul> <li>\u7b80\u6d01\u7684 RESTful API</li> <li>\u76f4\u89c2\u7684 Web \u7ba1\u7406\u754c\u9762</li> <li>\u529f\u80fd\u5b8c\u6574\u7684 CLI \u5de5\u5177</li> <li>\u8be6\u7ec6\u7684\u6587\u6863\u548c\u793a\u4f8b</li> </ul>"},{"location":"#_12","title":"\u7075\u6d3b\u90e8\u7f72","text":"<ul> <li>\u652f\u6301\u591a\u79cd\u6570\u636e\u5e93</li> <li>Docker \u5bb9\u5668\u5316\u90e8\u7f72</li> <li>\u8de8\u5e73\u53f0\u652f\u6301</li> <li>\u6613\u4e8e\u6269\u5c55</li> </ul>"},{"location":"#_13","title":"\u5b89\u5168\u53ef\u9760","text":"<ul> <li>API \u5bc6\u94a5\u8ba4\u8bc1</li> <li>JWT \u4ee4\u724c\u652f\u6301</li> <li>\u7c7b\u578b\u5b89\u5168\u7684\u4ee3\u7801</li> <li>\u5168\u9762\u7684\u6d4b\u8bd5\u8986\u76d6</li> </ul>"},{"location":"#_14","title":"\ud83d\udee0\ufe0f \u6280\u672f\u6808","text":""},{"location":"#_15","title":"\u540e\u7aef","text":"<ul> <li>\u8bed\u8a00: Rust 1.90+</li> <li>Web \u6846\u67b6: Axum</li> <li>ORM: SeaORM</li> <li>\u6570\u636e\u5e93: SQLite / PostgreSQL / MySQL</li> <li>\u7f13\u5b58: Redis / Valkey</li> <li>\u8ba4\u8bc1: JWT</li> </ul>"},{"location":"#_16","title":"\u524d\u7aef","text":"<ul> <li>\u6846\u67b6: React 19</li> <li>\u8bed\u8a00: TypeScript 5</li> <li>UI \u5e93: Semi Design</li> <li>\u6784\u5efa\u5de5\u5177: Vite 7</li> <li>\u8def\u7531: React Router 7</li> </ul>"},{"location":"#cli","title":"CLI","text":"<ul> <li>\u8bed\u8a00: Rust</li> <li>CLI \u6846\u67b6: Clap</li> <li>HTTP \u5ba2\u6237\u7aef: Reqwest</li> </ul>"},{"location":"#_17","title":"\ud83d\udcd6 \u4f7f\u7528\u793a\u4f8b","text":""},{"location":"#_18","title":"\u521b\u5efa\u77ed\u94fe\u63a5","text":"<pre><code># \u4f7f\u7528 CLI\nshortener-cli create https://example.com\n\n# \u4f7f\u7528 API\ncurl -X POST http://localhost:8080/api/shortens \\\n  -H \"X-API-KEY: your-api-key\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"original_url\":\"https://example.com\"}'\n</code></pre>"},{"location":"#_19","title":"\u83b7\u53d6\u77ed\u94fe\u63a5","text":"<pre><code># \u4f7f\u7528 CLI\nshortener-cli get abc123\n\n# \u4f7f\u7528 API\ncurl http://localhost:8080/api/shortens/abc123 \\\n  -H \"X-API-KEY: your-api-key\"\n</code></pre>"},{"location":"#_20","title":"\u5217\u51fa\u6240\u6709\u77ed\u94fe\u63a5","text":"<pre><code># \u4f7f\u7528 CLI\nshortener-cli list --all\n\n# \u4f7f\u7528 API\ncurl \"http://localhost:8080/api/shortens?page=1&amp;page_size=10\" \\\n  -H \"X-API-KEY: your-api-key\"\n</code></pre>"},{"location":"#_21","title":"\ud83e\udd1d \u8d21\u732e","text":"<p>\u6b22\u8fce\u8d21\u732e\u4ee3\u7801\u3001\u62a5\u544a\u95ee\u9898\u6216\u63d0\u51fa\u5efa\u8bae\uff01</p> <ul> <li>GitHub \u4ed3\u5e93</li> <li>\u95ee\u9898\u8ffd\u8e2a</li> <li>\u8d21\u732e\u6307\u5357</li> </ul>"},{"location":"#_22","title":"\ud83d\udcc4 \u8bb8\u53ef\u8bc1","text":"<p>\u672c\u9879\u76ee\u91c7\u7528 Apache-2.0 \u8bb8\u53ef\u8bc1\u3002\u8be6\u89c1 LICENSE \u6587\u4ef6\u3002</p>"},{"location":"#_23","title":"\ud83d\udc64 \u4f5c\u8005","text":"<p>Jetsung Chan i@jetsung.com</p> <ul> <li>GitHub: @jetsung</li> <li>Website: jetsung.com</li> </ul> <p>\u4f7f\u7528 \u2764\ufe0f \u548c Rust \u6784\u5efa</p>"},{"location":"CONTRIBUTING/","title":"\u8d21\u732e\u6307\u5357","text":"<p>\u611f\u8c22\u4f60\u8003\u8651\u4e3a Shortener \u9879\u76ee\u505a\u51fa\u8d21\u732e\uff01</p>"},{"location":"CONTRIBUTING/#_2","title":"\u884c\u4e3a\u51c6\u5219","text":"<p>\u8bf7\u53cb\u5584\u548c\u5c0a\u91cd\u4ed6\u4eba\u3002\u6211\u4eec\u81f4\u529b\u4e8e\u4e3a\u6bcf\u4e2a\u4eba\u63d0\u4f9b\u4e00\u4e2a\u53cb\u597d\u3001\u5b89\u5168\u548c\u6b22\u8fce\u7684\u73af\u5883\u3002</p>"},{"location":"CONTRIBUTING/#_3","title":"\u5982\u4f55\u8d21\u732e","text":""},{"location":"CONTRIBUTING/#bug","title":"\u62a5\u544a Bug","text":"<p>\u5982\u679c\u4f60\u53d1\u73b0\u4e86 bug\uff0c\u8bf7\u5728 GitHub Issues \u521b\u5efa\u4e00\u4e2a\u95ee\u9898\uff0c\u5e76\u5305\u542b\uff1a</p> <ul> <li>\u6e05\u6670\u7684\u6807\u9898\u548c\u63cf\u8ff0</li> <li>\u91cd\u73b0\u6b65\u9aa4</li> <li>\u9884\u671f\u884c\u4e3a\u548c\u5b9e\u9645\u884c\u4e3a</li> <li>\u4f60\u7684\u73af\u5883\u4fe1\u606f\uff08\u64cd\u4f5c\u7cfb\u7edf\u3001Rust \u7248\u672c\u7b49\uff09</li> <li>\u76f8\u5173\u7684\u65e5\u5fd7\u6216\u9519\u8bef\u4fe1\u606f</li> </ul>"},{"location":"CONTRIBUTING/#_4","title":"\u5efa\u8bae\u65b0\u529f\u80fd","text":"<p>\u6211\u4eec\u6b22\u8fce\u65b0\u529f\u80fd\u5efa\u8bae\uff01\u8bf7\u5728 GitHub Discussions \u4e2d\u8ba8\u8bba\u4f60\u7684\u60f3\u6cd5\u3002</p>"},{"location":"CONTRIBUTING/#_5","title":"\u63d0\u4ea4\u4ee3\u7801","text":"<ol> <li>Fork \u4ed3\u5e93</li> </ol> <p>\u70b9\u51fb GitHub \u9875\u9762\u53f3\u4e0a\u89d2\u7684 \"Fork\" \u6309\u94ae\u3002</p> <ol> <li>\u514b\u9686\u4f60\u7684 Fork</li> </ol> <pre><code>git clone https://github.com/\u4f60\u7684\u7528\u6237\u540d/shortener.git\ncd shortener\n</code></pre> <ol> <li>\u521b\u5efa\u5206\u652f</li> </ol> <pre><code>git checkout -b feature/\u4f60\u7684\u529f\u80fd\u540d\u79f0\n</code></pre> <ol> <li> <p>\u8fdb\u884c\u66f4\u6539</p> </li> <li> <p>\u9075\u5faa\u73b0\u6709\u7684\u4ee3\u7801\u98ce\u683c</p> </li> <li>\u4e3a\u65b0\u529f\u80fd\u7f16\u5199\u6d4b\u8bd5</li> <li>\u66f4\u65b0\u76f8\u5173\u6587\u6863</li> <li> <p>\u786e\u4fdd\u6240\u6709\u6d4b\u8bd5\u901a\u8fc7</p> </li> <li> <p>\u63d0\u4ea4\u66f4\u6539</p> </li> </ol> <pre><code>git add .\ngit commit -m \"\u6dfb\u52a0\uff1a\u4f60\u7684\u529f\u80fd\u63cf\u8ff0\"\n</code></pre> <p>\u63d0\u4ea4\u4fe1\u606f\u683c\u5f0f\uff1a    - <code>\u6dfb\u52a0\uff1a</code> - \u65b0\u529f\u80fd    - <code>\u4fee\u590d\uff1a</code> - Bug \u4fee\u590d    - <code>\u6587\u6863\uff1a</code> - \u6587\u6863\u66f4\u65b0    - <code>\u91cd\u6784\uff1a</code> - \u4ee3\u7801\u91cd\u6784    - <code>\u6d4b\u8bd5\uff1a</code> - \u6d4b\u8bd5\u76f8\u5173</p> <ol> <li>\u63a8\u9001\u5230\u4f60\u7684 Fork</li> </ol> <pre><code>git push origin feature/\u4f60\u7684\u529f\u80fd\u540d\u79f0\n</code></pre> <ol> <li>\u521b\u5efa Pull Request</li> </ol> <p>\u5728 GitHub \u4e0a\u6253\u5f00\u4e00\u4e2a Pull Request\uff0c\u63cf\u8ff0\u4f60\u7684\u66f4\u6539\u3002</p>"},{"location":"CONTRIBUTING/#_6","title":"\u5f00\u53d1\u8bbe\u7f6e","text":""},{"location":"CONTRIBUTING/#_7","title":"\u524d\u63d0\u6761\u4ef6","text":"<ul> <li>Rust 1.90 \u6216\u66f4\u9ad8\u7248\u672c</li> <li>Cargo\uff08\u968f Rust \u4e00\u8d77\u5b89\u88c5\uff09</li> <li>Git</li> </ul>"},{"location":"CONTRIBUTING/#_8","title":"\u8bbe\u7f6e\u5f00\u53d1\u73af\u5883","text":"<pre><code># \u514b\u9686\u4ed3\u5e93\ngit clone https://github.com/jetsung/shortener.git\ncd shortener\n\n# \u6784\u5efa\u9879\u76ee\ncargo build\n\n# \u8fd0\u884c\u6d4b\u8bd5\ncargo test\n\n# \u8fd0\u884c\u670d\u52a1\u5668\ncargo run -p shortener-server\n</code></pre>"},{"location":"CONTRIBUTING/#_9","title":"\u5f00\u53d1\u5de5\u5177","text":"<p>\u5b89\u88c5\u63a8\u8350\u7684\u5f00\u53d1\u5de5\u5177\uff1a</p> <pre><code># \u4ee3\u7801\u683c\u5f0f\u5316\u548c\u68c0\u67e5\ncargo install cargo-watch\ncargo install cargo-audit\n\n# \u6216\u4f7f\u7528 just\njust install-tools\n</code></pre>"},{"location":"CONTRIBUTING/#_10","title":"\u4ee3\u7801\u98ce\u683c","text":"<ul> <li>\u4f7f\u7528 <code>cargo fmt</code> \u683c\u5f0f\u5316\u4ee3\u7801</li> <li>\u4f7f\u7528 <code>cargo clippy</code> \u68c0\u67e5\u4ee3\u7801</li> <li>\u9075\u5faa Rust \u547d\u540d\u7ea6\u5b9a</li> <li>\u4e3a\u516c\u5171 API \u7f16\u5199\u6587\u6863\u6ce8\u91ca</li> </ul>"},{"location":"CONTRIBUTING/#_11","title":"\u8fd0\u884c\u6d4b\u8bd5","text":"<pre><code># \u8fd0\u884c\u6240\u6709\u6d4b\u8bd5\ncargo test\n\n# \u8fd0\u884c\u7279\u5b9a\u5305\u7684\u6d4b\u8bd5\ncargo test -p shortener-server\n\n# \u8fd0\u884c\u6d4b\u8bd5\u5e76\u663e\u793a\u8f93\u51fa\ncargo test -- --nocapture\n\n# \u8fd0\u884c\u57fa\u51c6\u6d4b\u8bd5\ncargo bench\n</code></pre>"},{"location":"CONTRIBUTING/#_12","title":"\u4ee3\u7801\u68c0\u67e5","text":"<p>\u5728\u63d0\u4ea4\u524d\u8fd0\u884c\uff1a</p> <pre><code># \u683c\u5f0f\u5316\u4ee3\u7801\ncargo fmt\n\n# \u68c0\u67e5\u4ee3\u7801\ncargo clippy -- -D warnings\n\n# \u8fd0\u884c\u6d4b\u8bd5\ncargo test\n\n# \u6216\u4f7f\u7528 just\njust check\n</code></pre>"},{"location":"CONTRIBUTING/#_13","title":"\u6587\u6863","text":""},{"location":"CONTRIBUTING/#_14","title":"\u66f4\u65b0\u6587\u6863","text":"<p>\u5982\u679c\u4f60\u7684\u66f4\u6539\u5f71\u54cd\u7528\u6237\u53ef\u89c1\u7684\u884c\u4e3a\uff0c\u8bf7\u66f4\u65b0\u76f8\u5173\u6587\u6863\uff1a</p> <ul> <li><code>README.md</code> - \u9879\u76ee\u6982\u8ff0</li> <li><code>docs/</code> - \u8be6\u7ec6\u6587\u6863</li> <li>\u4ee3\u7801\u6ce8\u91ca - \u5185\u8054\u6587\u6863</li> </ul>"},{"location":"CONTRIBUTING/#_15","title":"\u6784\u5efa\u6587\u6863","text":"<pre><code># \u6784\u5efa Rust \u6587\u6863\ncargo doc --open\n\n# \u6784\u5efa MkDocs \u6587\u6863\nmake docs-build\n\n# \u6216\u4f7f\u7528 just\njust docs-build\n</code></pre>"},{"location":"CONTRIBUTING/#pull-request","title":"Pull Request \u6307\u5357","text":""},{"location":"CONTRIBUTING/#pr","title":"\u597d\u7684 PR \u5e94\u8be5\uff1a","text":"<ul> <li>\u89e3\u51b3\u4e00\u4e2a\u660e\u786e\u7684\u95ee\u9898\u6216\u6dfb\u52a0\u4e00\u4e2a\u660e\u786e\u7684\u529f\u80fd</li> <li>\u5305\u542b\u6d4b\u8bd5</li> <li>\u66f4\u65b0\u76f8\u5173\u6587\u6863</li> <li>\u901a\u8fc7\u6240\u6709 CI \u68c0\u67e5</li> <li>\u6709\u6e05\u6670\u7684\u63d0\u4ea4\u4fe1\u606f</li> <li>\u4fdd\u6301\u8f83\u5c0f\u7684\u66f4\u6539\u8303\u56f4</li> </ul>"},{"location":"CONTRIBUTING/#pr_1","title":"PR \u6d41\u7a0b","text":"<ol> <li>\u786e\u4fdd\u4f60\u7684\u5206\u652f\u662f\u6700\u65b0\u7684</li> <li>\u6240\u6709\u6d4b\u8bd5\u901a\u8fc7</li> <li>\u4ee3\u7801\u5df2\u683c\u5f0f\u5316\u548c\u68c0\u67e5</li> <li>\u6587\u6863\u5df2\u66f4\u65b0</li> <li>\u63d0\u4ea4 PR \u5e76\u7b49\u5f85\u5ba1\u67e5</li> <li>\u6839\u636e\u53cd\u9988\u8fdb\u884c\u4fee\u6539</li> <li>PR \u88ab\u5408\u5e76</li> </ol>"},{"location":"CONTRIBUTING/#_16","title":"\u53d1\u5e03\u6d41\u7a0b","text":"<p>\u53d1\u5e03\u7531\u7ef4\u62a4\u8005\u5904\u7406\uff1a</p> <ol> <li>\u66f4\u65b0\u7248\u672c\u53f7</li> <li>\u521b\u5efa Git \u6807\u7b7e</li> <li>\u6784\u5efa\u53d1\u5e03\u4e8c\u8fdb\u5236\u6587\u4ef6</li> <li>\u53d1\u5e03\u5230 GitHub Releases</li> </ol>"},{"location":"CONTRIBUTING/#_17","title":"\u83b7\u53d6\u5e2e\u52a9","text":"<p>\u5982\u679c\u4f60\u9700\u8981\u5e2e\u52a9\uff1a</p> <ul> <li>\ud83d\udcd6 \u9605\u8bfb \u6587\u6863</li> <li>\ud83d\udcac \u5728 Discussions \u63d0\u95ee</li> <li>\ud83d\udc1b \u5728 Issues \u62a5\u544a\u95ee\u9898</li> <li>\ud83d\udce7 \u8054\u7cfb\u7ef4\u62a4\u8005\uff1ai@jetsung.com</li> </ul>"},{"location":"CONTRIBUTING/#_18","title":"\u8bb8\u53ef\u8bc1","text":"<p>\u901a\u8fc7\u8d21\u732e\uff0c\u4f60\u540c\u610f\u4f60\u7684\u8d21\u732e\u5c06\u5728 Apache-2.0 \u8bb8\u53ef\u8bc1\u4e0b\u6388\u6743\u3002</p>"},{"location":"CONTRIBUTING/#_19","title":"\u81f4\u8c22","text":"<p>\u611f\u8c22\u6240\u6709\u8d21\u732e\u8005\uff01\u4f60\u7684\u8d21\u732e\u4f7f\u8fd9\u4e2a\u9879\u76ee\u53d8\u5f97\u66f4\u597d\u3002</p> <p>\u4f5c\u8005: Jetsung Chan i@jetsung.com</p>"},{"location":"PROJECT_README/","title":"Shortener","text":"<p>\u4f7f\u7528 Rust \u7f16\u5199\u7684\u9ad8\u6027\u80fd URL \u77ed\u94fe\u63a5\u670d\u52a1\uff0c\u63d0\u4f9b\u5b8c\u6574\u7684 Web \u670d\u52a1\u5668\u3001\u524d\u7aef\u754c\u9762\u548c\u547d\u4ee4\u884c\u7ba1\u7406\u5de5\u5177\u3002</p>"},{"location":"PROJECT_README/#_1","title":"\u2728 \u7279\u6027","text":"<ul> <li>\ud83d\ude80 \u9ad8\u6027\u80fd: \u57fa\u4e8e Rust \u548c async/await\uff0c\u5b9e\u73b0\u6700\u5927\u541e\u5410\u91cf</li> <li>\ud83d\udcbe \u591a\u6570\u636e\u5e93: \u652f\u6301 SQLite\u3001PostgreSQL \u548c MySQL</li> <li>\u26a1 \u7f13\u5b58\u52a0\u901f: \u96c6\u6210 Redis/Valkey \u63d0\u5347\u6027\u80fd</li> <li>\ud83c\udf0d \u5730\u7406\u4f4d\u7f6e: \u4f7f\u7528 ip2region \u8ffd\u8e2a\u8bbf\u5ba2\u5730\u7406\u4fe1\u606f</li> <li>\ud83d\udd12 \u5b89\u5168\u8ba4\u8bc1: API \u5bc6\u94a5\u548c JWT \u4ee4\u724c\u53cc\u91cd\u652f\u6301</li> <li>\ud83d\udcca \u8bbf\u95ee\u5206\u6790: \u5168\u9762\u7684\u8bbf\u95ee\u5386\u53f2\u8ffd\u8e2a</li> <li>\ud83c\udfa8 \u73b0\u4ee3\u524d\u7aef: \u57fa\u4e8e React + Semi Design \u7684\u7ba1\u7406\u754c\u9762</li> <li>\ud83d\udcbb CLI \u5de5\u5177: \u6613\u7528\u7684\u547d\u4ee4\u884c\u7ba1\u7406\u5de5\u5177</li> <li>\ud83d\udc33 \u5bb9\u5668\u5316: Docker \u548c Docker Compose \u652f\u6301</li> <li>\ud83d\udce6 \u8de8\u5e73\u53f0: \u652f\u6301 Linux\u3001macOS \u548c Windows</li> </ul>"},{"location":"PROJECT_README/#_2","title":"\ud83d\udce6 \u9879\u76ee\u7ec4\u6210","text":"<p>\u672c\u9879\u76ee\u91c7\u7528 monorepo \u7ed3\u6784\uff0c\u5305\u542b\u4ee5\u4e0b\u5b50\u9879\u76ee\uff1a</p> \u9879\u76ee \u8bf4\u660e \u6280\u672f\u6808 shortener-server RESTful API \u670d\u52a1\u5668 Rust + Axum + SeaORM shortener-frontend Web \u7ba1\u7406\u754c\u9762 React + TypeScript + Semi Design shortener-cli \u547d\u4ee4\u884c\u7ba1\u7406\u5de5\u5177 Rust + Clap shortener-common \u5171\u4eab\u7c7b\u578b\u548c\u5de5\u5177 Rust"},{"location":"PROJECT_README/#_3","title":"\ud83d\ude80 \u5feb\u901f\u5f00\u59cb","text":""},{"location":"PROJECT_README/#_4","title":"\u4e00\u952e\u5b89\u88c5\uff08\u63a8\u8350\uff09","text":"<pre><code>curl -sSL https://raw.githubusercontent.com/jetsung/shortener/main/scripts/install.sh | bash\n</code></pre>"},{"location":"PROJECT_README/#docker","title":"\u4f7f\u7528 Docker","text":"<pre><code># \u514b\u9686\u4ed3\u5e93\ngit clone https://github.com/jetsung/shortener.git\ncd shortener\n\n# \u542f\u52a8\u670d\u52a1\ndocker compose -f docker/docker-compose.yml up -d\n</code></pre> <p>\u8bbf\u95ee <code>http://localhost:8080</code> \u5f00\u59cb\u4f7f\u7528\u3002</p>"},{"location":"PROJECT_README/#_5","title":"\u4ece\u6e90\u7801\u6784\u5efa","text":"<pre><code># \u514b\u9686\u4ed3\u5e93\ngit clone https://github.com/jetsung/shortener.git\ncd shortener\n\n# \u6784\u5efa\u5e76\u8fd0\u884c\u670d\u52a1\u5668\ncargo run --release -p shortener-server\n\n# \u5728\u53e6\u4e00\u4e2a\u7ec8\u7aef\uff0c\u521d\u59cb\u5316 CLI\ncargo run -p shortener-cli -- init\n\n# \u521b\u5efa\u77ed\u94fe\u63a5\ncargo run -p shortener-cli -- create https://example.com\n</code></pre>"},{"location":"PROJECT_README/#_6","title":"\ud83d\udcda \u6587\u6863","text":"<ul> <li>\ud83d\udcd6 \u5b8c\u6574\u6587\u6863 - \u5728\u7ebf\u6587\u6863\u7ad9\u70b9</li> <li>\ud83d\ude80 \u5feb\u901f\u5f00\u59cb - \u5b89\u88c5\u548c\u914d\u7f6e\u6307\u5357</li> <li>\ud83d\udda5\ufe0f \u670d\u52a1\u5668\u6587\u6863 - API \u670d\u52a1\u5668\u4f7f\u7528\u8bf4\u660e</li> <li>\ud83c\udfa8 \u524d\u7aef\u6587\u6863 - Web \u754c\u9762\u4f7f\u7528\u8bf4\u660e</li> <li>\ud83d\udcbb CLI \u6587\u6863 - \u547d\u4ee4\u884c\u5de5\u5177\u4f7f\u7528\u8bf4\u660e</li> <li>\ud83d\udc33 \u90e8\u7f72\u6307\u5357 - \u751f\u4ea7\u73af\u5883\u90e8\u7f72</li> <li>\ud83d\udd0c API \u53c2\u8003 - RESTful API \u6587\u6863</li> </ul>"},{"location":"PROJECT_README/#_7","title":"\u672c\u5730\u67e5\u770b\u6587\u6863","text":"<pre><code># \u5b89\u88c5\u4f9d\u8d56\npip install -r requirements.txt\n\n# \u542f\u52a8\u6587\u6863\u670d\u52a1\u5668\nmkdocs serve\n\n# \u8bbf\u95ee http://127.0.0.1:8000\n</code></pre>"},{"location":"PROJECT_README/#_8","title":"\ud83d\udee0\ufe0f \u5f00\u53d1","text":""},{"location":"PROJECT_README/#_9","title":"\u73af\u5883\u8981\u6c42","text":"<ul> <li>Rust 1.90+</li> <li>Node.js 18+ (\u524d\u7aef\u5f00\u53d1)</li> <li>pnpm 8+ (\u524d\u7aef\u5f00\u53d1)</li> </ul>"},{"location":"PROJECT_README/#_10","title":"\u5f00\u53d1\u670d\u52a1\u5668","text":"<pre><code># \u540e\u7aef\u5f00\u53d1\ncargo watch -x 'run -p shortener-server'\n\n# \u524d\u7aef\u5f00\u53d1\ncd shortener-frontend\npnpm dev\n</code></pre>"},{"location":"PROJECT_README/#_11","title":"\u4ee3\u7801\u8d28\u91cf","text":"<pre><code># \u683c\u5f0f\u5316\ncargo fmt\n\n# \u4ee3\u7801\u68c0\u67e5\ncargo clippy -- -D warnings\n\n# \u8fd0\u884c\u6d4b\u8bd5\ncargo test\n\n# \u524d\u7aef\u6d4b\u8bd5\ncd shortener-frontend\npnpm test\n</code></pre>"},{"location":"PROJECT_README/#_12","title":"\ud83e\udd1d \u8d21\u732e","text":"<p>\u6b22\u8fce\u8d21\u732e\uff01\u8bf7\u67e5\u770b \u8d21\u732e\u6307\u5357 \u4e86\u89e3\u8be6\u60c5\u3002</p>"},{"location":"PROJECT_README/#_13","title":"\ud83d\udcc4 \u8bb8\u53ef\u8bc1","text":"<p>\u672c\u9879\u76ee\u91c7\u7528 Apache-2.0 \u8bb8\u53ef\u8bc1 - \u8be6\u89c1 LICENSE \u6587\u4ef6\u3002</p>"},{"location":"PROJECT_README/#_14","title":"\ud83d\udc64 \u4f5c\u8005","text":"<p>Jetsung Chan i@jetsung.com</p> <ul> <li>GitHub: @jetsung</li> <li>Website: jetsung.com</li> </ul>"},{"location":"PROJECT_README/#_15","title":"\ud83d\ude4f \u81f4\u8c22","text":"<ul> <li>Axum - Web \u6846\u67b6</li> <li>SeaORM - ORM \u6846\u67b6</li> <li>Semi Design - UI \u7ec4\u4ef6\u5e93</li> <li>Clap - CLI \u6846\u67b6</li> </ul> <p>\u4f7f\u7528 \u2764\ufe0f \u548c Rust \u6784\u5efa</p>"},{"location":"QUICK_REFERENCE/","title":"\u5feb\u901f\u53c2\u8003","text":"<p>Shortener \u9879\u76ee\u7684\u5e38\u7528\u547d\u4ee4\u5feb\u901f\u53c2\u8003\u3002</p>"},{"location":"QUICK_REFERENCE/#_2","title":"\ud83d\udce6 \u5b89\u88c5","text":"<pre><code># \u4ece\u6e90\u7801\u6784\u5efa\ncargo build --release\n\n# \u5b89\u88c5 CLI\ncargo install --path shortener-cli\n\n# Docker\ndocker compose up -d\n</code></pre>"},{"location":"QUICK_REFERENCE/#_3","title":"\ud83d\ude80 \u8fd0\u884c","text":"<pre><code># \u670d\u52a1\u5668\ncargo run -p shortener-server\n\n# CLI\nshortener-cli --help\n</code></pre>"},{"location":"QUICK_REFERENCE/#_4","title":"\ud83d\udcda \u6587\u6863","text":"<pre><code># \u67e5\u770b\u6587\u6863\nmake docs              # \u6216 just docs\n\n# \u6784\u5efa\u6587\u6863\nmake docs-build        # \u6216 just docs-build\n\n# \u90e8\u7f72\u6587\u6863\njust docs-deploy\n</code></pre>"},{"location":"QUICK_REFERENCE/#_5","title":"\ud83d\udd28 \u5f00\u53d1","text":"<pre><code># \u683c\u5f0f\u5316\u4ee3\u7801\ncargo fmt\n\n# \u4ee3\u7801\u68c0\u67e5\ncargo clippy\n\n# \u8fd0\u884c\u6d4b\u8bd5\ncargo test\n\n# \u76d1\u89c6\u66f4\u6539\ncargo watch -x 'run -p shortener-server'\n</code></pre>"},{"location":"QUICK_REFERENCE/#docker","title":"\ud83d\udc33 Docker","text":"<pre><code># \u6784\u5efa\u955c\u50cf\nmake build             # \u6216 just docker-build\n\n# \u8fd0\u884c\uff08\u751f\u4ea7\uff09\nmake run               # \u6216 just docker-run\n\n# \u8fd0\u884c\uff08\u5f00\u53d1\uff09\nmake run-dev           # \u6216 just docker-run-dev\n\n# \u67e5\u770b\u65e5\u5fd7\nmake logs              # \u6216 just docker-logs\n\n# \u505c\u6b62\nmake stop              # \u6216 just docker-stop\n</code></pre>"},{"location":"QUICK_REFERENCE/#_6","title":"\ud83e\uddea \u6d4b\u8bd5","text":"<pre><code># \u6240\u6709\u6d4b\u8bd5\ncargo test\n\n# \u7279\u5b9a\u5305\ncargo test -p shortener-server\n\n# \u57fa\u51c6\u6d4b\u8bd5\ncargo bench\n</code></pre>"},{"location":"QUICK_REFERENCE/#cli","title":"\ud83d\udcd6 CLI \u547d\u4ee4","text":"<pre><code># \u521d\u59cb\u5316\nshortener-cli init\n\n# \u521b\u5efa\u77ed\u94fe\u63a5\nshortener-cli create https://example.com\n\n# \u83b7\u53d6\u8be6\u60c5\nshortener-cli get &lt;code&gt;\n\n# \u5217\u51fa\u6240\u6709\nshortener-cli list --all\n\n# \u66f4\u65b0\nshortener-cli update &lt;code&gt; --ourl &lt;new-url&gt;\n\n# \u5220\u9664\nshortener-cli delete &lt;code&gt;\n</code></pre>"},{"location":"QUICK_REFERENCE/#_7","title":"\ud83d\udd27 \u914d\u7f6e","text":"<pre><code># \u670d\u52a1\u5668\u914d\u7f6e\nvim config/config.toml\n\n# CLI \u914d\u7f6e\nshortener-cli init\nvim ~/.config/shortener/config.toml\n</code></pre>"},{"location":"QUICK_REFERENCE/#api","title":"\ud83c\udf10 API","text":"<pre><code># \u767b\u5f55\ncurl -X POST http://localhost:8080/api/account/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"username\":\"admin\",\"password\":\"password\"}'\n\n# \u521b\u5efa\u77ed\u94fe\u63a5\ncurl -X POST http://localhost:8080/api/shortens \\\n  -H \"X-API-KEY: your-api-key\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"original_url\":\"https://example.com\"}'\n\n# \u83b7\u53d6\u77ed\u94fe\u63a5\ncurl http://localhost:8080/api/shortens/&lt;code&gt; \\\n  -H \"X-API-KEY: your-api-key\"\n</code></pre>"},{"location":"QUICK_REFERENCE/#_8","title":"\ud83d\udd10 \u5b89\u5168","text":"<pre><code># \u751f\u6210 API \u5bc6\u94a5\nopenssl rand -base64 32\n\n# \u5b89\u5168\u5ba1\u8ba1\ncargo audit\n</code></pre>"},{"location":"QUICK_REFERENCE/#_9","title":"\ud83d\udcca \u6027\u80fd","text":"<pre><code># \u57fa\u51c6\u6d4b\u8bd5\ncargo bench\n\n# \u6027\u80fd\u5206\u6790\ncargo build --release\ntime ./target/release/shortener-server\n</code></pre>"},{"location":"QUICK_REFERENCE/#_10","title":"\ud83d\udee0\ufe0f \u90e8\u7f72","text":"<pre><code># Systemd\ncd deploy/systemd\nsudo ./install.sh\nsudo systemctl start shortener-server\n\n# Docker\ndocker-compose -f docker/docker-compose.yml up -d\n\n# \u4ea4\u53c9\u7f16\u8bd1\n./scripts/build-cross.sh --all\n</code></pre>"},{"location":"QUICK_REFERENCE/#_11","title":"\ud83d\udcdd \u8d21\u732e","text":"<pre><code># Fork \u5e76\u514b\u9686\ngit clone https://github.com/\u4f60\u7684\u7528\u6237\u540d/shortener.git\n\n# \u521b\u5efa\u5206\u652f\ngit checkout -b feature/your-feature\n\n# \u63d0\u4ea4\u66f4\u6539\ngit commit -m \"\u6dfb\u52a0\uff1ayour feature\"\n\n# \u63a8\u9001\ngit push origin feature/your-feature\n</code></pre>"},{"location":"QUICK_REFERENCE/#_12","title":"\ud83d\udd17 \u94fe\u63a5","text":"<ul> <li>\ud83d\udcd6 \u5b8c\u6574\u6587\u6863</li> <li>\ud83d\udc1b \u95ee\u9898\u8ffd\u8e2a</li> <li>\ud83d\udcac \u8ba8\u8bba\u533a</li> <li>\ud83d\udce7 \u90ae\u7bb1</li> </ul>"},{"location":"QUICK_REFERENCE/#_13","title":"\ud83d\udccb \u68c0\u67e5\u6e05\u5355","text":""},{"location":"QUICK_REFERENCE/#_14","title":"\u5f00\u53d1\u524d","text":"<ul> <li>[ ] \u5b89\u88c5 Rust 1.90+</li> <li>[ ] \u514b\u9686\u4ed3\u5e93</li> <li>[ ] \u5b89\u88c5\u5f00\u53d1\u5de5\u5177</li> <li>[ ] \u9605\u8bfb\u8d21\u732e\u6307\u5357</li> </ul>"},{"location":"QUICK_REFERENCE/#_15","title":"\u63d0\u4ea4\u524d","text":"<ul> <li>[ ] \u8fd0\u884c <code>cargo fmt</code></li> <li>[ ] \u8fd0\u884c <code>cargo clippy</code></li> <li>[ ] \u8fd0\u884c <code>cargo test</code></li> <li>[ ] \u66f4\u65b0\u6587\u6863</li> <li>[ ] \u7f16\u5199\u63d0\u4ea4\u4fe1\u606f</li> </ul>"},{"location":"QUICK_REFERENCE/#_16","title":"\u90e8\u7f72\u524d","text":"<ul> <li>[ ] \u8fd0\u884c\u6240\u6709\u6d4b\u8bd5</li> <li>[ ] \u66f4\u65b0\u7248\u672c\u53f7</li> <li>[ ] \u6784\u5efa\u53d1\u5e03\u7248\u672c</li> <li>[ ] \u6d4b\u8bd5\u90e8\u7f72</li> </ul> <p>\u63d0\u793a: \u4f7f\u7528 <code>just --list</code> \u6216 <code>make help</code> \u67e5\u770b\u6240\u6709\u53ef\u7528\u547d\u4ee4\u3002</p>"},{"location":"cli/","title":"CLI \u5de5\u5177\u6587\u6863","text":"<p>Shortener CLI \u662f\u4e00\u4e2a\u529f\u80fd\u5b8c\u6574\u7684\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u7528\u4e8e\u7ba1\u7406\u77ed\u94fe\u63a5\u670d\u52a1\u3002</p>"},{"location":"cli/#_1","title":"\ud83d\udcda \u6587\u6863\u5217\u8868","text":"<ul> <li>CLI \u5b8c\u6574\u6587\u6863 - \u8be6\u7ec6\u7684\u4f7f\u7528\u8bf4\u660e\u548c\u793a\u4f8b</li> <li>\u547d\u4ee4\u53c2\u8003 - \u6240\u6709\u547d\u4ee4\u7684\u53c2\u8003\u6587\u6863</li> </ul>"},{"location":"cli/#_2","title":"\ud83d\ude80 \u5feb\u901f\u5f00\u59cb","text":""},{"location":"cli/#_3","title":"\u5b89\u88c5","text":"<pre><code># \u4ece Git \u4ed3\u5e93\u5b89\u88c5\ncargo install --git https://github.com/jetsung/shortener.git shortener-cli\n\n# \u4ece\u6e90\u7801\u5b89\u88c5\ngit clone https://github.com/jetsung/shortener.git\ncd shortener\ncargo install --path shortener-cli\n</code></pre>"},{"location":"cli/#_4","title":"\u521d\u59cb\u5316\u914d\u7f6e","text":"<pre><code>shortener-cli init\n</code></pre>"},{"location":"cli/#_5","title":"\u57fa\u672c\u4f7f\u7528","text":"<pre><code># \u521b\u5efa\u77ed\u94fe\u63a5\nshortener-cli create https://example.com\n\n# \u83b7\u53d6\u77ed\u94fe\u63a5\u8be6\u60c5\nshortener-cli get abc123\n\n# \u5217\u51fa\u6240\u6709\u77ed\u94fe\u63a5\nshortener-cli list --all\n\n# \u66f4\u65b0\u77ed\u94fe\u63a5\nshortener-cli update abc123 --desc \"\u65b0\u7684\u63cf\u8ff0\"\n\n# \u5220\u9664\u77ed\u94fe\u63a5\nshortener-cli delete abc123\n</code></pre>"},{"location":"cli/#_6","title":"\ud83d\udcd6 \u8be6\u7ec6\u6587\u6863","text":"<p>\u67e5\u770b CLI \u5b8c\u6574\u6587\u6863 \u4e86\u89e3\u66f4\u591a\u529f\u80fd\u548c\u4f7f\u7528\u65b9\u6cd5\u3002</p>"},{"location":"cli/#_7","title":"\ud83d\udd27 \u914d\u7f6e","text":"<p>CLI \u652f\u6301\u591a\u79cd\u914d\u7f6e\u65b9\u5f0f\uff1a</p> <ol> <li>\u914d\u7f6e\u6587\u4ef6: <code>~/.config/shortener/config.toml</code></li> <li>\u73af\u5883\u53d8\u91cf: <code>SHORTENER_URL</code> \u548c <code>SHORTENER_KEY</code></li> <li>\u547d\u4ee4\u884c\u53c2\u6570: <code>--url</code> \u548c <code>--key</code></li> </ol> <p>\u4f18\u5148\u7ea7\uff1a\u547d\u4ee4\u884c\u53c2\u6570 &gt; \u73af\u5883\u53d8\u91cf &gt; \u914d\u7f6e\u6587\u4ef6</p>"},{"location":"cli/#_8","title":"\ud83d\udca1 \u63d0\u793a","text":"<ul> <li>\u4f7f\u7528 <code>--help</code> \u67e5\u770b\u4efb\u4f55\u547d\u4ee4\u7684\u5e2e\u52a9\u4fe1\u606f</li> <li>\u4f7f\u7528 <code>--all</code> \u53c2\u6570\u81ea\u52a8\u7ffb\u9875\u83b7\u53d6\u6240\u6709\u7ed3\u679c</li> <li>\u4f7f\u7528 <code>-f</code> \u53c2\u6570\u6307\u5b9a\u8f93\u51fa\u683c\u5f0f\uff08table/compact/list\uff09</li> </ul>"},{"location":"cli/CLI/","title":"Shortener CLI","text":"<p>\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u7528\u4e8e\u7ba1\u7406\u77ed\u7f51\u5740\u670d\u52a1\u3002</p>"},{"location":"cli/CLI/#_1","title":"\u5b89\u88c5","text":""},{"location":"cli/CLI/#git","title":"\u4ece Git \u4ed3\u5e93\u5b89\u88c5","text":"<pre><code>cargo install --git https://github.com/jetsung/shortener.git shortener-cli\n</code></pre>"},{"location":"cli/CLI/#_2","title":"\u4ece\u6e90\u7801\u5b89\u88c5","text":"<pre><code>git clone https://github.com/jetsung/shortener.git\ncd shortener\ncargo install --path shortener-cli\n</code></pre>"},{"location":"cli/CLI/#_3","title":"\u914d\u7f6e","text":""},{"location":"cli/CLI/#_4","title":"\u521d\u59cb\u5316\u914d\u7f6e","text":"<pre><code>shortener-cli init\n</code></pre> <p>\u8fd9\u5c06\u521b\u5efa\u914d\u7f6e\u6587\u4ef6 <code>~/.config/shortener/config.toml</code>\uff1a</p> <pre><code>[server]\nurl = \"http://localhost:8080\"\napi_key = \"your-api-key\"\n</code></pre>"},{"location":"cli/CLI/#_5","title":"\u4f7f\u7528\u73af\u5883\u53d8\u91cf","text":"<pre><code>export SHORTENER_URL=\"http://localhost:8080\"\nexport SHORTENER_KEY=\"your-api-key\"\n</code></pre>"},{"location":"cli/CLI/#_6","title":"\u547d\u4ee4\u884c\u53c2\u6570","text":"<pre><code>shortener-cli --url http://localhost:8080 --key your-api-key &lt;command&gt;\n</code></pre>"},{"location":"cli/CLI/#_7","title":"\u547d\u4ee4","text":""},{"location":"cli/CLI/#_8","title":"\u57fa\u672c\u547d\u4ee4","text":""},{"location":"cli/CLI/#_9","title":"\u663e\u793a\u5e2e\u52a9","text":"<pre><code>shortener-cli --help\nshortener-cli &lt;command&gt; --help\n</code></pre>"},{"location":"cli/CLI/#_10","title":"\u663e\u793a\u7248\u672c","text":"<pre><code>shortener-cli --version\n</code></pre>"},{"location":"cli/CLI/#_11","title":"\u663e\u793a\u73af\u5883\u4fe1\u606f","text":"<pre><code>shortener-cli env\n</code></pre>"},{"location":"cli/CLI/#_12","title":"\u77ed\u94fe\u63a5\u7ba1\u7406","text":""},{"location":"cli/CLI/#_13","title":"\u521b\u5efa\u77ed\u94fe\u63a5","text":"<pre><code># \u521b\u5efa\u77ed\u94fe\u63a5\uff08\u81ea\u52a8\u751f\u6210\u4ee3\u7801\uff09\nshortener-cli create https://example.com\n\n# \u4f7f\u7528\u81ea\u5b9a\u4e49\u4ee3\u7801\nshortener-cli create https://example.com --code mylink\n\n# \u6dfb\u52a0\u63cf\u8ff0\nshortener-cli create https://example.com --code mylink --desc \"\u6211\u7684\u94fe\u63a5\"\n</code></pre>"},{"location":"cli/CLI/#_14","title":"\u83b7\u53d6\u77ed\u94fe\u63a5\u8be6\u60c5","text":"<pre><code># \u901a\u8fc7\u77ed\u7801\u83b7\u53d6\u8be6\u60c5\nshortener-cli get mylink\n</code></pre>"},{"location":"cli/CLI/#_15","title":"\u67e5\u627e\u77ed\u94fe\u63a5","text":"<pre><code># \u901a\u8fc7\u539f\u59cb URL \u67e5\u627e\u77ed\u94fe\u63a5\nshortener-cli find --original_url https://example.com\n\n# \u67e5\u627e\u6240\u6709\u5339\u914d\u7684\u77ed\u94fe\u63a5\uff08\u81ea\u52a8\u7ffb\u9875\uff09\nshortener-cli find --original_url https://example.com --all\n\n# \u7b80\u5199\u5f62\u5f0f\nshortener-cli find -r https://example.com\nshortener-cli find -r https://example.com -a\n</code></pre>"},{"location":"cli/CLI/#_16","title":"\u5217\u51fa\u77ed\u94fe\u63a5","text":"<pre><code># \u5217\u51fa\u7b2c\u4e00\u9875\uff08\u9ed8\u8ba4 10 \u6761\uff09\nshortener-cli list\n\n# \u5217\u51fa\u6240\u6709\u77ed\u94fe\u63a5\uff08\u81ea\u52a8\u7ffb\u9875\uff09\nshortener-cli list --all\n\n# \u5206\u9875\u5217\u51fa\nshortener-cli list --page 1 --psize 20\n\n# \u6392\u5e8f\nshortener-cli list --sort created_at --order desc\nshortener-cli list --sort updated_at --order asc\n\n# \u6309\u72b6\u6001\u8fc7\u6ee4\nshortener-cli list --status 0  # \u4ec5\u542f\u7528\u7684\nshortener-cli list --status 1  # \u4ec5\u7981\u7528\u7684\n\n# \u6309\u539f\u59cb URL \u8fc7\u6ee4\nshortener-cli list --original_url https://example.com\n\n# \u7ec4\u5408\u8fc7\u6ee4\nshortener-cli list --original_url https://example.com --status 0 --page 1 --psize 5\n\n# \u6307\u5b9a\u663e\u793a\u683c\u5f0f\nshortener-cli list -f table    # \u5b8c\u6574\u8868\u683c\uff08\u5305\u542b\u6240\u6709\u5217\uff09\nshortener-cli list -f compact  # \u7d27\u51d1\u8868\u683c\uff08\u9002\u5408\u7a84\u7ec8\u7aef\uff09\nshortener-cli list -f list     # \u5217\u8868\u683c\u5f0f\uff08\u9002\u5408\u5f88\u7a84\u7684\u7ec8\u7aef\uff09\n</code></pre>"},{"location":"cli/CLI/#_17","title":"\u66f4\u65b0\u77ed\u94fe\u63a5","text":"<pre><code># \u66f4\u65b0\u539f\u59cb URL\nshortener-cli update mylink --ourl https://newurl.com\n\n# \u66f4\u65b0\u63cf\u8ff0\nshortener-cli update mylink --desc \"\u65b0\u7684\u63cf\u8ff0\"\n\n# \u66f4\u65b0\u72b6\u6001\nshortener-cli update mylink --status 1  # \u7981\u7528\nshortener-cli update mylink --status 0  # \u542f\u7528\n\n# \u540c\u65f6\u66f4\u65b0\u591a\u4e2a\u5b57\u6bb5\nshortener-cli update mylink --ourl https://newurl.com --desc \"\u5df2\u66f4\u65b0\" --status 0\n</code></pre>"},{"location":"cli/CLI/#_18","title":"\u5220\u9664\u77ed\u94fe\u63a5","text":"<pre><code>shortener-cli delete mylink\n</code></pre>"},{"location":"cli/CLI/#_19","title":"\u53c2\u6570\u8bf4\u660e","text":""},{"location":"cli/CLI/#_20","title":"\u5168\u5c40\u53c2\u6570","text":"<ul> <li><code>-u, --url &lt;URL&gt;</code>: \u670d\u52a1\u5668 URL\uff08\u4e5f\u53ef\u901a\u8fc7 <code>SHORTENER_URL</code> \u73af\u5883\u53d8\u91cf\u8bbe\u7f6e\uff09</li> <li><code>-k, --key &lt;KEY&gt;</code>: API \u5bc6\u94a5\uff08\u4e5f\u53ef\u901a\u8fc7 <code>SHORTENER_KEY</code> \u73af\u5883\u53d8\u91cf\u8bbe\u7f6e\uff09</li> </ul>"},{"location":"cli/CLI/#create","title":"create \u547d\u4ee4","text":"<ul> <li><code>&lt;original_url&gt;</code>: \u8981\u7f29\u77ed\u7684\u539f\u59cb URL\uff08\u5fc5\u9700\uff09</li> <li><code>-c, --code &lt;CODE&gt;</code>: \u81ea\u5b9a\u4e49\u77ed\u7801\uff08\u53ef\u9009\uff09</li> <li><code>-d, --desc &lt;DESC&gt;</code>: \u63cf\u8ff0\uff08\u53ef\u9009\uff09</li> </ul>"},{"location":"cli/CLI/#get","title":"get \u547d\u4ee4","text":"<ul> <li><code>&lt;code&gt;</code>: \u8981\u83b7\u53d6\u7684\u77ed\u7801\uff08\u5fc5\u9700\uff09</li> </ul>"},{"location":"cli/CLI/#find","title":"find \u547d\u4ee4","text":"<ul> <li><code>-r, --original_url &lt;URL&gt;</code>: \u8981\u641c\u7d22\u7684\u539f\u59cb URL\uff08\u5fc5\u9700\uff09</li> <li><code>-a, --all</code>: \u663e\u793a\u6240\u6709\u5339\u914d\u7ed3\u679c\uff08\u81ea\u52a8\u7ffb\u9875\uff09</li> </ul>"},{"location":"cli/CLI/#list","title":"list \u547d\u4ee4","text":"<ul> <li><code>-a, --all</code>: \u83b7\u53d6\u6240\u6709\u77ed\u94fe\u63a5\uff08\u81ea\u52a8\u7ffb\u9875\uff09</li> <li><code>-p, --page &lt;NUM&gt;</code>: \u9875\u7801\uff08\u9ed8\u8ba4\uff1a1\uff09</li> <li><code>-z, --psize &lt;NUM&gt;</code>: \u6bcf\u9875\u5927\u5c0f\uff08\u9ed8\u8ba4\uff1a10\uff09</li> <li><code>-s, --sort &lt;FIELD&gt;</code>: \u6392\u5e8f\u5b57\u6bb5\uff08\u5982\uff1acreated_at, updated_at\uff09</li> <li><code>-o, --order &lt;ORDER&gt;</code>: \u6392\u5e8f\u65b9\u5411\uff08asc \u6216 desc\uff09</li> <li><code>-t, --status &lt;STATUS&gt;</code>: \u6309\u72b6\u6001\u8fc7\u6ee4\uff080=\u542f\u7528, 1=\u7981\u7528\uff09</li> <li><code>-r, --original_url &lt;URL&gt;</code>: \u6309\u539f\u59cb URL \u8fc7\u6ee4</li> <li><code>-f, --format &lt;FORMAT&gt;</code>: \u8f93\u51fa\u683c\u5f0f\uff08table, compact, list\uff09</li> </ul>"},{"location":"cli/CLI/#update","title":"update \u547d\u4ee4","text":"<ul> <li><code>&lt;code&gt;</code>: \u8981\u66f4\u65b0\u7684\u77ed\u7801\uff08\u5fc5\u9700\uff09</li> <li><code>-o, --ourl &lt;URL&gt;</code>: \u65b0\u7684\u539f\u59cb URL</li> <li><code>-d, --desc &lt;DESC&gt;</code>: \u65b0\u7684\u63cf\u8ff0</li> <li><code>-s, --status &lt;STATUS&gt;</code>: \u65b0\u7684\u72b6\u6001\uff080=\u542f\u7528, 1=\u7981\u7528\uff09</li> </ul>"},{"location":"cli/CLI/#delete","title":"delete \u547d\u4ee4","text":"<ul> <li><code>&lt;code&gt;</code>: \u8981\u5220\u9664\u7684\u77ed\u7801\uff08\u5fc5\u9700\uff09</li> </ul>"},{"location":"cli/CLI/#_21","title":"\u4f7f\u7528\u793a\u4f8b","text":""},{"location":"cli/CLI/#_22","title":"\u57fa\u672c\u5de5\u4f5c\u6d41","text":"<pre><code># 1. \u521d\u59cb\u5316\u914d\u7f6e\nshortener-cli init\n\n# 2. \u521b\u5efa\u77ed\u94fe\u63a5\nshortener-cli create https://github.com/jetsung/shortener --code github --desc \"\u9879\u76ee\u4ed3\u5e93\"\n\n# 3. \u67e5\u770b\u8be6\u60c5\nshortener-cli get github\n\n# 4. \u5217\u51fa\u6240\u6709\u94fe\u63a5\nshortener-cli list --all\n\n# 5. \u66f4\u65b0\u94fe\u63a5\nshortener-cli update github --desc \"Shortener \u9879\u76ee\u4ed3\u5e93\"\n\n# 6. \u67e5\u627e\u7279\u5b9a URL \u7684\u6240\u6709\u77ed\u94fe\u63a5\nshortener-cli find -r https://github.com/jetsung/shortener -a\n</code></pre>"},{"location":"cli/CLI/#_23","title":"\u9ad8\u7ea7\u7528\u6cd5","text":"<pre><code># \u6279\u91cf\u67e5\u770b\u6700\u8fd1\u521b\u5efa\u7684\u94fe\u63a5\nshortener-cli list --sort created_at --order desc --psize 20\n\n# \u67e5\u627e\u6240\u6709\u6307\u5411\u67d0\u4e2a\u57df\u540d\u7684\u94fe\u63a5\nshortener-cli list --original_url https://example.com --all\n\n# \u67e5\u770b\u6240\u6709\u7981\u7528\u7684\u94fe\u63a5\nshortener-cli list --status 1 --all\n\n# \u5206\u9875\u6d4f\u89c8\u5927\u91cf\u6570\u636e\nshortener-cli list --page 1 --psize 50\nshortener-cli list --page 2 --psize 50\n</code></pre>"},{"location":"cli/CLI/#_24","title":"\u811a\u672c\u5316\u4f7f\u7528","text":"<pre><code>#!/bin/bash\n\n# \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\nexport SHORTENER_URL=\"https://your-server.com\"\nexport SHORTENER_KEY=\"your-api-key\"\n\n# \u6279\u91cf\u521b\u5efa\u77ed\u94fe\u63a5\nurls=(\n    \"https://github.com/jetsung/shortener\"\n    \"https://docs.rs/shortener\"\n    \"https://crates.io/crates/shortener\"\n)\n\nfor url in \"${urls[@]}\"; do\n    echo \"Creating short URL for: $url\"\n    shortener-cli create \"$url\"\ndone\n\n# \u5217\u51fa\u6240\u6709\u521b\u5efa\u7684\u94fe\u63a5\necho \"All short URLs:\"\nshortener-cli list --all\n</code></pre>"},{"location":"cli/CLI/#_25","title":"\u8f93\u51fa\u683c\u5f0f","text":""},{"location":"cli/CLI/#_26","title":"\u8be6\u60c5\u663e\u793a","text":"<pre><code>ID:           1\nCode:         github\nShort URL:    http://localhost:8080/github\nOriginal URL: https://github.com/jetsung/shortener\nDescription:  \u9879\u76ee\u4ed3\u5e93\nStatus:       0 (Enabled)\nCreated:      2024-01-15 10:30\nUpdated:      2024-01-15 10:30\n</code></pre>"},{"location":"cli/CLI/#_27","title":"\u8868\u683c\u663e\u793a\u683c\u5f0f","text":""},{"location":"cli/CLI/#-f-table","title":"\u5b8c\u6574\u8868\u683c (-f table)","text":"<p>\u663e\u793a\u6240\u6709\u4fe1\u606f\uff0cOriginal URL \u4f7f\u7528\u667a\u80fd\u622a\u65ad\uff08\u57df\u540d.../\u6587\u4ef6\u540d\uff09\uff1a</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 ID \u2502 Code   \u2502 Short URL                           \u2502 Original URL                        \u2502 Description \u2502 Status  \u2502 Created         \u2502\n\u251c\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 1  \u2502 github \u2502 http://localhost:8080/github        \u2502 https://github.com/.../project.git  \u2502 \u9879\u76ee\u4ed3\u5e93    \u2502 Enabled \u2502 2024-01-15 10:30\u2502\n\u2502 2  \u2502 script \u2502 http://localhost:8080/script        \u2502 https://example.com/.../install.sh  \u2502 \u5b89\u88c5\u811a\u672c    \u2502 Enabled \u2502 2024-01-15 10:31\u2502\n\u2514\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"cli/CLI/#-f-compact","title":"\u7d27\u51d1\u8868\u683c (-f compact)","text":"<p>\u663e\u793a\u5b8c\u6574\u7684 Original URL\uff0c\u4e0d\u663e\u793a Description\uff1a</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Code   \u2502 Short URL                           \u2502 Original URL                         \u2502 Status  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 github \u2502 http://localhost:8080/github        \u2502 https://github.com/jetsung/shortener \u2502 Enabled \u2502\n\u2502 docs   \u2502 http://localhost:8080/docs          \u2502 https://docs.rs/shortener            \u2502 Enabled \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"cli/CLI/#-f-list","title":"\u5217\u8868\u683c\u5f0f (-f list)","text":"<p>\u9002\u5408\u7a84\u7ec8\u7aef\uff08&lt; 100 \u5217\uff09\uff0c\u6bcf\u4e2a\u6761\u76ee\u5360\u591a\u884c\uff1a</p> <pre><code>1. github (Enabled)\n   Short URL: http://localhost:8080/github\n   Original:  https://github.com/jetsung/shortener\n   Desc:      \u9879\u76ee\u4ed3\u5e93\n   Created:   2024-01-15 10:30\n\n2. docs (Enabled)\n   Short URL: http://localhost:8080/docs\n   Original:  https://docs.rs/shortener\n   Desc:      \u6587\u6863\n   Created:   2024-01-15 10:31\n</code></pre>"},{"location":"cli/CLI/#_28","title":"\u9ed8\u8ba4\u683c\u5f0f","text":"<p>\u5982\u679c\u4e0d\u6307\u5b9a <code>--format</code> \u53c2\u6570\uff0cCLI \u9ed8\u8ba4\u4f7f\u7528\u5217\u8868\u683c\u5f0f\uff0c\u8fd9\u662f\u6700\u6613\u8bfb\u548c\u4fe1\u606f\u6700\u5b8c\u6574\u7684\u683c\u5f0f\u3002</p>"},{"location":"cli/CLI/#_29","title":"\u9519\u8bef\u5904\u7406","text":"<p>CLI \u5de5\u5177\u4f1a\u8fd4\u56de\u9002\u5f53\u7684\u9000\u51fa\u7801\uff1a</p> <ul> <li><code>0</code>: \u6210\u529f</li> <li><code>1</code>: \u9519\u8bef\uff08\u7f51\u7edc\u9519\u8bef\u3001API \u9519\u8bef\u3001\u914d\u7f6e\u9519\u8bef\u7b49\uff09</li> </ul> <p>\u5e38\u89c1\u9519\u8bef\uff1a</p> <pre><code># \u914d\u7f6e\u672a\u627e\u5230\nError: Configuration not found. Run 'shortener-cli init' first.\n\n# API \u5bc6\u94a5\u65e0\u6548\nError: Unauthorized: Invalid API key\n\n# \u77ed\u7801\u4e0d\u5b58\u5728\nError: Not found: Short URL 'nonexistent' not found\n\n# \u7f51\u7edc\u8fde\u63a5\u5931\u8d25\nError: HTTP request failed: connection refused\n</code></pre>"},{"location":"cli/CLI/#_30","title":"\u914d\u7f6e\u6587\u4ef6","text":"<p>\u914d\u7f6e\u6587\u4ef6\u4f4d\u7f6e\uff1a<code>~/.config/shortener/config.toml</code></p> <pre><code>[server]\nurl = \"http://localhost:8080\"\napi_key = \"your-secret-api-key\"\n</code></pre>"},{"location":"cli/CLI/#_31","title":"\u73af\u5883\u53d8\u91cf","text":"<ul> <li><code>SHORTENER_URL</code>: \u670d\u52a1\u5668 URL</li> <li><code>SHORTENER_KEY</code>: API \u5bc6\u94a5</li> </ul> <p>\u4f18\u5148\u7ea7\uff1a\u547d\u4ee4\u884c\u53c2\u6570 &gt; \u73af\u5883\u53d8\u91cf &gt; \u914d\u7f6e\u6587\u4ef6</p>"},{"location":"cli/CLI/#_32","title":"\u5f00\u53d1","text":""},{"location":"cli/CLI/#_33","title":"\u6784\u5efa","text":"<pre><code>cargo build --release -p shortener-cli\n</code></pre>"},{"location":"cli/CLI/#_34","title":"\u6d4b\u8bd5","text":"<pre><code>cargo test -p shortener-cli\n</code></pre>"},{"location":"cli/CLI/#_35","title":"\u5b89\u88c5\u5f00\u53d1\u7248\u672c","text":"<pre><code>cargo install --path shortener-cli --force\n</code></pre>"},{"location":"cli/CLI/#_36","title":"\u6545\u969c\u6392\u9664","text":""},{"location":"cli/CLI/#_37","title":"\u5e38\u89c1\u95ee\u9898","text":"<ol> <li> <p>\u914d\u7f6e\u6587\u4ef6\u672a\u627e\u5230 <pre><code>shortener-cli init\n</code></pre></p> </li> <li> <p>\u8fde\u63a5\u88ab\u62d2\u7edd</p> </li> <li>\u68c0\u67e5\u670d\u52a1\u5668\u662f\u5426\u8fd0\u884c</li> <li> <p>\u68c0\u67e5 URL \u662f\u5426\u6b63\u786e</p> </li> <li> <p>API \u5bc6\u94a5\u65e0\u6548</p> </li> <li>\u68c0\u67e5 API \u5bc6\u94a5\u662f\u5426\u6b63\u786e</li> <li> <p>\u91cd\u65b0\u521d\u59cb\u5316\u914d\u7f6e</p> </li> <li> <p>\u6743\u9650\u9519\u8bef</p> </li> <li>\u68c0\u67e5 API \u5bc6\u94a5\u6743\u9650</li> <li>\u8054\u7cfb\u7ba1\u7406\u5458</li> </ol>"},{"location":"cli/CLI/#_38","title":"\u8c03\u8bd5","text":"<p>\u542f\u7528\u8be6\u7ec6\u65e5\u5fd7\uff1a</p> <pre><code>RUST_LOG=debug shortener-cli &lt;command&gt;\n</code></pre>"},{"location":"cli/CLI/#_39","title":"\u8bb8\u53ef\u8bc1","text":"<p>\u672c\u9879\u76ee\u91c7\u7528 Apache-2.0 \u8bb8\u53ef\u8bc1\u3002\u8be6\u89c1 LICENSE \u6587\u4ef6\u3002</p>"},{"location":"cli/USAGE/","title":"Shortener CLI \u4f7f\u7528\u6307\u5357","text":"<p>shortener-cli \u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u7528\u4e8e\u7ba1\u7406\u77ed\u7f51\u5740\u670d\u52a1\u3002</p>"},{"location":"cli/USAGE/#_1","title":"\u5b89\u88c5","text":"<pre><code>cd shortener-cli\ncargo build --release\nsudo cp target/release/shortener-cli /usr/local/bin/\n</code></pre>"},{"location":"cli/USAGE/#_2","title":"\u914d\u7f6e","text":""},{"location":"cli/USAGE/#_3","title":"\u521d\u59cb\u5316\u914d\u7f6e","text":"<pre><code>shortener-cli init -u http://localhost:8080 -k your-api-key\n</code></pre> <p>\u914d\u7f6e\u6587\u4ef6\u5c06\u4fdd\u5b58\u5728 <code>~/.config/shortener-cli/config.toml</code></p>"},{"location":"cli/USAGE/#_4","title":"\u73af\u5883\u53d8\u91cf","text":"<p>\u4e5f\u53ef\u4ee5\u4f7f\u7528\u73af\u5883\u53d8\u91cf\uff1a</p> <pre><code>export SHORTENER_URL=http://localhost:8080\nexport SHORTENER_KEY=your-api-key\n</code></pre>"},{"location":"cli/USAGE/#_5","title":"\u547d\u4ee4\u884c\u53c2\u6570","text":"<p>\u6216\u8005\u5728\u6bcf\u6b21\u547d\u4ee4\u4e2d\u6307\u5b9a\uff1a</p> <pre><code>shortener-cli --url http://localhost:8080 --key your-api-key &lt;command&gt;\n</code></pre>"},{"location":"cli/USAGE/#_6","title":"\u57fa\u672c\u547d\u4ee4","text":""},{"location":"cli/USAGE/#_7","title":"\u67e5\u770b\u5e2e\u52a9","text":"<pre><code>shortener-cli --help\nshortener-cli &lt;command&gt; --help\n</code></pre>"},{"location":"cli/USAGE/#_8","title":"\u67e5\u770b\u7248\u672c","text":"<pre><code>shortener-cli version\n</code></pre>"},{"location":"cli/USAGE/#_9","title":"\u67e5\u770b\u73af\u5883\u4fe1\u606f","text":"<pre><code>shortener-cli env\n</code></pre>"},{"location":"cli/USAGE/#_10","title":"\u77ed\u7f51\u5740\u7ba1\u7406","text":""},{"location":"cli/USAGE/#_11","title":"\u521b\u5efa\u77ed\u7f51\u5740","text":"<pre><code># \u81ea\u52a8\u751f\u6210\u77ed\u7801\nshortener-cli create https://example.com\n\n# \u6307\u5b9a\u77ed\u7801\nshortener-cli create https://example.com -c mycode\n\n# \u6dfb\u52a0\u63cf\u8ff0\nshortener-cli create https://example.com -c mycode -d \"\u6211\u7684\u94fe\u63a5\"\n</code></pre>"},{"location":"cli/USAGE/#_12","title":"\u67e5\u770b\u77ed\u7f51\u5740","text":"<pre><code>shortener-cli get mycode\n</code></pre>"},{"location":"cli/USAGE/#_13","title":"\u5217\u8868\u67e5\u8be2","text":"<pre><code># \u67e5\u770b\u7b2c\u4e00\u9875\uff08\u9ed8\u8ba4 10 \u6761\uff09\nshortener-cli list\n\n# \u6307\u5b9a\u9875\u7801\u548c\u6bcf\u9875\u6570\u91cf\nshortener-cli list -p 2 -z 20\n\n# \u67e5\u770b\u6240\u6709\uff08\u81ea\u52a8\u7ffb\u9875\uff09\nshortener-cli list -a\n\n# \u6309\u72b6\u6001\u7b5b\u9009\nshortener-cli list -t 0  # 0=\u542f\u7528, 1=\u7981\u7528\n\n# \u6309\u539f\u59cb URL \u7b5b\u9009\nshortener-cli list -r \"example.com\"\n\n# \u6392\u5e8f\nshortener-cli list -s created_at -o desc\n</code></pre>"},{"location":"cli/USAGE/#_14","title":"\u8f93\u51fa\u683c\u5f0f","text":"<pre><code># \u8868\u683c\u683c\u5f0f\uff08\u5b8c\u6574\uff09\nshortener-cli list -f table\n\n# \u7d27\u51d1\u683c\u5f0f\nshortener-cli list -f compact\n\n# \u5217\u8868\u683c\u5f0f\uff08\u9ed8\u8ba4\uff09\nshortener-cli list -f list\n</code></pre>"},{"location":"cli/USAGE/#_15","title":"\u67e5\u627e\u77ed\u7f51\u5740","text":"<pre><code># \u6309\u539f\u59cb URL \u67e5\u627e\nshortener-cli find -r \"https://example.com\"\n\n# \u67e5\u627e\u6240\u6709\u5339\u914d\u9879\nshortener-cli find -r \"example.com\" -a\n</code></pre>"},{"location":"cli/USAGE/#_16","title":"\u66f4\u65b0\u77ed\u7f51\u5740","text":"<pre><code># \u66f4\u65b0\u539f\u59cb URL\nshortener-cli update mycode -o https://new-url.com\n\n# \u66f4\u65b0\u63cf\u8ff0\nshortener-cli update mycode -d \"\u65b0\u7684\u63cf\u8ff0\"\n\n# \u66f4\u65b0\u72b6\u6001\nshortener-cli update mycode -s 1  # \u7981\u7528\n\n# \u540c\u65f6\u66f4\u65b0\u591a\u4e2a\u5b57\u6bb5\nshortener-cli update mycode -o https://new-url.com -d \"\u65b0\u63cf\u8ff0\" -s 0\n</code></pre>"},{"location":"cli/USAGE/#_17","title":"\u5220\u9664\u77ed\u7f51\u5740","text":"<pre><code>shortener-cli delete mycode\n</code></pre>"},{"location":"cli/USAGE/#_18","title":"\u4f7f\u7528\u793a\u4f8b","text":""},{"location":"cli/USAGE/#1","title":"\u793a\u4f8b 1: \u5feb\u901f\u521b\u5efa\u77ed\u7f51\u5740","text":"<pre><code>$ shortener-cli create https://github.com/jetsung -c github -d \"\u6211\u7684 GitHub\"\n\u2713 Short URL created successfully!\n\nID:           1\nCode:         github\nShort URL:    http://localhost:8080/github\nOriginal URL: https://github.com/jetsung\nDescription:  \u6211\u7684 GitHub\nStatus:       0 (Enabled)\nCreated:      2024-01-15T08:30:00Z\nUpdated:      2024-01-15T08:30:00Z\n</code></pre>"},{"location":"cli/USAGE/#2","title":"\u793a\u4f8b 2: \u6279\u91cf\u67e5\u770b","text":"<pre><code>$ shortener-cli list -a\nTotal: 5 short URLs\n\n1. github (Enabled)\n   Short URL: http://localhost:8080/github\n   Original:  https://github.com/jetsung\n   Desc:      \u6211\u7684 GitHub\n   Created:   2024-01-15 08:30\n\n2. blog (Enabled)\n   Short URL: http://localhost:8080/blog\n   Original:  https://blog.example.com\n   Created:   2024-01-15 09:00\n...\n</code></pre>"},{"location":"cli/USAGE/#3","title":"\u793a\u4f8b 3: \u67e5\u627e\u548c\u66f4\u65b0","text":"<pre><code># \u67e5\u627e\u5305\u542b github \u7684\u94fe\u63a5\n$ shortener-cli find -r \"github\"\nFound 2 short URL(s) for: github\n\n1. github (Enabled)\n   Short URL: http://localhost:8080/github\n   Original:  https://github.com/jetsung\n   ...\n\n# \u66f4\u65b0\u5176\u4e2d\u4e00\u4e2a\n$ shortener-cli update github -d \"\u6211\u7684 GitHub \u4e3b\u9875\"\n\u2713 Short URL updated successfully!\n</code></pre>"},{"location":"cli/USAGE/#_19","title":"\u5b57\u6bb5\u8bf4\u660e","text":""},{"location":"cli/USAGE/#_20","title":"\u72b6\u6001\u503c","text":"<ul> <li><code>0</code> - \u542f\u7528 (Enabled)</li> <li><code>1</code> - \u7981\u7528 (Disabled)</li> </ul>"},{"location":"cli/USAGE/#_21","title":"\u6392\u5e8f\u5b57\u6bb5","text":"<ul> <li><code>id</code> - \u6309 ID \u6392\u5e8f</li> <li><code>short_code</code> - \u6309\u77ed\u7801\u6392\u5e8f</li> <li><code>created_at</code> - \u6309\u521b\u5efa\u65f6\u95f4\u6392\u5e8f\uff08\u9ed8\u8ba4\uff09</li> <li><code>updated_at</code> - \u6309\u66f4\u65b0\u65f6\u95f4\u6392\u5e8f</li> </ul>"},{"location":"cli/USAGE/#_22","title":"\u6392\u5e8f\u65b9\u5411","text":"<ul> <li><code>asc</code> - \u5347\u5e8f</li> <li><code>desc</code> - \u964d\u5e8f\uff08\u9ed8\u8ba4\uff09</li> </ul>"},{"location":"cli/USAGE/#_23","title":"\u6545\u969c\u6392\u9664","text":""},{"location":"cli/USAGE/#_24","title":"\u8fde\u63a5\u9519\u8bef","text":"<pre><code>Error: HTTP request failed: ...\n</code></pre> <p>\u68c0\u67e5\uff1a 1. \u670d\u52a1\u5668\u662f\u5426\u8fd0\u884c 2. URL \u662f\u5426\u6b63\u786e 3. \u7f51\u7edc\u8fde\u63a5\u662f\u5426\u6b63\u5e38</p>"},{"location":"cli/USAGE/#_25","title":"\u8ba4\u8bc1\u9519\u8bef","text":"<pre><code>Error: Unauthorized: Invalid API key\n</code></pre> <p>\u68c0\u67e5\uff1a 1. API Key \u662f\u5426\u6b63\u786e 2. \u662f\u5426\u5df2\u914d\u7f6e\u6216\u4f20\u9012 API Key</p>"},{"location":"cli/USAGE/#_26","title":"\u672a\u627e\u5230","text":"<pre><code>Error: Not found: Short URL 'xxx' not found\n</code></pre> <p>\u68c0\u67e5\u77ed\u7801\u662f\u5426\u5b58\u5728\uff1a <pre><code>shortener-cli list | grep xxx\n</code></pre></p>"},{"location":"cli/USAGE/#_27","title":"\u76f8\u5173\u6587\u6863","text":"<ul> <li>API \u53d8\u66f4\u8bf4\u660e</li> <li>\u670d\u52a1\u5668\u914d\u7f6e</li> </ul>"},{"location":"common/","title":"\u5171\u4eab\u5e93\u6587\u6863","text":"<p>Shortener Common \u662f\u4e00\u4e2a\u5171\u4eab\u5e93\uff0c\u5305\u542b shortener-server \u548c shortener-cli \u4f7f\u7528\u7684\u901a\u7528\u7c7b\u578b\u548c\u5de5\u5177\u3002</p>"},{"location":"common/#_2","title":"\ud83d\udce6 \u5185\u5bb9","text":""},{"location":"common/#_3","title":"\u6570\u636e\u7c7b\u578b","text":"<p>\u5171\u4eab\u7684\u6570\u636e\u7ed3\u6784\u5b9a\u4e49\uff0c\u786e\u4fdd\u670d\u52a1\u5668\u548c CLI \u4e4b\u95f4\u7684\u7c7b\u578b\u4e00\u81f4\u6027\u3002</p>"},{"location":"common/#_4","title":"\u5de5\u5177\u51fd\u6570","text":"<p>\u901a\u7528\u7684\u5de5\u5177\u51fd\u6570\uff0c\u907f\u514d\u4ee3\u7801\u91cd\u590d\u3002</p>"},{"location":"common/#_5","title":"\u5e38\u91cf\u5b9a\u4e49","text":"<p>\u9879\u76ee\u4e2d\u4f7f\u7528\u7684\u5e38\u91cf\u5b9a\u4e49\u3002</p>"},{"location":"common/#_6","title":"\u9519\u8bef\u7c7b\u578b","text":"<p>\u7edf\u4e00\u7684\u9519\u8bef\u5904\u7406\u7c7b\u578b\u3002</p>"},{"location":"common/#_7","title":"\ud83d\udd27 \u4f7f\u7528","text":"<p>\u5728 <code>Cargo.toml</code> \u4e2d\u6dfb\u52a0\u4f9d\u8d56\uff1a</p> <pre><code>[dependencies]\nshortener-common = { path = \"../shortener-common\" }\n</code></pre> <p>\u5728\u4ee3\u7801\u4e2d\u4f7f\u7528\uff1a</p> <pre><code>use shortener_common::types::*;\nuse shortener_common::utils::*;\n</code></pre>"},{"location":"common/#api","title":"\ud83d\udcd6 API \u6587\u6863","text":"<p>\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u751f\u6210 API \u6587\u6863\uff1a</p> <pre><code>cargo doc --package shortener-common --open\n</code></pre>"},{"location":"common/#_8","title":"\ud83d\udee0\ufe0f \u5f00\u53d1","text":""},{"location":"common/#_9","title":"\u6dfb\u52a0\u65b0\u7c7b\u578b","text":"<p>\u5728 <code>src/types.rs</code> \u4e2d\u6dfb\u52a0\u65b0\u7684\u7c7b\u578b\u5b9a\u4e49\u3002</p>"},{"location":"common/#_10","title":"\u6dfb\u52a0\u65b0\u5de5\u5177","text":"<p>\u5728 <code>src/utils.rs</code> \u4e2d\u6dfb\u52a0\u65b0\u7684\u5de5\u5177\u51fd\u6570\u3002</p>"},{"location":"common/#_11","title":"\u6d4b\u8bd5","text":"<pre><code>cargo test -p shortener-common\n</code></pre>"},{"location":"common/#_12","title":"\ud83d\udcdd \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u4fdd\u6301\u7c7b\u578b\u5b9a\u4e49\u7684\u7b80\u6d01\u6027</li> <li>\u786e\u4fdd\u5411\u540e\u517c\u5bb9\u6027</li> <li>\u4e3a\u516c\u5171 API \u6dfb\u52a0\u6587\u6863\u6ce8\u91ca</li> <li>\u7f16\u5199\u5355\u5143\u6d4b\u8bd5</li> </ul>"},{"location":"deployment/","title":"\u90e8\u7f72\u6587\u6863","text":"<p>\u672c\u76ee\u5f55\u5305\u542b Shortener \u9879\u76ee\u7684\u90e8\u7f72\u76f8\u5173\u6587\u6863\u3002</p>"},{"location":"deployment/#_2","title":"\u6587\u6863\u5217\u8868","text":""},{"location":"deployment/#_3","title":"\u540e\u7aef\u90e8\u7f72","text":"<ul> <li>\u90e8\u7f72\u6307\u5357 - \u751f\u4ea7\u73af\u5883\u90e8\u7f72\u6700\u4f73\u5b9e\u8df5</li> <li>Docker \u90e8\u7f72 - \u4f7f\u7528 Docker \u548c Docker Compose \u90e8\u7f72\u540e\u7aef\u670d\u52a1</li> <li>Docker \u9ad8\u7ea7\u914d\u7f6e - Docker \u9ad8\u7ea7\u914d\u7f6e\u548c\u4f18\u5316</li> <li>DEB \u5305\u5b89\u88c5 - Debian/Ubuntu \u7cfb\u7edf\u5b89\u88c5</li> <li>DEB \u5305\u6784\u5efa - \u5982\u4f55\u6784\u5efa Debian \u5305</li> <li>Systemd \u670d\u52a1 - \u4f7f\u7528 Systemd \u7ba1\u7406\u670d\u52a1</li> </ul>"},{"location":"deployment/#_4","title":"\u524d\u7aef\u90e8\u7f72","text":"<ul> <li>\u524d\u7aef Docker \u90e8\u7f72 - \u4f7f\u7528 Docker \u90e8\u7f72\u524d\u7aef\u5e94\u7528</li> <li>\u524d\u7aef\u90e8\u7f72\u6307\u5357 - \u524d\u7aef\u90e8\u7f72\u8be6\u7ec6\u8bf4\u660e</li> </ul>"},{"location":"deployment/#_5","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"deployment/#docker","title":"Docker \u90e8\u7f72\uff08\u63a8\u8350\uff09","text":"<pre><code># \u514b\u9686\u4ed3\u5e93\ngit clone https://github.com/jetsung/shortener.git\ncd shortener\n\n# \u4f7f\u7528 Docker Compose \u542f\u52a8\ndocker-compose up -d\n</code></pre> <p>\u8be6\u89c1\uff1aDocker \u90e8\u7f72</p>"},{"location":"deployment/#_6","title":"\u4f20\u7edf\u90e8\u7f72","text":"<ol> <li>\u7f16\u8bd1\u9879\u76ee</li> <li>\u914d\u7f6e\u6570\u636e\u5e93</li> <li>\u914d\u7f6e\u670d\u52a1</li> <li>\u542f\u52a8\u670d\u52a1</li> </ol> <p>\u8be6\u89c1\uff1a\u90e8\u7f72\u6307\u5357</p>"},{"location":"deployment/#deb","title":"DEB \u5305\u5b89\u88c5","text":"<pre><code># \u4e0b\u8f7d DEB \u5305\nwget https://github.com/jetsung/shortener/releases/latest/download/shortener_amd64.deb\n\n# \u5b89\u88c5\nsudo dpkg -i shortener_amd64.deb\n</code></pre> <p>\u8be6\u89c1\uff1aDEB \u5305\u5b89\u88c5</p>"},{"location":"deployment/#_7","title":"\u90e8\u7f72\u67b6\u6784","text":""},{"location":"deployment/#_8","title":"\u5355\u673a\u90e8\u7f72","text":"<ul> <li>\u5e94\u7528\u670d\u52a1\u5668</li> <li>SQLite \u6570\u636e\u5e93</li> <li>\u672c\u5730\u7f13\u5b58</li> </ul>"},{"location":"deployment/#_9","title":"\u5206\u5e03\u5f0f\u90e8\u7f72","text":"<ul> <li>\u591a\u4e2a\u5e94\u7528\u670d\u52a1\u5668\uff08\u8d1f\u8f7d\u5747\u8861\uff09</li> <li>PostgreSQL/MySQL \u6570\u636e\u5e93</li> <li>Redis/Valkey \u7f13\u5b58\u96c6\u7fa4</li> </ul>"},{"location":"deployment/#_10","title":"\u76f8\u5173\u6587\u6863","text":"<ul> <li>\u914d\u7f6e\u8bf4\u660e</li> <li>\u5b89\u88c5\u6307\u5357</li> <li>\u670d\u52a1\u5668\u6587\u6863</li> </ul>"},{"location":"deployment/BUILD_DEB/","title":"\u6784\u5efa DEB \u5305","text":"<p>\u672c\u9879\u76ee\u4f7f\u7528 <code>cargo-deb</code> \u81ea\u52a8\u751f\u6210 Debian \u5b89\u88c5\u5305\u3002</p>"},{"location":"deployment/BUILD_DEB/#_1","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"deployment/BUILD_DEB/#1-cargo-deb","title":"1. \u5b89\u88c5 cargo-deb","text":"<pre><code>cargo install cargo-deb\n</code></pre>"},{"location":"deployment/BUILD_DEB/#2-deb","title":"2. \u6784\u5efa deb \u5305","text":"<pre><code># \u6784\u5efa server\ncargo deb -p shortener-server\n\n# \u6784\u5efa CLI\ncargo deb -p shortener-cli\n\n# \u8f93\u51fa\u4f4d\u7f6e\n# target/debian/shortener-server_&lt;version&gt;_&lt;arch&gt;.deb\n# target/debian/shortener-cli_&lt;version&gt;_&lt;arch&gt;.deb\n</code></pre>"},{"location":"deployment/BUILD_DEB/#3","title":"3. \u5b89\u88c5\u6d4b\u8bd5","text":"<pre><code># \u5b89\u88c5\nsudo dpkg -i target/debian/shortener-server_*.deb\n\n# \u6216\u4f7f\u7528 apt\uff08\u63a8\u8350\uff0c\u4f1a\u81ea\u52a8\u5904\u7406\u4f9d\u8d56\uff09\nsudo apt install ./target/debian/shortener-server_*.deb\n\n# \u7f16\u8f91\u914d\u7f6e\nsudo nano /opt/shortener/config/config.toml\n\n# \u914d\u7f6e\u6570\u636e\u5e93\u8def\u5f84\uff08SQLite \u793a\u4f8b\uff09\n# [database.sqlite]\n# path = \"/opt/shortener/data/shortener.db\"\n\n# \u542f\u52a8\u670d\u52a1\nsudo systemctl start shortener-server\n\n# \u67e5\u770b\u72b6\u6001\nsudo systemctl status shortener-server\n</code></pre>"},{"location":"deployment/BUILD_DEB/#4","title":"4. \u5378\u8f7d","text":"<pre><code># \u5378\u8f7d\u4f46\u4fdd\u7559\u914d\u7f6e\nsudo dpkg -r shortener-server\n\n# \u5b8c\u5168\u5378\u8f7d\uff08\u5305\u62ec\u914d\u7f6e\u548c\u6570\u636e\uff09\nsudo dpkg -P shortener-server\n</code></pre>"},{"location":"deployment/BUILD_DEB/#_2","title":"\u914d\u7f6e\u8bf4\u660e","text":"<p>DEB \u6253\u5305\u914d\u7f6e\u5728 <code>shortener-server/Cargo.toml</code> \u4e2d\uff1a</p> <pre><code>[package.metadata.deb]\nmaintainer = \"Jetsung Chan &lt;i@jetsung.com&gt;\"\ndepends = \"$auto, systemd\"\nassets = [\n    [\"target/release/shortener-server\", \"usr/local/bin/\", \"755\"],\n    [\"../config/config.toml\", \"opt/shortener/config.toml.example\", \"644\"],\n    [\"../deploy/systemd/shortener-server.service\", \"lib/systemd/system/\", \"644\"],\n    [\"../README.md\", \"usr/share/doc/shortener-server/\", \"644\"],\n]\nmaintainer-scripts = \"../scripts/\"\n</code></pre>"},{"location":"deployment/BUILD_DEB/#_3","title":"\u5b89\u88c5\u540e\u7684\u6587\u4ef6\u5e03\u5c40","text":"<pre><code>/usr/local/bin/shortener-server                # \u4e8c\u8fdb\u5236\u6587\u4ef6\n/opt/shortener/config/config.toml              # \u914d\u7f6e\u6587\u4ef6\n/opt/shortener/config.toml.example             # \u914d\u7f6e\u793a\u4f8b\n/opt/shortener/data/                           # \u6570\u636e\u76ee\u5f55\uff08\u6570\u636e\u5e93\u3001GeoIP \u7b49\uff09\n/opt/shortener/logs/                           # \u65e5\u5fd7\u76ee\u5f55\n/lib/systemd/system/shortener-server.service   # systemd \u670d\u52a1\n</code></pre>"},{"location":"deployment/BUILD_DEB/#_4","title":"\u7ef4\u62a4\u811a\u672c","text":"<p>\u9879\u76ee\u5305\u542b 4 \u4e2a\u7ef4\u62a4\u811a\u672c\uff08\u4f4d\u4e8e <code>scripts/</code> \u76ee\u5f55\uff09\uff1a</p> <ul> <li><code>preinstall.sh</code>: \u521b\u5efa\u7528\u6237\u548c\u7ec4\uff0c\u5907\u4efd\u914d\u7f6e</li> <li><code>postinstall.sh</code>: \u521b\u5efa\u76ee\u5f55\uff0c\u8bbe\u7f6e\u6743\u9650\uff0c\u542f\u7528\u670d\u52a1</li> <li><code>preremove.sh</code>: \u505c\u6b62\u5e76\u7981\u7528\u670d\u52a1</li> <li><code>postremove.sh</code>: \u6e05\u7406\u6587\u4ef6\uff08\u4ec5\u5728 purge \u65f6\uff09</li> </ul>"},{"location":"deployment/BUILD_DEB/#_5","title":"\u8be6\u7ec6\u6587\u6863","text":"<p>\u66f4\u591a\u4fe1\u606f\u8bf7\u53c2\u8003\uff1a - DEB \u6253\u5305\u5b8c\u6574\u6307\u5357 - DEB \u6253\u5305\u7b80\u5316\u6307\u5357</p>"},{"location":"deployment/CROSS_COMPILE/","title":"\u4ea4\u53c9\u7f16\u8bd1\u6307\u5357","text":"<p>\u672c\u6307\u5357\u8bf4\u660e\u5982\u4f55\u4e3a\u4e0d\u540c\u5e73\u53f0\u548c\u67b6\u6784\u4ea4\u53c9\u7f16\u8bd1 Shortener \u9879\u76ee\u3002</p>"},{"location":"deployment/CROSS_COMPILE/#_2","title":"\u524d\u63d0\u6761\u4ef6","text":""},{"location":"deployment/CROSS_COMPILE/#cross","title":"\u5b89\u88c5 Cross","text":"<p>Cross \u662f\u4e00\u4e2a\u4f7f\u7528 Docker \u4ea4\u53c9\u7f16\u8bd1 Rust \u9879\u76ee\u7684\u5de5\u5177\uff1a</p> <pre><code>cargo install cross --git https://github.com/cross-rs/cross\n</code></pre>"},{"location":"deployment/CROSS_COMPILE/#docker","title":"\u5b89\u88c5 Docker","text":"<p>Cross \u9700\u8981\u5b89\u88c5\u5e76\u8fd0\u884c Docker\uff1a</p> <ul> <li>Linux\uff1a\u9075\u5faa Docker \u5b89\u88c5\u6307\u5357</li> <li>macOS\uff1a\u5b89\u88c5 Docker Desktop</li> <li>Windows\uff1a\u5b89\u88c5 Docker Desktop</li> </ul>"},{"location":"deployment/CROSS_COMPILE/#_3","title":"\u652f\u6301\u7684\u76ee\u6807\u5e73\u53f0","text":""},{"location":"deployment/CROSS_COMPILE/#linux","title":"Linux","text":"<ul> <li><code>x86_64-unknown-linux-gnu</code> - Linux x86_64 with glibc\uff08\u6700\u5e38\u89c1\uff09</li> <li><code>x86_64-unknown-linux-musl</code> - Linux x86_64 with musl\uff08\u9759\u6001\u94fe\u63a5\uff09</li> <li><code>aarch64-unknown-linux-gnu</code> - Linux ARM64 with glibc</li> <li><code>aarch64-unknown-linux-musl</code> - Linux ARM64 with musl\uff08\u9759\u6001\u94fe\u63a5\uff09</li> <li><code>armv7-unknown-linux-gnueabihf</code> - Linux ARMv7\uff08\u6811\u8393\u6d3e\u7b49\uff09</li> </ul>"},{"location":"deployment/CROSS_COMPILE/#windows","title":"Windows","text":"<ul> <li><code>x86_64-pc-windows-gnu</code> - Windows x86_64</li> </ul>"},{"location":"deployment/CROSS_COMPILE/#macos","title":"macOS","text":"<ul> <li><code>x86_64-apple-darwin</code> - macOS x86_64\uff08Intel\uff09</li> <li><code>aarch64-apple-darwin</code> - macOS ARM64\uff08Apple Silicon\uff09</li> </ul> <p>\u6ce8\u610f\uff1amacOS \u76ee\u6807\u9700\u8981\u5728 macOS \u4e0a\u6784\u5efa\u6216\u4f7f\u7528 osxcross\u3002</p>"},{"location":"deployment/CROSS_COMPILE/#_4","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"deployment/CROSS_COMPILE/#_5","title":"\u6784\u5efa\u6240\u6709\u76ee\u6807","text":"<pre><code># \u4e3a\u6240\u6709\u76ee\u6807\u6784\u5efa\u670d\u52a1\u5668\n./scripts/build-cross.sh --server\n\n# \u4e3a\u6240\u6709\u76ee\u6807\u6784\u5efa CLI\n./scripts/build-cross.sh --cli\n\n# \u6784\u5efa\u6240\u6709\n./scripts/build-cross.sh --all\n</code></pre>"},{"location":"deployment/CROSS_COMPILE/#_6","title":"\u6784\u5efa\u7279\u5b9a\u76ee\u6807","text":"<pre><code># \u4e3a Linux x86_64\uff08musl\uff09\u6784\u5efa\u670d\u52a1\u5668\n./scripts/build-cross.sh -t x86_64-unknown-linux-musl --server\n\n# \u4e3a ARM64 \u6784\u5efa CLI\n./scripts/build-cross.sh -t aarch64-unknown-linux-gnu --cli\n</code></pre>"},{"location":"deployment/CROSS_COMPILE/#_7","title":"\u5217\u51fa\u53ef\u7528\u76ee\u6807","text":"<pre><code>./scripts/build-cross.sh --list\n</code></pre>"},{"location":"deployment/CROSS_COMPILE/#_8","title":"\u624b\u52a8\u4ea4\u53c9\u7f16\u8bd1","text":""},{"location":"deployment/CROSS_COMPILE/#cross_1","title":"\u4f7f\u7528 Cross","text":"<pre><code># \u4e3a Linux x86_64\uff08musl\uff09\u6784\u5efa\ncross build --release --target x86_64-unknown-linux-musl -p shortener-server\n\n# \u4e3a ARM64 \u6784\u5efa\ncross build --release --target aarch64-unknown-linux-gnu -p shortener-server\n\n# \u4e3a Windows \u6784\u5efa\ncross build --release --target x86_64-pc-windows-gnu -p shortener-server\n</code></pre>"},{"location":"deployment/CROSS_COMPILE/#cargo","title":"\u4f7f\u7528 Cargo\uff08\u539f\u751f\uff09","text":"<p>\u5bf9\u4e8e\u4e3b\u673a\u7cfb\u7edf\u652f\u6301\u7684\u76ee\u6807\uff1a</p> <pre><code># \u6dfb\u52a0\u76ee\u6807\nrustup target add x86_64-unknown-linux-musl\n\n# \u6784\u5efa\ncargo build --release --target x86_64-unknown-linux-musl -p shortener-server\n</code></pre>"},{"location":"deployment/CROSS_COMPILE/#_9","title":"\u8f93\u51fa\u4f4d\u7f6e","text":"<p>\u4e8c\u8fdb\u5236\u6587\u4ef6\u4f4d\u4e8e\uff1a</p> <pre><code>target/&lt;target&gt;/release/\n\u251c\u2500\u2500 shortener-server\n\u2514\u2500\u2500 shortener-cli\n</code></pre> <p>\u6253\u5305\u7684\u53d1\u5e03\u7248\u672c\u4f4d\u4e8e\uff1a</p> <pre><code>target/release-builds/&lt;target&gt;/\n\u251c\u2500\u2500 shortener-server-&lt;version&gt;-&lt;target&gt;.tar.gz\n\u251c\u2500\u2500 shortener-server-&lt;version&gt;-&lt;target&gt;.sha256\n\u251c\u2500\u2500 shortener-cli-&lt;version&gt;-&lt;target&gt;.tar.gz\n\u2514\u2500\u2500 shortener-cli-&lt;version&gt;-&lt;target&gt;.sha256\n</code></pre>"},{"location":"deployment/CROSS_COMPILE/#_10","title":"\u5e73\u53f0\u7279\u5b9a\u8bf4\u660e","text":""},{"location":"deployment/CROSS_COMPILE/#linuxmusl","title":"Linux\uff08musl\uff09","text":"<p>Musl \u76ee\u6807\u751f\u6210\u53ef\u5728\u4efb\u4f55 Linux \u53d1\u884c\u7248\u4e0a\u8fd0\u884c\u7684\u9759\u6001\u94fe\u63a5\u4e8c\u8fdb\u5236\u6587\u4ef6\uff1a</p> <pre><code>cross build --release --target x86_64-unknown-linux-musl -p shortener-server\n</code></pre> <p>\u4f18\u70b9\uff1a - \u65e0\u8fd0\u884c\u65f6\u4f9d\u8d56 - \u53ef\u5728\u4efb\u4f55 Linux \u53d1\u884c\u7248\u4e0a\u8fd0\u884c - \u66f4\u5c0f\u7684\u4e8c\u8fdb\u5236\u5927\u5c0f</p>"},{"location":"deployment/CROSS_COMPILE/#arm","title":"ARM \u5e73\u53f0","text":"<p>\u5bf9\u4e8e\u6811\u8393\u6d3e\u548c\u5176\u4ed6 ARM \u8bbe\u5907\uff1a</p> <pre><code># ARMv7\uff08\u6811\u8393\u6d3e 2/3/4 32 \u4f4d\u6a21\u5f0f\uff09\ncross build --release --target armv7-unknown-linux-gnueabihf -p shortener-server\n\n# ARM64\uff08\u6811\u8393\u6d3e 3/4 64 \u4f4d\u6a21\u5f0f\uff09\ncross build --release --target aarch64-unknown-linux-gnu -p shortener-server\n</code></pre>"},{"location":"deployment/CROSS_COMPILE/#windows_1","title":"Windows","text":"<p>\u4ece Linux \u4ea4\u53c9\u7f16\u8bd1\u5230 Windows\uff1a</p> <pre><code>cross build --release --target x86_64-pc-windows-gnu -p shortener-server\n</code></pre> <p>\u8f93\u51fa\u5c06\u662f <code>shortener-server.exe</code>\u3002</p>"},{"location":"deployment/CROSS_COMPILE/#macos_1","title":"macOS","text":""},{"location":"deployment/CROSS_COMPILE/#macos_2","title":"\u5728 macOS \u4e0a\uff08\u539f\u751f\uff09","text":"<pre><code># Intel Mac\ncargo build --release --target x86_64-apple-darwin -p shortener-server\n\n# Apple Silicon\ncargo build --release --target aarch64-apple-darwin -p shortener-server\n\n# \u901a\u7528\u4e8c\u8fdb\u5236\uff08\u4e24\u79cd\u67b6\u6784\uff09\ncargo build --release --target x86_64-apple-darwin -p shortener-server\ncargo build --release --target aarch64-apple-darwin -p shortener-server\nlipo -create \\\n  target/x86_64-apple-darwin/release/shortener-server \\\n  target/aarch64-apple-darwin/release/shortener-server \\\n  -output shortener-server-universal\n</code></pre>"},{"location":"deployment/CROSS_COMPILE/#_11","title":"\u6545\u969c\u6392\u9664","text":""},{"location":"deployment/CROSS_COMPILE/#cross_2","title":"\u627e\u4e0d\u5230 Cross","text":"<pre><code># \u5b89\u88c5 cross\ncargo install cross --git https://github.com/cross-rs/cross\n\n# \u9a8c\u8bc1\u5b89\u88c5\ncross --version\n</code></pre>"},{"location":"deployment/CROSS_COMPILE/#docker_1","title":"Docker \u672a\u8fd0\u884c","text":"<pre><code># \u542f\u52a8 Docker\nsudo systemctl start docker  # Linux\n# \u6216\u5728 macOS/Windows \u4e0a\u6253\u5f00 Docker Desktop\n\n# \u9a8c\u8bc1 Docker\ndocker ps\n</code></pre>"},{"location":"deployment/CROSS_COMPILE/#linux_1","title":"\u6743\u9650\u88ab\u62d2\u7edd\uff08Linux\uff09","text":"<pre><code># \u5c06\u7528\u6237\u6dfb\u52a0\u5230 docker \u7ec4\nsudo usermod -aG docker $USER\n\n# \u6ce8\u9500\u5e76\u91cd\u65b0\u767b\u5f55\uff0c\u6216\u8fd0\u884c\uff1a\nnewgrp docker\n</code></pre>"},{"location":"deployment/CROSS_COMPILE/#_12","title":"\u6784\u5efa\u5931\u8d25","text":"<pre><code># \u6e05\u7406\u6784\u5efa\ncargo clean\n\n# \u66f4\u65b0 cross\ncargo install cross --git https://github.com/cross-rs/cross --force\n\n# \u62c9\u53d6\u6700\u65b0\u7684 Docker \u955c\u50cf\ndocker pull ghcr.io/cross-rs/x86_64-unknown-linux-gnu:latest\n</code></pre>"},{"location":"deployment/CROSS_COMPILE/#_13","title":"\u4f18\u5316","text":""},{"location":"deployment/CROSS_COMPILE/#_14","title":"\u51cf\u5c0f\u4e8c\u8fdb\u5236\u5927\u5c0f","text":"<p>\u5728 <code>Cargo.toml</code> \u4e2d\u6dfb\u52a0\uff1a</p> <pre><code>[profile.release]\nopt-level = \"z\"     # \u4f18\u5316\u5927\u5c0f\nlto = true          # \u542f\u7528\u94fe\u63a5\u65f6\u4f18\u5316\ncodegen-units = 1   # \u66f4\u597d\u7684\u4f18\u5316\nstrip = true        # \u5265\u79bb\u7b26\u53f7\npanic = \"abort\"     # \u66f4\u5c0f\u7684 panic \u5904\u7406\u5668\n</code></pre>"},{"location":"deployment/CROSS_COMPILE/#_15","title":"\u66f4\u5feb\u7684\u6784\u5efa","text":"<pre><code># \u4f7f\u7528 sccache \u8fdb\u884c\u7f13\u5b58\ncargo install sccache\nexport RUSTC_WRAPPER=sccache\n\n# \u5e76\u884c\u6784\u5efa\nexport CARGO_BUILD_JOBS=8\n</code></pre>"},{"location":"deployment/CROSS_COMPILE/#_16","title":"\u6700\u4f73\u5b9e\u8df5","text":"<ol> <li>\u5728\u76ee\u6807\u5e73\u53f0\u4e0a\u6d4b\u8bd5 - \u59cb\u7ec8\u5728\u5b9e\u9645\u76ee\u6807\u5e73\u53f0\u4e0a\u6d4b\u8bd5\u4e8c\u8fdb\u5236\u6587\u4ef6</li> <li>Linux \u4f7f\u7528 musl - \u751f\u6210\u53ef\u79fb\u690d\u7684\u9759\u6001\u4e8c\u8fdb\u5236\u6587\u4ef6</li> <li>\u5265\u79bb\u4e8c\u8fdb\u5236\u6587\u4ef6 - \u5220\u9664\u8c03\u8bd5\u7b26\u53f7\u4ee5\u51cf\u5c0f\u5927\u5c0f</li> <li>\u9a8c\u8bc1\u6821\u9a8c\u548c - \u59cb\u7ec8\u63d0\u4f9b\u5e76\u9a8c\u8bc1 SHA256 \u6821\u9a8c\u548c</li> <li>\u8bb0\u5f55\u4f9d\u8d56\u9879 - \u5217\u51fa\u4efb\u4f55\u8fd0\u884c\u65f6\u4f9d\u8d56\u9879</li> <li>\u4e00\u81f4\u7684\u7248\u672c\u63a7\u5236 - \u4f7f\u7528\u8bed\u4e49\u5316\u7248\u672c</li> <li>\u81ea\u52a8\u5316\u6784\u5efa - \u4f7f\u7528 CI/CD \u8fdb\u884c\u4e00\u81f4\u7684\u6784\u5efa</li> </ol>"},{"location":"deployment/CROSS_COMPILE/#_17","title":"\u53c2\u8003","text":"<ul> <li>Cross \u6587\u6863</li> <li>Rust \u5e73\u53f0\u652f\u6301</li> <li>Cargo \u624b\u518c - \u6784\u5efa\u811a\u672c</li> <li>rustup \u6587\u6863</li> </ul>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/","title":"DEB \u5305\u5b89\u88c5\u6307\u5357","text":"<p>\u672c\u6587\u6863\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 DEB \u5305\u5b89\u88c5\u548c\u7ba1\u7406 Shortener \u670d\u52a1\u3002</p>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_1","title":"\u5feb\u901f\u5b89\u88c5","text":""},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#1-deb","title":"1. \u4e0b\u8f7d DEB \u5305","text":"<p>\u4ece GitHub Releases \u4e0b\u8f7d\u6700\u65b0\u7684 DEB \u5305\u3002</p>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#2","title":"2. \u5b89\u88c5","text":"<pre><code># \u4f7f\u7528 apt \u5b89\u88c5\uff08\u63a8\u8350\uff0c\u4f1a\u81ea\u52a8\u5904\u7406\u4f9d\u8d56\uff09\nsudo apt install ./shortener-server_*.deb\n\n# \u6216\u4f7f\u7528 dpkg\nsudo dpkg -i shortener-server_*.deb\n</code></pre>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#3","title":"3. \u914d\u7f6e","text":"<p>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\uff1a</p> <pre><code>sudo nano /opt/shortener/config/config.toml\n</code></pre> <p>\u91cd\u8981\u914d\u7f6e\u9879\uff1a</p> <pre><code>[server]\naddress = \":8080\"\nsite_url = \"http://your-domain.com\"\napi_key = \"your-secret-key\"\n\n[database]\ntype = \"sqlite\"\n\n[database.sqlite]\npath = \"/opt/shortener/data/shortener.db\"\n\n[geoip]\nenabled = true\ntype = \"ip2region\"\n# \u6570\u636e\u6587\u4ef6\u8def\u5f84\uff1a/opt/shortener/data/ip2region.xdb\n</code></pre>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#4","title":"4. \u542f\u52a8\u670d\u52a1","text":"<pre><code># \u542f\u52a8\u670d\u52a1\nsudo systemctl start shortener-server\n\n# \u67e5\u770b\u72b6\u6001\nsudo systemctl status shortener-server\n\n# \u67e5\u770b\u65e5\u5fd7\nsudo journalctl -u shortener-server -f\n</code></pre>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_2","title":"\u6587\u4ef6\u5e03\u5c40","text":"<p>\u5b89\u88c5\u540e\u7684\u6587\u4ef6\u7ed3\u6784\uff1a</p> <pre><code>/usr/local/bin/shortener-server                # \u4e8c\u8fdb\u5236\u6587\u4ef6\n/opt/shortener/\n\u251c\u2500\u2500 config/\n\u2502   \u251c\u2500\u2500 config.toml                            # \u914d\u7f6e\u6587\u4ef6\n\u2502   \u2514\u2500\u2500 config.toml.example                    # \u914d\u7f6e\u793a\u4f8b\n\u251c\u2500\u2500 data/                                      # \u6570\u636e\u76ee\u5f55\n\u2502   \u251c\u2500\u2500 shortener.db                           # SQLite \u6570\u636e\u5e93\n\u2502   \u2514\u2500\u2500 ip2region.xdb                          # GeoIP \u6570\u636e\u6587\u4ef6\n\u2514\u2500\u2500 logs/                                      # \u65e5\u5fd7\u76ee\u5f55\n/lib/systemd/system/shortener-server.service   # systemd \u670d\u52a1\n/usr/share/doc/shortener-server/README         # \u6587\u6863\n</code></pre>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_3","title":"\u6570\u636e\u6587\u4ef6\u8bf4\u660e","text":""},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_4","title":"\u6570\u636e\u5e93\u6587\u4ef6","text":"<p>\u5982\u679c\u4f7f\u7528 SQLite\uff0c\u6570\u636e\u5e93\u6587\u4ef6\u9ed8\u8ba4\u4fdd\u5b58\u5728\uff1a</p> <pre><code>/opt/shortener/data/shortener.db\n</code></pre> <p>\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\uff1a</p> <pre><code>[database.sqlite]\npath = \"/opt/shortener/data/shortener.db\"\n</code></pre>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#geoip","title":"GeoIP \u6570\u636e\u6587\u4ef6","text":"<p>\u5982\u679c\u542f\u7528 GeoIP \u529f\u80fd\uff0c\u9700\u8981\u5c06 <code>ip2region.xdb</code> \u6587\u4ef6\u653e\u5728\uff1a</p> <pre><code>/opt/shortener/data/ip2region.xdb\n</code></pre> <p>\u4e0b\u8f7d\u5730\u5740\uff1aip2region</p> <p>\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\uff1a</p> <pre><code>[geoip]\nenabled = true\ntype = \"ip2region\"\n</code></pre>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_5","title":"\u65e5\u5fd7\u6587\u4ef6","text":"<p>\u65e5\u5fd7\u6587\u4ef6\u4fdd\u5b58\u5728\uff1a</p> <pre><code>/opt/shortener/logs/\n</code></pre> <p>\u53ef\u4ee5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u81ea\u5b9a\u4e49\u65e5\u5fd7\u8bbe\u7f6e\uff1a</p> <pre><code>[logging]\nlevel = \"info\"\nformat = \"json\"\n</code></pre>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_6","title":"\u670d\u52a1\u7ba1\u7406","text":""},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_7","title":"\u542f\u52a8/\u505c\u6b62\u670d\u52a1","text":"<pre><code># \u542f\u52a8\nsudo systemctl start shortener-server\n\n# \u505c\u6b62\nsudo systemctl stop shortener-server\n\n# \u91cd\u542f\nsudo systemctl restart shortener-server\n\n# \u67e5\u770b\u72b6\u6001\nsudo systemctl status shortener-server\n</code></pre>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_8","title":"\u5f00\u673a\u81ea\u542f","text":"<pre><code># \u542f\u7528\u5f00\u673a\u81ea\u542f\uff08\u5b89\u88c5\u65f6\u5df2\u81ea\u52a8\u542f\u7528\uff09\nsudo systemctl enable shortener-server\n\n# \u7981\u7528\u5f00\u673a\u81ea\u542f\nsudo systemctl disable shortener-server\n</code></pre>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_9","title":"\u67e5\u770b\u65e5\u5fd7","text":"<pre><code># \u5b9e\u65f6\u67e5\u770b\u65e5\u5fd7\nsudo journalctl -u shortener-server -f\n\n# \u67e5\u770b\u6700\u8fd1 50 \u6761\u65e5\u5fd7\nsudo journalctl -u shortener-server -n 50\n\n# \u67e5\u770b\u4eca\u5929\u7684\u65e5\u5fd7\nsudo journalctl -u shortener-server --since today\n</code></pre>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_10","title":"\u6743\u9650\u8bf4\u660e","text":"<p>\u670d\u52a1\u4ee5 <code>shortener</code> \u7528\u6237\u8fd0\u884c\uff0c\u6240\u6709\u6587\u4ef6\u548c\u76ee\u5f55\u90fd\u5c5e\u4e8e\u8be5\u7528\u6237\uff1a</p> <pre><code># \u67e5\u770b\u6743\u9650\nls -la /opt/shortener/\n\n# \u5982\u9700\u4fee\u6539\u6743\u9650\nsudo chown -R shortener:shortener /opt/shortener\nsudo chmod 640 /opt/shortener/config/config.toml\nsudo chmod 755 /opt/shortener/data\nsudo chmod 755 /opt/shortener/logs\n</code></pre>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_11","title":"\u5347\u7ea7","text":"<p>\u76f4\u63a5\u5b89\u88c5\u65b0\u7248\u672c\u7684 DEB \u5305\u5373\u53ef\uff0c\u914d\u7f6e\u6587\u4ef6\u548c\u6570\u636e\u4f1a\u81ea\u52a8\u4fdd\u7559\uff1a</p> <pre><code>sudo apt install ./shortener-server_&lt;new-version&gt;_amd64.deb\n</code></pre> <p>\u670d\u52a1\u4f1a\u81ea\u52a8\u91cd\u542f\u3002</p>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_12","title":"\u5378\u8f7d","text":""},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_13","title":"\u5378\u8f7d\u4f46\u4fdd\u7559\u914d\u7f6e\u548c\u6570\u636e","text":"<pre><code>sudo dpkg -r shortener-server\n</code></pre>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_14","title":"\u5b8c\u5168\u5378\u8f7d\uff08\u5305\u62ec\u914d\u7f6e\u548c\u6570\u636e\uff09","text":"<pre><code>sudo dpkg -P shortener-server\n</code></pre> <p>\u8b66\u544a</p> <p>\u5b8c\u5168\u5378\u8f7d\u4f1a\u5220\u9664\u6240\u6709\u6570\u636e\uff0c\u5305\u62ec\u6570\u636e\u5e93\u6587\u4ef6\u548c\u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u63d0\u524d\u5907\u4efd\uff01</p>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_15","title":"\u5907\u4efd\u548c\u6062\u590d","text":""},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_16","title":"\u5907\u4efd","text":"<pre><code># \u505c\u6b62\u670d\u52a1\nsudo systemctl stop shortener-server\n\n# \u5907\u4efd\u914d\u7f6e\u548c\u6570\u636e\nsudo tar czf shortener-backup-$(date +%Y%m%d).tar.gz \\\n    /opt/shortener/config/ \\\n    /opt/shortener/data/\n\n# \u542f\u52a8\u670d\u52a1\nsudo systemctl start shortener-server\n</code></pre>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_17","title":"\u6062\u590d","text":"<pre><code># \u505c\u6b62\u670d\u52a1\nsudo systemctl stop shortener-server\n\n# \u6062\u590d\u6570\u636e\nsudo tar xzf shortener-backup-20250117.tar.gz -C /\n\n# \u8bbe\u7f6e\u6743\u9650\nsudo chown -R shortener:shortener /opt/shortener\n\n# \u542f\u52a8\u670d\u52a1\nsudo systemctl start shortener-server\n</code></pre>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_18","title":"\u6545\u969c\u6392\u67e5","text":""},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_19","title":"\u670d\u52a1\u542f\u52a8\u5931\u8d25","text":"<pre><code># \u67e5\u770b\u8be6\u7ec6\u65e5\u5fd7\nsudo journalctl -u shortener-server -n 50\n\n# \u68c0\u67e5\u914d\u7f6e\u6587\u4ef6\nsudo cat /opt/shortener/config/config.toml\n\n# \u68c0\u67e5\u6570\u636e\u76ee\u5f55\u6743\u9650\nls -la /opt/shortener/data/\n\n# \u624b\u52a8\u6d4b\u8bd5\nsudo -u shortener /usr/local/bin/shortener-server\n</code></pre>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_20","title":"\u6570\u636e\u5e93\u8fde\u63a5\u5931\u8d25","text":"<p>\u68c0\u67e5\u6570\u636e\u5e93\u6587\u4ef6\u8def\u5f84\u548c\u6743\u9650\uff1a</p> <pre><code># \u68c0\u67e5\u6587\u4ef6\u662f\u5426\u5b58\u5728\nls -la /opt/shortener/data/shortener.db\n\n# \u68c0\u67e5\u6743\u9650\nsudo chown shortener:shortener /opt/shortener/data/shortener.db\nsudo chmod 644 /opt/shortener/data/shortener.db\n</code></pre>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#geoip_1","title":"GeoIP \u529f\u80fd\u4e0d\u5de5\u4f5c","text":"<p>\u68c0\u67e5 GeoIP \u6570\u636e\u6587\u4ef6\uff1a</p> <pre><code># \u68c0\u67e5\u6587\u4ef6\u662f\u5426\u5b58\u5728\nls -la /opt/shortener/data/ip2region.xdb\n\n# \u4e0b\u8f7d\u6570\u636e\u6587\u4ef6\ncd /opt/shortener/data/\nsudo wget https://github.com/lionsoul2014/ip2region/raw/master/data/ip2region.xdb\nsudo chown shortener:shortener ip2region.xdb\n</code></pre>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_21","title":"\u7aef\u53e3\u88ab\u5360\u7528","text":"<pre><code># \u68c0\u67e5\u7aef\u53e3\u5360\u7528\nsudo netstat -tlnp | grep 8080\n\n# \u6216\u4f7f\u7528 ss\nsudo ss -tlnp | grep 8080\n\n# \u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u7aef\u53e3\nsudo nano /opt/shortener/config/config.toml\n</code></pre>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#deb_1","title":"\u4ece\u6e90\u7801\u6784\u5efa DEB \u5305","text":"<p>\u5982\u679c\u9700\u8981\u81ea\u5df1\u6784\u5efa DEB \u5305\uff1a</p> <pre><code># \u5b89\u88c5 cargo-deb\ncargo install cargo-deb\n\n# \u6784\u5efa\ncargo deb -p shortener-server\n\n# \u8f93\u51fa\u4f4d\u7f6e\n# target/debian/shortener-server_&lt;version&gt;_&lt;arch&gt;.deb\n</code></pre> <p>\u8be6\u7ec6\u4fe1\u606f\u8bf7\u53c2\u8003\u9879\u76ee\u7684 \u5b89\u88c5\u6307\u5357\u3002</p>"},{"location":"deployment/DEB_PACKAGING_SIMPLIFIED/#_22","title":"\u76f8\u5173\u6587\u6863","text":"<ul> <li>\u5b89\u88c5\u6307\u5357</li> <li>\u914d\u7f6e\u6307\u5357</li> <li>\u90e8\u7f72\u6307\u5357</li> <li>API \u6587\u6863</li> </ul>"},{"location":"deployment/DEPLOYMENT/","title":"\u90e8\u7f72\u6307\u5357","text":"<p>\u5728\u5404\u79cd\u73af\u5883\u4e2d\u90e8\u7f72 Shortener \u670d\u52a1\u5668\u7684\u5b8c\u6574\u6307\u5357\u3002</p>"},{"location":"deployment/DEPLOYMENT/#_2","title":"\u76ee\u5f55","text":"<ul> <li>\u6982\u8ff0</li> <li>\u524d\u63d0\u6761\u4ef6</li> <li>\u90e8\u7f72\u65b9\u6cd5</li> <li>Docker \u90e8\u7f72</li> <li>Systemd \u90e8\u7f72</li> <li>\u624b\u52a8\u90e8\u7f72</li> <li>\u4e91\u90e8\u7f72</li> <li>\u53cd\u5411\u4ee3\u7406\u8bbe\u7f6e</li> <li>SSL/TLS \u914d\u7f6e</li> <li>\u76d1\u63a7</li> <li>\u5907\u4efd\u548c\u6062\u590d</li> </ul>"},{"location":"deployment/DEPLOYMENT/#_3","title":"\u6982\u8ff0","text":"<p>Shortener \u670d\u52a1\u5668\u53ef\u4ee5\u901a\u8fc7\u591a\u79cd\u65b9\u5f0f\u90e8\u7f72\uff1a</p> <ol> <li>Docker - \u63a8\u8350\u7528\u4e8e\u5927\u591a\u6570\u573a\u666f</li> <li>Systemd - \u7528\u4e8e\u4f20\u7edf Linux \u90e8\u7f72</li> <li>\u624b\u52a8 - \u7528\u4e8e\u81ea\u5b9a\u4e49\u8bbe\u7f6e</li> <li>\u4e91 - AWS\u3001GCP\u3001Azure \u7b49</li> </ol>"},{"location":"deployment/DEPLOYMENT/#_4","title":"\u524d\u63d0\u6761\u4ef6","text":""},{"location":"deployment/DEPLOYMENT/#_5","title":"\u7cfb\u7edf\u8981\u6c42","text":"<ul> <li>CPU\uff1a\u6700\u5c11 1 \u6838\uff0c\u63a8\u8350 2+ \u6838</li> <li>\u5185\u5b58\uff1a\u6700\u5c11 512MB\uff0c\u63a8\u8350 1GB+</li> <li>\u78c1\u76d8\uff1a\u6700\u5c11 1GB\uff0c\u63a8\u8350 10GB+</li> <li>\u64cd\u4f5c\u7cfb\u7edf\uff1aLinux\uff08Ubuntu 20.04+\u3001Debian 11+\u3001CentOS 8+ \u7b49\uff09</li> </ul>"},{"location":"deployment/DEPLOYMENT/#_6","title":"\u8f6f\u4ef6\u8981\u6c42","text":"<ul> <li>Rust\uff1a1.85+\uff08\u4ece\u6e90\u7801\u6784\u5efa\uff09</li> <li>Docker\uff1a20.10+\uff08Docker \u90e8\u7f72\uff09</li> <li>PostgreSQL\uff1a12+ \u6216 MySQL\uff1a8.0+\uff08\u53ef\u9009\uff0c\u751f\u4ea7\u73af\u5883\uff09</li> <li>Redis\uff1a6.0+ \u6216 Valkey\uff1a7.0+\uff08\u53ef\u9009\uff0c\u7f13\u5b58\uff09</li> </ul>"},{"location":"deployment/DEPLOYMENT/#_7","title":"\u90e8\u7f72\u65b9\u6cd5","text":""},{"location":"deployment/DEPLOYMENT/#_8","title":"\u5feb\u901f\u6bd4\u8f83","text":"\u65b9\u6cd5 \u96be\u5ea6 \u9694\u79bb\u6027 \u53ef\u79fb\u690d\u6027 \u6700\u9002\u5408 Docker \u7b80\u5355 \u9ad8 \u9ad8 \u5927\u591a\u6570\u90e8\u7f72 Systemd \u4e2d\u7b49 \u4f4e \u4f4e \u4f20\u7edf Linux \u624b\u52a8 \u56f0\u96be \u4f4e \u4f4e \u81ea\u5b9a\u4e49\u8bbe\u7f6e \u4e91 \u7b80\u5355 \u9ad8 \u9ad8 \u53ef\u6269\u5c55\u90e8\u7f72"},{"location":"deployment/DEPLOYMENT/#docker","title":"Docker \u90e8\u7f72","text":"<p>Docker \u662f\u63a8\u8350\u7684\u90e8\u7f72\u65b9\u5f0f\uff0c\u63d0\u4f9b\u4e86\u7b80\u5355\u7684\u8bbe\u7f6e\u548c\u826f\u597d\u7684\u9694\u79bb\u6027\u3002</p> <p>\u8be6\u7ec6\u7684 Docker \u90e8\u7f72\u8bf4\u660e\u8bf7\u53c2\u9605 Docker \u90e8\u7f72\u6307\u5357\uff0c\u5305\u62ec\uff1a</p> <ul> <li>\u5f00\u53d1\u548c\u751f\u4ea7\u73af\u5883\u914d\u7f6e</li> <li>Docker Compose \u8bbe\u7f6e</li> <li>\u591a\u6570\u636e\u5e93\u652f\u6301</li> <li>\u73af\u5883\u53d8\u91cf\u914d\u7f6e</li> <li>\u6570\u636e\u6301\u4e45\u5316</li> <li>\u5065\u5eb7\u68c0\u67e5\u548c\u76d1\u63a7</li> </ul>"},{"location":"deployment/DEPLOYMENT/#_9","title":"\u5feb\u901f\u5f00\u59cb","text":"<pre><code># \u514b\u9686\u4ed3\u5e93\ngit clone https://github.com/jetsung/shortener.git\ncd shortener\n\n# \u4f7f\u7528 Docker Compose \u542f\u52a8\ndocker compose up -d\n</code></pre> <p>\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u8bf7\u67e5\u770b Docker \u90e8\u7f72\u6307\u5357\u3002 ADMIN_PASSWORD=$(openssl rand -base64 32) EOF <pre><code>3. \u542f\u52a8\u670d\u52a1\uff1a\n\n```bash\ndocker compose --env-file .env up -d\n</code></pre></p> <ol> <li>\u9a8c\u8bc1\u90e8\u7f72\uff1a</li> </ol> <pre><code># \u68c0\u67e5\u5bb9\u5668\u72b6\u6001\ndocker compose ps\n\n# \u68c0\u67e5\u65e5\u5fd7\ndocker compose logs -f shortener-server\n\n# \u6d4b\u8bd5 API\ncurl http://localhost:8080/health\n</code></pre> <p>\u8be6\u7ec6\u8bf4\u660e\u8bf7\u53c2\u9605 Docker \u90e8\u7f72\u6307\u5357\u3002</p>"},{"location":"deployment/DEPLOYMENT/#systemd","title":"Systemd \u90e8\u7f72","text":""},{"location":"deployment/DEPLOYMENT/#_10","title":"\u5b89\u88c5","text":"<ol> <li>\u6784\u5efa\u4e8c\u8fdb\u5236\u6587\u4ef6\uff1a</li> </ol> <pre><code>cargo build --release -p shortener-server\n</code></pre> <ol> <li>\u5b89\u88c5 DEB \u5305\uff08\u63a8\u8350\uff09\uff1a</li> </ol> <pre><code># \u4e0b\u8f7d\u5e76\u5b89\u88c5 DEB \u5305\nsudo apt install ./shortener-server_*.deb\n</code></pre> <p>\u6216\u624b\u52a8\u5b89\u88c5\uff1a</p> <pre><code>cd deploy/systemd\nsudo ./install.sh\n</code></pre> <p>\u8fd9\u5c06\uff1a - \u590d\u5236\u4e8c\u8fdb\u5236\u6587\u4ef6\u5230 <code>/usr/local/bin/</code> - \u521b\u5efa\u914d\u7f6e\u76ee\u5f55 <code>/opt/shortener/config/</code> - \u521b\u5efa\u6570\u636e\u76ee\u5f55 <code>/opt/shortener/data/</code> - \u521b\u5efa\u65e5\u5fd7\u76ee\u5f55 <code>/opt/shortener/logs/</code> - \u521b\u5efa systemd \u670d\u52a1\u6587\u4ef6 - \u521b\u5efa <code>shortener</code> \u7528\u6237\u548c\u7ec4</p> <ol> <li>\u914d\u7f6e\u670d\u52a1\uff1a</li> </ol> <pre><code>sudo vim /opt/shortener/config/config.toml\n</code></pre> <p>\u914d\u7f6e\u6570\u636e\u5e93\u8def\u5f84\uff1a</p> <pre><code>[database.sqlite]\npath = \"/opt/shortener/data/shortener.db\"\n</code></pre> <ol> <li>\u542f\u52a8\u670d\u52a1\uff1a</li> </ol> <pre><code>sudo systemctl start shortener-server\nsudo systemctl enable shortener-server\n</code></pre> <ol> <li>\u9a8c\u8bc1\uff1a</li> </ol> <pre><code>sudo systemctl status shortener-server\nsudo journalctl -u shortener-server -f\n</code></pre>"},{"location":"deployment/DEPLOYMENT/#_11","title":"\u670d\u52a1\u7ba1\u7406","text":"<pre><code># \u542f\u52a8\nsudo systemctl start shortener-server\n\n# \u505c\u6b62\nsudo systemctl stop shortener-server\n\n# \u91cd\u542f\nsudo systemctl restart shortener-server\n\n# \u72b6\u6001\nsudo systemctl status shortener-server\n\n# \u542f\u7528\u81ea\u52a8\u542f\u52a8\nsudo systemctl enable shortener-server\n\n# \u67e5\u770b\u65e5\u5fd7\nsudo journalctl -u shortener-server -f\n</code></pre>"},{"location":"deployment/DEPLOYMENT/#_12","title":"\u624b\u52a8\u90e8\u7f72","text":""},{"location":"deployment/DEPLOYMENT/#_13","title":"\u4ece\u6e90\u7801\u6784\u5efa","text":"<pre><code># \u514b\u9686\u4ed3\u5e93\ngit clone https://github.com/jetsung/shortener.git\ncd shortener\n\n# \u6784\u5efa\u53d1\u5e03\u7248\u672c\ncargo build --release -p shortener-server\n\n# \u4e8c\u8fdb\u5236\u6587\u4ef6\u4f4d\u7f6e\nls -lh target/release/shortener-server\n</code></pre>"},{"location":"deployment/DEPLOYMENT/#_14","title":"\u8bbe\u7f6e\u76ee\u5f55","text":"<pre><code># \u521b\u5efa\u76ee\u5f55\nsudo mkdir -p /opt/shortener/config\nsudo mkdir -p /opt/shortener/data\nsudo mkdir -p /opt/shortener/logs\n\n# \u590d\u5236\u6587\u4ef6\nsudo cp target/release/shortener-server /usr/local/bin/\nsudo cp config/config.toml /opt/shortener/config/\n\n# \u8bbe\u7f6e\u6743\u9650\nsudo chown -R shortener:shortener /opt/shortener\n</code></pre>"},{"location":"deployment/DEPLOYMENT/#_15","title":"\u521b\u5efa\u7528\u6237","text":"<pre><code>sudo useradd -r -s /bin/false shortener\n</code></pre>"},{"location":"deployment/DEPLOYMENT/#_16","title":"\u624b\u52a8\u8fd0\u884c","text":"<pre><code># \u4ee5 shortener \u7528\u6237\u8fd0\u884c\nsudo -u shortener /usr/local/bin/shortener-server\n\n# \u6216\u4f7f\u7528\u81ea\u5b9a\u4e49\u914d\u7f6e\nsudo -u shortener /usr/local/bin/shortener-server --config /opt/shortener/config/config.toml\n</code></pre>"},{"location":"deployment/DEPLOYMENT/#_17","title":"\u4e91\u90e8\u7f72","text":""},{"location":"deployment/DEPLOYMENT/#aws","title":"AWS","text":""},{"location":"deployment/DEPLOYMENT/#ec2","title":"EC2 \u90e8\u7f72","text":"<ol> <li>\u542f\u52a8 EC2 \u5b9e\u4f8b\uff08Ubuntu 22.04 LTS\uff09</li> <li>\u5b89\u88c5 Docker\uff1a</li> </ol> <pre><code>sudo apt update\nsudo apt install -y docker.io docker-compose-plugin\nsudo usermod -aG docker ubuntu\n</code></pre> <ol> <li>\u90e8\u7f72\u5e94\u7528\uff1a</li> </ol> <pre><code>git clone https://github.com/jetsung/shortener.git\ncd shortener\ndocker compose up -d\n</code></pre>"},{"location":"deployment/DEPLOYMENT/#rds","title":"RDS \u6570\u636e\u5e93","text":"<pre><code>[database]\ntype = \"postgres\"\n\n[database.postgres]\nhost = \"shortener.xxxxx.us-east-1.rds.amazonaws.com\"\nport = 5432\nuser = \"shortener\"\npassword = \"${DB_PASSWORD}\"\ndatabase = \"shortener\"\nsslmode = \"require\"\n</code></pre>"},{"location":"deployment/DEPLOYMENT/#elasticache-redis","title":"ElastiCache Redis","text":"<pre><code>[cache]\nenabled = true\ntype = \"redis\"\n\n[cache.redis]\nhost = \"shortener.xxxxx.cache.amazonaws.com\"\nport = 6379\npassword = \"${REDIS_PASSWORD}\"\n</code></pre>"},{"location":"deployment/DEPLOYMENT/#google-cloud-platform","title":"Google Cloud Platform","text":""},{"location":"deployment/DEPLOYMENT/#compute-engine","title":"Compute Engine","text":"<p>\u7c7b\u4f3c\u4e8e AWS EC2 \u90e8\u7f72\u3002</p>"},{"location":"deployment/DEPLOYMENT/#cloud-run","title":"Cloud Run","text":"<ol> <li>\u6784\u5efa\u5bb9\u5668\uff1a</li> </ol> <pre><code>gcloud builds submit --tag gcr.io/PROJECT_ID/shortener-server\n</code></pre> <ol> <li>\u90e8\u7f72\u5230 Cloud Run\uff1a</li> </ol> <pre><code>gcloud run deploy shortener-server \\\n  --image gcr.io/PROJECT_ID/shortener-server \\\n  --platform managed \\\n  --region us-central1 \\\n  --allow-unauthenticated\n</code></pre>"},{"location":"deployment/DEPLOYMENT/#_18","title":"\u53cd\u5411\u4ee3\u7406\u8bbe\u7f6e","text":""},{"location":"deployment/DEPLOYMENT/#nginx","title":"Nginx","text":"<pre><code>upstream shortener {\n    server localhost:8080;\n}\n\nserver {\n    listen 80;\n    server_name short.example.com;\n    return 301 https://$server_name$request_uri;\n}\n\nserver {\n    listen 443 ssl http2;\n    server_name short.example.com;\n\n    ssl_certificate /etc/letsencrypt/live/short.example.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/short.example.com/privkey.pem;\n    ssl_protocols TLSv1.2 TLSv1.3;\n\n    location / {\n        proxy_pass http://shortener;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n</code></pre>"},{"location":"deployment/DEPLOYMENT/#caddy","title":"Caddy","text":"<pre><code>short.example.com {\n    reverse_proxy localhost:8080\n}\n</code></pre>"},{"location":"deployment/DEPLOYMENT/#ssltls","title":"SSL/TLS \u914d\u7f6e","text":""},{"location":"deployment/DEPLOYMENT/#lets-encrypt-certbot","title":"Let's Encrypt \u4e0e Certbot","text":"<pre><code># \u5b89\u88c5 Certbot\nsudo apt install certbot python3-certbot-nginx\n\n# \u83b7\u53d6\u8bc1\u4e66\nsudo certbot --nginx -d short.example.com\n\n# \u81ea\u52a8\u7eed\u671f\nsudo certbot renew --dry-run\n</code></pre>"},{"location":"deployment/DEPLOYMENT/#_19","title":"\u76d1\u63a7","text":""},{"location":"deployment/DEPLOYMENT/#_20","title":"\u5065\u5eb7\u68c0\u67e5","text":"<pre><code># \u68c0\u67e5\u670d\u52a1\u5668\u662f\u5426\u8fd0\u884c\ncurl http://localhost:8080/health\n</code></pre>"},{"location":"deployment/DEPLOYMENT/#_21","title":"\u65e5\u5fd7","text":"<pre><code># \u67e5\u770b\u65e5\u5fd7\uff08Docker\uff09\ndocker compose logs -f shortener-server\n\n# \u67e5\u770b\u65e5\u5fd7\uff08Systemd\uff09\nsudo journalctl -u shortener-server -f\n\n# \u67e5\u770b\u65e5\u5fd7\uff08\u624b\u52a8\uff09\ntail -f /var/log/shortener/shortener.log\n</code></pre>"},{"location":"deployment/DEPLOYMENT/#_22","title":"\u5907\u4efd\u548c\u6062\u590d","text":""},{"location":"deployment/DEPLOYMENT/#_23","title":"\u6570\u636e\u5e93\u5907\u4efd","text":""},{"location":"deployment/DEPLOYMENT/#postgresql","title":"PostgreSQL","text":"<pre><code># \u5907\u4efd\npg_dump -U shortener -h localhost shortener &gt; backup.sql\n\n# \u6062\u590d\npsql -U shortener -h localhost shortener &lt; backup.sql\n</code></pre>"},{"location":"deployment/DEPLOYMENT/#mysql","title":"MySQL","text":"<pre><code># \u5907\u4efd\nmysqldump -u shortener -p shortener &gt; backup.sql\n\n# \u6062\u590d\nmysql -u shortener -p shortener &lt; backup.sql\n</code></pre>"},{"location":"deployment/DEPLOYMENT/#sqlite","title":"SQLite","text":"<pre><code># \u5907\u4efd\nsqlite3 /opt/shortener/data/shortener.db \".backup backup.db\"\n\n# \u6062\u590d\ncp backup.db /opt/shortener/data/shortener.db\nsudo chown shortener:shortener /opt/shortener/data/shortener.db\n</code></pre>"},{"location":"deployment/DEPLOYMENT/#_24","title":"\u914d\u7f6e\u548c\u6570\u636e\u5907\u4efd","text":"<pre><code># \u5907\u4efd\u6574\u4e2a shortener \u76ee\u5f55\nsudo tar czf shortener-backup-$(date +%Y%m%d).tar.gz /opt/shortener/\n\n# \u6062\u590d\nsudo tar xzf shortener-backup-20250117.tar.gz -C /\nsudo chown -R shortener:shortener /opt/shortener\n</code></pre>"},{"location":"deployment/DEPLOYMENT/#_25","title":"\u6545\u969c\u6392\u9664","text":""},{"location":"deployment/DEPLOYMENT/#_26","title":"\u670d\u52a1\u5668\u65e0\u6cd5\u542f\u52a8","text":"<ol> <li> <p>\u68c0\u67e5\u914d\u7f6e\uff1a <pre><code>shortener-server --config /opt/shortener/config/config.toml --check\n</code></pre></p> </li> <li> <p>\u68c0\u67e5\u65e5\u5fd7\uff1a <pre><code>sudo journalctl -u shortener-server -n 50\n</code></pre></p> </li> <li> <p>\u68c0\u67e5\u7aef\u53e3\u53ef\u7528\u6027\uff1a <pre><code>sudo lsof -i :8080\n</code></pre></p> </li> </ol>"},{"location":"deployment/DEPLOYMENT/#_27","title":"\u6570\u636e\u5e93\u8fde\u63a5\u95ee\u9898","text":"<ol> <li> <p>\u6d4b\u8bd5\u8fde\u63a5\uff1a <pre><code># PostgreSQL\npsql -U shortener -h localhost -d shortener\n\n# MySQL\nmysql -u shortener -h localhost -p shortener\n</code></pre></p> </li> <li> <p>\u68c0\u67e5\u9632\u706b\u5899\uff1a <pre><code>sudo ufw status\n</code></pre></p> </li> </ol>"},{"location":"deployment/DEPLOYMENT/#_28","title":"\u7f13\u5b58\u8fde\u63a5\u95ee\u9898","text":"<ol> <li> <p>\u6d4b\u8bd5 Redis \u8fde\u63a5\uff1a <pre><code>redis-cli -h localhost -p 6379 ping\n</code></pre></p> </li> <li> <p>\u68c0\u67e5 Redis \u65e5\u5fd7\uff1a <pre><code>sudo journalctl -u redis -f\n</code></pre></p> </li> </ol>"},{"location":"deployment/DEPLOYMENT/#_29","title":"\u6700\u4f73\u5b9e\u8df5","text":"<ol> <li>\u751f\u4ea7\u73af\u5883\u4f7f\u7528 HTTPS</li> <li>\u542f\u7528\u7f13\u5b58\u4ee5\u83b7\u5f97\u66f4\u597d\u7684\u6027\u80fd</li> <li>\u5b9a\u671f\u5907\u4efd\u6570\u636e\u5e93\u548c\u914d\u7f6e</li> <li>\u76d1\u63a7\u670d\u52a1\u5668\u5065\u5eb7\u548c\u6027\u80fd</li> <li>\u4f7f\u7528\u73af\u5883\u53d8\u91cf\u5b58\u50a8\u5bc6\u94a5</li> <li>\u4fdd\u6301\u8f6f\u4ef6\u66f4\u65b0\uff08\u5b89\u5168\u8865\u4e01\uff09</li> <li>\u4f7f\u7528\u53cd\u5411\u4ee3\u7406\uff08Nginx/Caddy\uff09</li> <li>\u8bbe\u7f6e\u65e5\u5fd7\u8f6e\u8f6c</li> <li>\u6b63\u786e\u914d\u7f6e\u9632\u706b\u5899</li> <li>\u6d4b\u8bd5\u707e\u96be\u6062\u590d\u7a0b\u5e8f</li> </ol>"},{"location":"deployment/DEPLOYMENT/#_30","title":"\u5b89\u5168\u68c0\u67e5\u6e05\u5355","text":"<ul> <li>[ ] \u542f\u7528 HTTPS \u5e76\u4f7f\u7528\u6709\u6548\u8bc1\u4e66</li> <li>[ ] \u4f7f\u7528\u5f3a API \u5bc6\u94a5\u548c\u7ba1\u7406\u5458\u5bc6\u7801</li> <li>[ ] \u914d\u7f6e\u9632\u706b\u5899\uff08\u4ec5\u5f00\u653e\u5fc5\u8981\u7aef\u53e3\uff09</li> <li>[ ] \u6570\u636e\u5e93\u4e0d\u66b4\u9732\u5230\u4e92\u8054\u7f51</li> <li>[ ] Redis/Valkey \u5bc6\u7801\u4fdd\u62a4</li> <li>[ ] \u5b9a\u671f\u5b89\u5168\u66f4\u65b0</li> <li>[ ] \u542f\u7528\u65e5\u5fd7\u76d1\u63a7</li> <li>[ ] \u542f\u7528\u5907\u4efd\u52a0\u5bc6</li> <li>[ ] \u914d\u7f6e\u901f\u7387\u9650\u5236\uff08\u53cd\u5411\u4ee3\u7406\uff09</li> <li>[ ] \u914d\u7f6e\u5b89\u5168\u5934\uff08\u53cd\u5411\u4ee3\u7406\uff09</li> </ul>"},{"location":"deployment/DEPLOYMENT/#_31","title":"\u53e6\u89c1","text":"<ul> <li>Docker \u90e8\u7f72</li> <li>DEB \u5305\u5b89\u88c5</li> <li>\u914d\u7f6e\u6307\u5357</li> <li>API \u6587\u6863</li> </ul>"},{"location":"deployment/DOCKER/","title":"Docker \u90e8\u7f72\u6307\u5357","text":"<p>\u672c\u6307\u5357\u8bf4\u660e\u5982\u4f55\u4f7f\u7528 Docker \u548c Docker Compose \u90e8\u7f72 Shortener \u670d\u52a1\u5668\u3002</p>"},{"location":"deployment/DOCKER/#_1","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"deployment/DOCKER/#sqlite-redis","title":"\u5f00\u53d1\u73af\u5883\uff08SQLite + Redis\uff09","text":"<pre><code># \u6784\u5efa\u5e76\u8fd0\u884c\ndocker compose -f docker/docker-compose.dev.yml up -d\n\n# \u67e5\u770b\u65e5\u5fd7\ndocker compose -f docker/docker-compose.dev.yml logs -f\n\n# \u505c\u6b62\ndocker compose -f docker/docker-compose.dev.yml down\n</code></pre>"},{"location":"deployment/DOCKER/#postgresql-redis","title":"\u751f\u4ea7\u73af\u5883\uff08PostgreSQL + Redis\uff09","text":"<pre><code># \u6784\u5efa\u5e76\u8fd0\u884c\ndocker compose -f docker/docker-compose.yml up -d\n\n# \u67e5\u770b\u65e5\u5fd7\ndocker compose -f docker/docker-compose.yml logs -f\n\n# \u505c\u6b62\ndocker compose -f docker/docker-compose.yml down\n</code></pre>"},{"location":"deployment/DOCKER/#docker_1","title":"Docker \u955c\u50cf","text":""},{"location":"deployment/DOCKER/#debian","title":"\u6807\u51c6\u955c\u50cf\uff08\u57fa\u4e8e Debian\uff09","text":"<pre><code>docker build -f docker/Dockerfile -t shortener-server:latest .\n</code></pre> <ul> <li>\u57fa\u7840\u955c\u50cf\uff1a<code>debian:trixie-slim</code></li> <li>\u5927\u5c0f\uff1a\u7ea6 150MB</li> <li>\u9002\u7528\u4e8e\uff1a\u901a\u7528\u573a\u666f\uff0c\u517c\u5bb9\u6027\u597d</li> </ul>"},{"location":"deployment/DOCKER/#alpine","title":"Alpine \u955c\u50cf\uff08\u66f4\u5c0f\uff09","text":"<pre><code>docker build -f docker/Dockerfile.alpine -t shortener-server:alpine .\n</code></pre> <ul> <li>\u57fa\u7840\u955c\u50cf\uff1a<code>alpine:3.19</code></li> <li>\u5927\u5c0f\uff1a\u7ea6 50MB</li> <li>\u9002\u7528\u4e8e\uff1a\u751f\u4ea7\u73af\u5883\uff0c\u6700\u5c0f\u5316\u5360\u7528</li> </ul>"},{"location":"deployment/DOCKER/#docker-bake","title":"\u4f7f\u7528 Docker Bake","text":"<p>Docker Bake \u63d0\u4f9b\u4e86\u66f4\u5f3a\u5927\u7684\u6784\u5efa\u914d\u7f6e\u3002</p>"},{"location":"deployment/DOCKER/#_2","title":"\u672c\u5730\u6784\u5efa","text":"<pre><code># \u6784\u5efa\u9ed8\u8ba4\u955c\u50cf\ndocker buildx bake\n\n# \u6784\u5efa\u5f00\u53d1\u955c\u50cf\uff08amd64\uff09\ndocker buildx bake dev-amd64\n\n# \u6784\u5efa\u5f00\u53d1\u955c\u50cf\uff08arm64\uff09\ndocker buildx bake dev-arm64\n\n# \u6784\u5efa\u6240\u6709\u5f00\u53d1\u955c\u50cf\ndocker buildx bake dev\n</code></pre>"},{"location":"deployment/DOCKER/#_3","title":"\u53d1\u5e03\u6784\u5efa","text":"<pre><code># \u6784\u5efa\u591a\u5e73\u53f0\u53d1\u5e03\u955c\u50cf\ndocker buildx bake release\n\n# \u8fd9\u5c06\u6784\u5efa linux/amd64 \u548c linux/arm64 \u5e73\u53f0\u7684\u955c\u50cf\n</code></pre>"},{"location":"deployment/DOCKER/#_4","title":"\u81ea\u5b9a\u4e49\u6784\u5efa","text":"<pre><code># \u4f7f\u7528\u81ea\u5b9a\u4e49\u6807\u7b7e\ndocker buildx bake --set \"*.tags=myregistry/shortener:v1.0.0\"\n\n# \u63a8\u9001\u5230\u4ed3\u5e93\ndocker buildx bake --push release\n\n# \u8bbe\u7f6e\u5e73\u53f0\ndocker buildx bake --set \"*.platform=linux/amd64,linux/arm64,linux/arm/v7\"\n</code></pre>"},{"location":"deployment/DOCKER/#_5","title":"\u914d\u7f6e","text":""},{"location":"deployment/DOCKER/#_6","title":"\u73af\u5883\u53d8\u91cf","text":"<p>\u53ef\u4ee5\u5728 <code>docker-compose.yml</code> \u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u73af\u5883\u53d8\u91cf\uff1a</p>"},{"location":"deployment/DOCKER/#_7","title":"\u670d\u52a1\u5668\u914d\u7f6e","text":"<ul> <li><code>RUST_LOG</code>\uff1a\u65e5\u5fd7\u7ea7\u522b\uff08debug\u3001info\u3001warn\u3001error\uff09</li> <li><code>CONFIG_PATH</code>\uff1a\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\uff08\u9ed8\u8ba4\uff1a<code>/app/config.toml</code>\uff09</li> </ul>"},{"location":"deployment/DOCKER/#_8","title":"\u6570\u636e\u5e93\u914d\u7f6e","text":"<ul> <li><code>DATABASE_TYPE</code>\uff1a\u6570\u636e\u5e93\u7c7b\u578b\uff08sqlite\u3001postgres\u3001mysql\uff09</li> <li><code>DATABASE_HOST</code>\uff1a\u6570\u636e\u5e93\u4e3b\u673a</li> <li><code>DATABASE_PORT</code>\uff1a\u6570\u636e\u5e93\u7aef\u53e3</li> <li><code>DATABASE_NAME</code>\uff1a\u6570\u636e\u5e93\u540d\u79f0</li> <li><code>DATABASE_USER</code>\uff1a\u6570\u636e\u5e93\u7528\u6237</li> <li><code>DATABASE_PASSWORD</code>\uff1a\u6570\u636e\u5e93\u5bc6\u7801</li> <li><code>DATABASE_PATH</code>\uff1aSQLite \u6570\u636e\u5e93\u8def\u5f84</li> </ul>"},{"location":"deployment/DOCKER/#_9","title":"\u7f13\u5b58\u914d\u7f6e","text":"<ul> <li><code>CACHE_ENABLED</code>\uff1a\u542f\u7528\u7f13\u5b58\uff08true/false\uff09</li> <li><code>CACHE_TYPE</code>\uff1a\u7f13\u5b58\u7c7b\u578b\uff08redis\u3001valkey\uff09</li> <li><code>CACHE_HOST</code>\uff1a\u7f13\u5b58\u4e3b\u673a</li> <li><code>CACHE_PORT</code>\uff1a\u7f13\u5b58\u7aef\u53e3</li> <li><code>CACHE_PASSWORD</code>\uff1a\u7f13\u5b58\u5bc6\u7801</li> </ul>"},{"location":"deployment/DOCKER/#geoip","title":"GeoIP \u914d\u7f6e","text":"<ul> <li><code>GEOIP_ENABLED</code>\uff1a\u542f\u7528 GeoIP\uff08true/false\uff09</li> <li><code>GEOIP_DB_PATH</code>\uff1aip2region \u6570\u636e\u5e93\u8def\u5f84</li> </ul>"},{"location":"deployment/DOCKER/#_10","title":"\u5377\u6302\u8f7d","text":"<pre><code>volumes:\n  - ../config/config.docker.toml:/app/config.toml:ro # \u914d\u7f6e\u6587\u4ef6\n  - ../data:/app/data # \u6570\u636e\u6587\u4ef6\uff08\u6570\u636e\u5e93\u3001GeoIP\u7b49\uff09\n  - app-logs:/app/logs # \u65e5\u5fd7\n</code></pre>"},{"location":"deployment/DOCKER/#makefile","title":"Makefile \u547d\u4ee4","text":"<p>\u4ece\u9879\u76ee\u6839\u76ee\u5f55\u8fd0\u884c\uff1a</p> <pre><code># \u6784\u5efa\u955c\u50cf\nmake build          # Debian \u7248\u672c\nmake build-alpine   # Alpine \u7248\u672c\n\n# \u8fd0\u884c\u670d\u52a1\nmake run            # \u751f\u4ea7\u73af\u5883\uff08PostgreSQL\uff09\nmake run-dev        # \u5f00\u53d1\u73af\u5883\uff08SQLite\uff09\nmake run-mysql      # \u751f\u4ea7\u73af\u5883\uff08MySQL\uff09\n\n# \u7ba1\u7406\u670d\u52a1\nmake stop           # \u505c\u6b62\u6240\u6709\u5bb9\u5668\nmake clean          # \u5220\u9664\u5bb9\u5668\u548c\u5377\nmake logs           # \u67e5\u770b\u6240\u6709\u65e5\u5fd7\nmake logs-server    # \u4ec5\u67e5\u770b\u670d\u52a1\u5668\u65e5\u5fd7\n\n# \u6d4b\u8bd5\nmake test           # \u5728 Docker \u4e2d\u8fd0\u884c\u6d4b\u8bd5\n\n# \u63a8\u9001\u5230\u4ed3\u5e93\nmake docker-push REGISTRY=docker.io/yourusername TAG=v1.0.0\n</code></pre>"},{"location":"deployment/DOCKER/#just","title":"Just \u547d\u4ee4","text":"<p>\u6216\u8005\u4f7f\u7528 <code>just</code> \u547d\u4ee4\uff08\u4ece\u9879\u76ee\u6839\u76ee\u5f55\u8fd0\u884c\uff09\uff1a</p> <pre><code># \u6784\u5efa\u955c\u50cf\njust docker-build          # Debian \u7248\u672c\njust docker-build-alpine   # Alpine \u7248\u672c\n\n# \u8fd0\u884c\u670d\u52a1\njust docker-run            # \u751f\u4ea7\u73af\u5883\uff08PostgreSQL\uff09\njust docker-run-dev        # \u5f00\u53d1\u73af\u5883\uff08SQLite\uff09\n\n# \u7ba1\u7406\u670d\u52a1\njust docker-stop           # \u505c\u6b62\u6240\u6709\u5bb9\u5668\njust docker-logs           # \u67e5\u770b\u65e5\u5fd7\n</code></pre>"},{"location":"deployment/DOCKER/#_11","title":"\u5065\u5eb7\u68c0\u67e5","text":"<p>\u670d\u52a1\u5668\u5305\u542b\u5065\u5eb7\u68c0\u67e5\uff1a</p> <pre><code>healthcheck:\n  test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8080/health\"]\n  interval: 30s\n  timeout: 3s\n  retries: 3\n  start_period: 10s\n</code></pre>"},{"location":"deployment/DOCKER/#_12","title":"\u7f51\u7edc","text":"<p>\u6240\u6709\u670d\u52a1\u8fd0\u884c\u5728\u81ea\u5b9a\u4e49\u6865\u63a5\u7f51\u7edc <code>shortener-network</code> \u4e2d\uff1a</p> <pre><code>networks:\n  shortener-network:\n    driver: bridge\n</code></pre> <p>\u670d\u52a1\u53ef\u4ee5\u4f7f\u7528\u670d\u52a1\u540d\u79f0\u76f8\u4e92\u901a\u4fe1\uff1a</p> <ul> <li><code>shortener-server</code>\uff1a\u4e3b\u5e94\u7528</li> <li><code>postgres</code>\uff1aPostgreSQL \u6570\u636e\u5e93</li> <li><code>mysql</code>\uff1aMySQL \u6570\u636e\u5e93</li> <li><code>redis</code>\uff1aRedis \u7f13\u5b58</li> </ul>"},{"location":"deployment/DOCKER/#_13","title":"\u6570\u636e\u6301\u4e45\u5316","text":"<p>\u4f7f\u7528 Docker \u5377\u6301\u4e45\u5316\u6570\u636e\uff1a</p> <ul> <li><code>postgres-data</code>\uff1aPostgreSQL \u6570\u636e</li> <li><code>mysql-data</code>\uff1aMySQL \u6570\u636e</li> <li><code>redis-data</code>\uff1aRedis \u6570\u636e</li> <li><code>app-logs</code>\uff1a\u5e94\u7528\u65e5\u5fd7</li> <li><code>/app/data</code>\uff1a\u5e94\u7528\u6570\u636e\uff08SQLite \u6570\u636e\u5e93\u3001GeoIP \u6570\u636e\u5e93\u7b49\uff09</li> </ul>"},{"location":"deployment/DOCKER/#_14","title":"\u5b89\u5168\u8003\u8651","text":""},{"location":"deployment/DOCKER/#root","title":"\u975e root \u7528\u6237","text":"<p>\u5bb9\u5668\u4ee5\u975e root \u7528\u6237\u8fd0\u884c\uff08<code>shortener</code>\uff0cUID 1000\uff09\uff1a</p> <pre><code>USER shortener\n</code></pre>"},{"location":"deployment/DOCKER/#_15","title":"\u5bc6\u94a5\u7ba1\u7406","text":"<p>\u751f\u4ea7\u73af\u5883\u4f7f\u7528 Docker secrets \u6216\u73af\u5883\u6587\u4ef6\uff1a</p> <pre><code># \u521b\u5efa .env \u6587\u4ef6\ncat &gt; .env &lt;&lt; EOF\nDATABASE_PASSWORD=your_secure_password\nCACHE_PASSWORD=your_redis_password\nAPI_KEY=your_api_key\nEOF\n\n# \u4f7f\u7528 docker compose\ndocker compose --env-file .env up -d\n</code></pre>"},{"location":"deployment/DOCKER/#_16","title":"\u7f51\u7edc\u9694\u79bb","text":"<p>\u4ec5\u66b4\u9732\u5fc5\u8981\u7684\u7aef\u53e3\uff1a</p> <pre><code>ports:\n  - \"8080:8080\" # \u4ec5\u66b4\u9732\u670d\u52a1\u5668\u7aef\u53e3\n</code></pre> <p>\u751f\u4ea7\u73af\u5883\u4e0d\u5e94\u66b4\u9732\u6570\u636e\u5e93\u548c\u7f13\u5b58\u7aef\u53e3\u3002</p>"},{"location":"deployment/DOCKER/#_17","title":"\u6545\u969c\u6392\u9664","text":""},{"location":"deployment/DOCKER/#_18","title":"\u67e5\u770b\u65e5\u5fd7","text":"<pre><code># \u6240\u6709\u670d\u52a1\ndocker compose -f docker/docker-compose.yml logs -f\n\n# \u7279\u5b9a\u670d\u52a1\ndocker compose -f docker/docker-compose.yml logs -f shortener-server\ndocker compose -f docker/docker-compose.yml logs -f postgres\ndocker compose -f docker/docker-compose.yml logs -f redis\n</code></pre>"},{"location":"deployment/DOCKER/#_19","title":"\u68c0\u67e5\u5bb9\u5668\u72b6\u6001","text":"<pre><code>docker compose -f docker/docker-compose.yml ps\n</code></pre>"},{"location":"deployment/DOCKER/#_20","title":"\u5728\u5bb9\u5668\u4e2d\u6267\u884c\u547d\u4ee4","text":"<pre><code># Shell \u8bbf\u95ee\ndocker compose -f docker/docker-compose.yml exec shortener-server sh\n\n# \u68c0\u67e5\u914d\u7f6e\ndocker compose -f docker/docker-compose.yml exec shortener-server cat /app/config.toml\n\n# \u68c0\u67e5\u6570\u636e\u5e93\u8fde\u63a5\ndocker compose -f docker/docker-compose.yml exec postgres psql -U shortener -d shortener\n</code></pre>"},{"location":"deployment/DOCKER/#_21","title":"\u66f4\u6539\u540e\u91cd\u65b0\u6784\u5efa","text":"<pre><code># \u91cd\u65b0\u6784\u5efa\u5e76\u91cd\u542f\ndocker compose -f docker/docker-compose.yml up -d --build\n\n# \u5f3a\u5236\u91cd\u65b0\u521b\u5efa\ndocker compose -f docker/docker-compose.yml up -d --force-recreate\n</code></pre>"},{"location":"deployment/DOCKER/#_22","title":"\u6e05\u7406","text":"<pre><code># \u505c\u6b62\u5e76\u5220\u9664\u5bb9\u5668\ndocker compose -f docker/docker-compose.yml down\n\n# \u540c\u65f6\u5220\u9664\u5377\ndocker compose -f docker/docker-compose.yml down -v\n\n# \u5220\u9664\u6240\u6709\u672a\u4f7f\u7528\u7684 Docker \u8d44\u6e90\ndocker system prune -a\n</code></pre>"},{"location":"deployment/DOCKER/#_23","title":"\u751f\u4ea7\u90e8\u7f72","text":""},{"location":"deployment/DOCKER/#1","title":"1. \u51c6\u5907\u914d\u7f6e","text":"<pre><code># \u590d\u5236\u5e76\u7f16\u8f91\u914d\u7f6e\ncp config/config.toml config/production.toml\nvim config/production.toml\n</code></pre>"},{"location":"deployment/DOCKER/#2","title":"2. \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf","text":"<pre><code># \u521b\u5efa\u751f\u4ea7\u73af\u5883\u6587\u4ef6\ncat &gt; .env.production &lt;&lt; EOF\nRUST_LOG=info\nDATABASE_TYPE=postgres\nDATABASE_HOST=postgres\nDATABASE_PORT=5432\nDATABASE_NAME=shortener\nDATABASE_USER=shortener\nDATABASE_PASSWORD=$(openssl rand -base64 32)\nCACHE_ENABLED=true\nCACHE_TYPE=redis\nCACHE_HOST=redis\nCACHE_PORT=6379\nCACHE_PASSWORD=$(openssl rand -base64 32)\nAPI_KEY=$(openssl rand -base64 32)\nEOF\n</code></pre>"},{"location":"deployment/DOCKER/#3","title":"3. \u90e8\u7f72","text":"<pre><code># \u6784\u5efa\u5e76\u542f\u52a8\ndocker compose -f docker/docker-compose.yml --env-file .env.production up -d\n\n# \u9a8c\u8bc1\ndocker compose -f docker/docker-compose.yml ps\ndocker compose -f docker/docker-compose.yml logs -f shortener-server\n</code></pre>"},{"location":"deployment/DOCKER/#4","title":"4. \u5907\u4efd","text":"<pre><code># \u5907\u4efd PostgreSQL\ndocker compose -f docker/docker-compose.yml exec postgres pg_dump -U shortener shortener &gt; backup.sql\n\n# \u5907\u4efd\u5377\ndocker run --rm -v shortener_postgres-data:/data -v $(pwd):/backup \\\n  alpine tar czf /backup/postgres-backup.tar.gz /data\n</code></pre>"},{"location":"deployment/DOCKER/#_24","title":"\u53c2\u8003","text":"<ul> <li>Docker \u6587\u6863</li> <li>Docker Compose \u6587\u6863</li> <li>Docker Buildx Bake</li> </ul>"},{"location":"deployment/DOCKER_ADVANCED/","title":"Docker \u90e8\u7f72\u6307\u5357","text":"<p>\u672c\u6587\u6863\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 Docker \u548c Docker Compose \u90e8\u7f72 Shortener URL \u77ed\u94fe\u63a5\u670d\u52a1\u3002</p>"},{"location":"deployment/DOCKER_ADVANCED/#_1","title":"\u76ee\u5f55","text":"<ul> <li>\u5feb\u901f\u5f00\u59cb</li> <li>Docker Compose \u90e8\u7f72</li> <li>\u5355\u72ec\u4f7f\u7528 Docker</li> <li>\u6570\u636e\u5e93\u914d\u7f6e</li> <li>\u73af\u5883\u53d8\u91cf</li> <li>\u6570\u636e\u6301\u4e45\u5316</li> <li>\u5065\u5eb7\u68c0\u67e5</li> <li>\u6545\u969c\u6392\u67e5</li> </ul>"},{"location":"deployment/DOCKER_ADVANCED/#_2","title":"\u5feb\u901f\u5f00\u59cb","text":"<p>\u4f7f\u7528 Docker Compose \u5feb\u901f\u542f\u52a8\u5b8c\u6574\u7684\u670d\u52a1\u6808\uff08\u5305\u62ec PostgreSQL \u548c Redis\uff09\uff1a</p> <pre><code># \u514b\u9686\u4ed3\u5e93\ngit clone https://github.com/jetsung/shortener.git\ncd shortener\n\n# \u4f7f\u7528 Docker Compose \u542f\u52a8\u670d\u52a1\ndocker compose -f docker/docker-compose.yml up -d\n\n# \u67e5\u770b\u65e5\u5fd7\ndocker compose -f docker/docker-compose.yml logs -f shortener-server\n\n# \u505c\u6b62\u670d\u52a1\ndocker compose -f docker/docker-compose.yml down\n</code></pre> <p>\u670d\u52a1\u542f\u52a8\u540e\uff0c\u8bbf\u95ee http://localhost:8080 \u5373\u53ef\u4f7f\u7528\u3002</p>"},{"location":"deployment/DOCKER_ADVANCED/#docker-compose","title":"Docker Compose \u90e8\u7f72","text":""},{"location":"deployment/DOCKER_ADVANCED/#_3","title":"\u5b8c\u6574\u670d\u52a1\u6808\uff08\u63a8\u8350\uff09","text":"<p>\u4f7f\u7528 <code>docker-compose.yml</code> \u90e8\u7f72\u5305\u542b PostgreSQL \u548c Redis \u7684\u5b8c\u6574\u670d\u52a1\uff1a</p> <pre><code>docker compose -f docker/docker-compose.yml up -d\n</code></pre> <p>\u8be5\u914d\u7f6e\u5305\u542b\uff1a - shortener-server: URL \u77ed\u94fe\u63a5\u670d\u52a1\uff08\u7aef\u53e3 8080\uff09 - postgres: PostgreSQL \u6570\u636e\u5e93\uff08\u7aef\u53e3 5432\uff09 - redis: Redis \u7f13\u5b58\uff08\u7aef\u53e3 6379\uff09</p>"},{"location":"deployment/DOCKER_ADVANCED/#sqlite","title":"\u4f7f\u7528 SQLite\uff08\u8f7b\u91cf\u7ea7\u90e8\u7f72\uff09","text":"<p>\u5982\u679c\u4e0d\u9700\u8981 PostgreSQL\uff0c\u53ef\u4ee5\u4f7f\u7528 SQLite\uff1a</p> <pre><code>services:\n  shortener-server:\n    image: jetsung/shortener-server:latest\n    container_name: shortener-server\n    restart: unless-stopped\n    ports:\n      - \"8080:8080\"\n    environment:\n      - RUST_LOG=info\n      - DATABASE_TYPE=sqlite\n      - DATABASE_PATH=/var/lib/shortener/shortener.db\n      - CACHE_ENABLED=false\n      - GEOIP_ENABLED=true\n    volumes:\n      - ./config/config.toml:/etc/shortener/config.toml:ro\n      - ./data:/var/lib/shortener\n      - shortener-logs:/var/log/shortener\n\nvolumes:\n  shortener-logs:\n</code></pre>"},{"location":"deployment/DOCKER_ADVANCED/#mysql","title":"\u4f7f\u7528 MySQL","text":"<p>\u5982\u679c\u9700\u8981\u4f7f\u7528 MySQL \u800c\u4e0d\u662f PostgreSQL\uff1a</p> <pre><code># \u542f\u52a8 MySQL \u914d\u7f6e\ndocker compose -f docker/docker-compose.yml --profile mysql up -d\n</code></pre> <p>\u6216\u4fee\u6539 <code>docker-compose.yml</code> \u4e2d\u7684\u73af\u5883\u53d8\u91cf\uff1a</p> <pre><code>environment:\n  - DATABASE_TYPE=mysql\n  - DATABASE_HOST=mysql\n  - DATABASE_PORT=3306\n  - DATABASE_NAME=shortener\n  - DATABASE_USER=shortener\n  - DATABASE_PASSWORD=shortener_password\n</code></pre>"},{"location":"deployment/DOCKER_ADVANCED/#_4","title":"\u5f00\u53d1\u73af\u5883","text":"<p>\u4f7f\u7528 <code>docker-compose.dev.yml</code> \u8fdb\u884c\u5f00\u53d1\uff1a</p> <pre><code>docker compose -f docker/docker-compose.dev.yml up -d\n</code></pre> <p>\u5f00\u53d1\u73af\u5883\u914d\u7f6e\u5305\u542b\uff1a - \u70ed\u91cd\u8f7d\u652f\u6301 - \u8be6\u7ec6\u7684\u65e5\u5fd7\u8f93\u51fa - \u5f00\u53d1\u5de5\u5177\u96c6\u6210</p>"},{"location":"deployment/DOCKER_ADVANCED/#docker_1","title":"\u5355\u72ec\u4f7f\u7528 Docker","text":""},{"location":"deployment/DOCKER_ADVANCED/#_5","title":"\u6784\u5efa\u955c\u50cf","text":"<pre><code># \u4ece\u9879\u76ee\u6839\u76ee\u5f55\u6784\u5efa\ndocker build -f docker/Dockerfile -t shortener-server:latest .\n\n# \u4f7f\u7528 Alpine \u57fa\u7840\u955c\u50cf\uff08\u66f4\u5c0f\u7684\u955c\u50cf\u4f53\u79ef\uff09\ndocker build -f docker/Dockerfile.alpine -t shortener-server:alpine .\n</code></pre>"},{"location":"deployment/DOCKER_ADVANCED/#_6","title":"\u8fd0\u884c\u5bb9\u5668","text":"<pre><code># \u4f7f\u7528 SQLite\uff08\u6700\u7b80\u5355\uff09\ndocker run -d \\\n  --name shortener-server \\\n  -p 8080:8080 \\\n  -v $(pwd)/config/config.toml:/etc/shortener/config.toml:ro \\\n  -v $(pwd)/data:/var/lib/shortener \\\n  -e RUST_LOG=info \\\n  -e DATABASE_TYPE=sqlite \\\n  shortener-server:latest\n\n# \u8fde\u63a5\u5230\u5916\u90e8 PostgreSQL\ndocker run -d \\\n  --name shortener-server \\\n  -p 8080:8080 \\\n  -v $(pwd)/config/config.toml:/etc/shortener/config.toml:ro \\\n  -e RUST_LOG=info \\\n  -e DATABASE_TYPE=postgres \\\n  -e DATABASE_HOST=your-postgres-host \\\n  -e DATABASE_PORT=5432 \\\n  -e DATABASE_NAME=shortener \\\n  -e DATABASE_USER=shortener \\\n  -e DATABASE_PASSWORD=your-password \\\n  shortener-server:latest\n</code></pre>"},{"location":"deployment/DOCKER_ADVANCED/#_7","title":"\u6570\u636e\u5e93\u914d\u7f6e","text":""},{"location":"deployment/DOCKER_ADVANCED/#postgresql","title":"PostgreSQL\uff08\u63a8\u8350\u7528\u4e8e\u751f\u4ea7\u73af\u5883\uff09","text":"<pre><code>services:\n  shortener-server:\n    environment:\n      - DATABASE_TYPE=postgres\n      - DATABASE_HOST=postgres\n      - DATABASE_PORT=5432\n      - DATABASE_NAME=shortener\n      - DATABASE_USER=shortener\n      - DATABASE_PASSWORD=shortener_password\n    depends_on:\n      postgres:\n        condition: service_healthy\n\n  postgres:\n    image: postgres:16-alpine\n    environment:\n      - POSTGRES_DB=shortener\n      - POSTGRES_USER=shortener\n      - POSTGRES_PASSWORD=shortener_password\n    volumes:\n      - postgres-data:/var/lib/postgresql/data\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U shortener\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n</code></pre>"},{"location":"deployment/DOCKER_ADVANCED/#mysql_1","title":"MySQL","text":"<pre><code>services:\n  shortener-server:\n    environment:\n      - DATABASE_TYPE=mysql\n      - DATABASE_HOST=mysql\n      - DATABASE_PORT=3306\n      - DATABASE_NAME=shortener\n      - DATABASE_USER=shortener\n      - DATABASE_PASSWORD=shortener_password\n    depends_on:\n      mysql:\n        condition: service_healthy\n\n  mysql:\n    image: mysql:8.0\n    environment:\n      - MYSQL_ROOT_PASSWORD=root_password\n      - MYSQL_DATABASE=shortener\n      - MYSQL_USER=shortener\n      - MYSQL_PASSWORD=shortener_password\n    volumes:\n      - mysql-data:/var/lib/mysql\n    healthcheck:\n      test: [\"CMD\", \"mysqladmin\", \"ping\", \"-h\", \"localhost\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n</code></pre>"},{"location":"deployment/DOCKER_ADVANCED/#sqlite_1","title":"SQLite\uff08\u9002\u5408\u5c0f\u89c4\u6a21\u90e8\u7f72\uff09","text":"<pre><code>services:\n  shortener-server:\n    environment:\n      - DATABASE_TYPE=sqlite\n      - DATABASE_PATH=/var/lib/shortener/shortener.db\n    volumes:\n      - ./data:/var/lib/shortener\n</code></pre>"},{"location":"deployment/DOCKER_ADVANCED/#_8","title":"\u73af\u5883\u53d8\u91cf","text":""},{"location":"deployment/DOCKER_ADVANCED/#_9","title":"\u670d\u52a1\u5668\u914d\u7f6e","text":"\u53d8\u91cf\u540d \u8bf4\u660e \u9ed8\u8ba4\u503c <code>RUST_LOG</code> \u65e5\u5fd7\u7ea7\u522b <code>info</code> <code>CONFIG_PATH</code> \u914d\u7f6e\u6587\u4ef6\u8def\u5f84 <code>/etc/shortener/config.toml</code> <code>SERVER_ADDRESS</code> \u76d1\u542c\u5730\u5740 <code>0.0.0.0:8080</code> <code>SITE_URL</code> \u7ad9\u70b9 URL <code>http://localhost:8080</code>"},{"location":"deployment/DOCKER_ADVANCED/#_10","title":"\u6570\u636e\u5e93\u914d\u7f6e","text":"\u53d8\u91cf\u540d \u8bf4\u660e \u9ed8\u8ba4\u503c <code>DATABASE_TYPE</code> \u6570\u636e\u5e93\u7c7b\u578b\uff08sqlite/postgres/mysql\uff09 <code>postgres</code> <code>DATABASE_HOST</code> \u6570\u636e\u5e93\u4e3b\u673a <code>localhost</code> <code>DATABASE_PORT</code> \u6570\u636e\u5e93\u7aef\u53e3 <code>5432</code> <code>DATABASE_NAME</code> \u6570\u636e\u5e93\u540d\u79f0 <code>shortener</code> <code>DATABASE_USER</code> \u6570\u636e\u5e93\u7528\u6237 <code>shortener</code> <code>DATABASE_PASSWORD</code> \u6570\u636e\u5e93\u5bc6\u7801 - <code>DATABASE_PATH</code> SQLite \u6570\u636e\u5e93\u8def\u5f84 <code>/var/lib/shortener/shortener.db</code>"},{"location":"deployment/DOCKER_ADVANCED/#_11","title":"\u7f13\u5b58\u914d\u7f6e","text":"\u53d8\u91cf\u540d \u8bf4\u660e \u9ed8\u8ba4\u503c <code>CACHE_ENABLED</code> \u662f\u5426\u542f\u7528\u7f13\u5b58 <code>true</code> <code>CACHE_TYPE</code> \u7f13\u5b58\u7c7b\u578b\uff08redis/valkey\uff09 <code>redis</code> <code>CACHE_HOST</code> \u7f13\u5b58\u4e3b\u673a <code>localhost</code> <code>CACHE_PORT</code> \u7f13\u5b58\u7aef\u53e3 <code>6379</code> <code>CACHE_PASSWORD</code> \u7f13\u5b58\u5bc6\u7801 - <code>CACHE_EXPIRE</code> \u7f13\u5b58\u8fc7\u671f\u65f6\u95f4\uff08\u79d2\uff09 <code>3600</code>"},{"location":"deployment/DOCKER_ADVANCED/#geoip","title":"GeoIP \u914d\u7f6e","text":"\u53d8\u91cf\u540d \u8bf4\u660e \u9ed8\u8ba4\u503c <code>GEOIP_ENABLED</code> \u662f\u5426\u542f\u7528 GeoIP <code>true</code> <code>GEOIP_DB_PATH</code> GeoIP \u6570\u636e\u5e93\u8def\u5f84 <code>/var/lib/shortener/ip2region.xdb</code>"},{"location":"deployment/DOCKER_ADVANCED/#_12","title":"\u6570\u636e\u6301\u4e45\u5316","text":"<p>Docker Compose \u914d\u7f6e\u4f7f\u7528\u4ee5\u4e0b\u5377\u6765\u6301\u4e45\u5316\u6570\u636e\uff1a</p> <pre><code>volumes:\n  postgres-data:      # PostgreSQL \u6570\u636e\n  mysql-data:         # MySQL \u6570\u636e\n  redis-data:         # Redis \u6570\u636e\n  shortener-logs:     # \u5e94\u7528\u65e5\u5fd7\n</code></pre>"},{"location":"deployment/DOCKER_ADVANCED/#_13","title":"\u5907\u4efd\u6570\u636e","text":"<pre><code># \u5907\u4efd PostgreSQL\ndocker exec shortener-postgres pg_dump -U shortener shortener &gt; backup.sql\n\n# \u5907\u4efd SQLite\ndocker cp shortener-server:/var/lib/shortener/shortener.db ./backup.db\n\n# \u5907\u4efd\u914d\u7f6e\ncp config/config.toml config/config.toml.backup\n</code></pre>"},{"location":"deployment/DOCKER_ADVANCED/#_14","title":"\u6062\u590d\u6570\u636e","text":"<pre><code># \u6062\u590d PostgreSQL\ndocker exec -i shortener-postgres psql -U shortener shortener &lt; backup.sql\n\n# \u6062\u590d SQLite\ndocker cp ./backup.db shortener-server:/var/lib/shortener/shortener.db\n</code></pre>"},{"location":"deployment/DOCKER_ADVANCED/#_15","title":"\u5065\u5eb7\u68c0\u67e5","text":"<p>\u670d\u52a1\u5305\u542b\u5065\u5eb7\u68c0\u67e5\u7aef\u70b9\uff1a</p> <pre><code># \u68c0\u67e5\u670d\u52a1\u5065\u5eb7\u72b6\u6001\ncurl http://localhost:8080/health\n\n# \u67e5\u770b Docker \u5065\u5eb7\u72b6\u6001\ndocker ps\ndocker inspect shortener-server | grep -A 10 Health\n</code></pre>"},{"location":"deployment/DOCKER_ADVANCED/#_16","title":"\u6545\u969c\u6392\u67e5","text":""},{"location":"deployment/DOCKER_ADVANCED/#_17","title":"\u67e5\u770b\u65e5\u5fd7","text":"<pre><code># \u67e5\u770b\u6240\u6709\u670d\u52a1\u65e5\u5fd7\ndocker compose -f docker/docker-compose.yml logs\n\n# \u67e5\u770b\u7279\u5b9a\u670d\u52a1\u65e5\u5fd7\ndocker compose -f docker/docker-compose.yml logs shortener-server\ndocker compose -f docker/docker-compose.yml logs postgres\ndocker compose -f docker/docker-compose.yml logs redis\n\n# \u5b9e\u65f6\u8ddf\u8e2a\u65e5\u5fd7\ndocker compose -f docker/docker-compose.yml logs -f shortener-server\n</code></pre>"},{"location":"deployment/DOCKER_ADVANCED/#_18","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"deployment/DOCKER_ADVANCED/#1","title":"1. \u6570\u636e\u5e93\u8fde\u63a5\u5931\u8d25","text":"<p>\u68c0\u67e5\u6570\u636e\u5e93\u670d\u52a1\u662f\u5426\u6b63\u5e38\u8fd0\u884c\uff1a</p> <pre><code># \u68c0\u67e5 PostgreSQL\ndocker exec shortener-postgres pg_isready -U shortener\n\n# \u68c0\u67e5 MySQL\ndocker exec shortener-mysql mysqladmin ping -h localhost\n</code></pre>"},{"location":"deployment/DOCKER_ADVANCED/#2","title":"2. \u7aef\u53e3\u51b2\u7a81","text":"<p>\u5982\u679c\u7aef\u53e3 8080 \u5df2\u88ab\u5360\u7528\uff0c\u4fee\u6539 <code>docker-compose.yml</code> \u4e2d\u7684\u7aef\u53e3\u6620\u5c04\uff1a</p> <pre><code>ports:\n  - \"8081:8080\"  # \u4f7f\u7528 8081 \u7aef\u53e3\n</code></pre>"},{"location":"deployment/DOCKER_ADVANCED/#3","title":"3. \u6743\u9650\u95ee\u9898","text":"<p>\u786e\u4fdd\u6570\u636e\u76ee\u5f55\u6709\u6b63\u786e\u7684\u6743\u9650\uff1a</p> <pre><code>sudo chown -R 1000:1000 data/\nsudo chmod -R 755 data/\n</code></pre>"},{"location":"deployment/DOCKER_ADVANCED/#4","title":"4. \u5bb9\u5668\u65e0\u6cd5\u542f\u52a8","text":"<p>\u68c0\u67e5\u5bb9\u5668\u65e5\u5fd7\u548c\u914d\u7f6e\uff1a</p> <pre><code>docker logs shortener-server\ndocker inspect shortener-server\n</code></pre>"},{"location":"deployment/DOCKER_ADVANCED/#_19","title":"\u91cd\u7f6e\u670d\u52a1","text":"<pre><code># \u505c\u6b62\u5e76\u5220\u9664\u6240\u6709\u5bb9\u5668\u548c\u5377\ndocker compose -f docker/docker-compose.yml down -v\n\n# \u91cd\u65b0\u542f\u52a8\ndocker compose -f docker/docker-compose.yml up -d\n</code></pre>"},{"location":"deployment/DOCKER_ADVANCED/#_20","title":"\u751f\u4ea7\u73af\u5883\u5efa\u8bae","text":"<ol> <li>\u4f7f\u7528\u73af\u5883\u53d8\u91cf\u6587\u4ef6: \u521b\u5efa <code>.env</code> \u6587\u4ef6\u7ba1\u7406\u654f\u611f\u4fe1\u606f</li> <li>\u542f\u7528 HTTPS: \u4f7f\u7528 Nginx \u6216 Traefik \u4f5c\u4e3a\u53cd\u5411\u4ee3\u7406</li> <li>\u914d\u7f6e\u8d44\u6e90\u9650\u5236: \u5728 <code>docker-compose.yml</code> \u4e2d\u6dfb\u52a0\u8d44\u6e90\u9650\u5236</li> <li>\u5b9a\u671f\u5907\u4efd: \u8bbe\u7f6e\u81ea\u52a8\u5907\u4efd\u4efb\u52a1</li> <li>\u76d1\u63a7\u548c\u65e5\u5fd7: \u96c6\u6210 Prometheus\u3001Grafana \u7b49\u76d1\u63a7\u5de5\u5177</li> <li>\u4f7f\u7528 PostgreSQL: \u751f\u4ea7\u73af\u5883\u63a8\u8350\u4f7f\u7528 PostgreSQL \u800c\u4e0d\u662f SQLite</li> <li>\u542f\u7528 Redis: \u542f\u7528\u7f13\u5b58\u4ee5\u63d0\u5347\u6027\u80fd</li> </ol>"},{"location":"deployment/DOCKER_ADVANCED/#_21","title":"\u8d44\u6e90\u9650\u5236\u793a\u4f8b","text":"<pre><code>services:\n  shortener-server:\n    deploy:\n      resources:\n        limits:\n          cpus: '2'\n          memory: 1G\n        reservations:\n          cpus: '0.5'\n          memory: 512M\n</code></pre>"},{"location":"deployment/DOCKER_ADVANCED/#_22","title":"\u76f8\u5173\u6587\u6863","text":"<ul> <li>\u4e3b\u6587\u6863</li> <li>\u914d\u7f6e\u6307\u5357</li> <li>API \u6587\u6863</li> <li>\u90e8\u7f72\u6307\u5357</li> </ul>"},{"location":"deployment/DOCKER_FRONTEND/","title":"\u524d\u7aef Docker \u90e8\u7f72\u6307\u5357","text":"<p>\u672c\u6587\u6863\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 Docker \u90e8\u7f72 Shortener Frontend\u3002</p>"},{"location":"deployment/DOCKER_FRONTEND/#_1","title":"\u76ee\u5f55","text":"<ul> <li>\u5feb\u901f\u5f00\u59cb</li> <li>Docker \u955c\u50cf</li> <li>Docker Compose \u90e8\u7f72</li> <li>\u73af\u5883\u53d8\u91cf\u914d\u7f6e</li> <li>\u53cd\u5411\u4ee3\u7406\u914d\u7f6e</li> <li>\u6545\u969c\u6392\u67e5</li> </ul>"},{"location":"deployment/DOCKER_FRONTEND/#_2","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"deployment/DOCKER_FRONTEND/#docker-compose","title":"\u4f7f\u7528 Docker Compose","text":"<pre><code># \u542f\u52a8\u524d\u7aef\u670d\u52a1\ndocker compose -f docker/docker-compose.frontend.yml up -d\n\n# \u67e5\u770b\u65e5\u5fd7\ndocker compose -f docker/docker-compose.frontend.yml logs -f\n\n# \u505c\u6b62\u670d\u52a1\ndocker compose -f docker/docker-compose.frontend.yml down\n</code></pre> <p>\u670d\u52a1\u542f\u52a8\u540e\uff0c\u8bbf\u95ee http://localhost \u5373\u53ef\u4f7f\u7528\u524d\u7aef\u754c\u9762\u3002</p>"},{"location":"deployment/DOCKER_FRONTEND/#docker_1","title":"Docker \u955c\u50cf","text":""},{"location":"deployment/DOCKER_FRONTEND/#_3","title":"\u6784\u5efa\u955c\u50cf","text":"<p>\u524d\u7aef\u4f7f\u7528 static-web-server \u4f5c\u4e3a\u751f\u4ea7\u73af\u5883\u7684\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668\u3002</p> <pre><code># \u4ece\u9879\u76ee\u6839\u76ee\u5f55\u6784\u5efa\ndocker build -f docker/Dockerfile.frontend -t shortener-frontend:latest ./shortener-frontend\n\n# \u8fd0\u884c\u5bb9\u5668\ndocker run -d \\\n  --name shortener-frontend \\\n  -p 80:8080 \\\n  -e SERVER_LOG_LEVEL=info \\\n  shortener-frontend:latest\n</code></pre>"},{"location":"deployment/DOCKER_FRONTEND/#_4","title":"\u955c\u50cf\u7279\u70b9","text":"<ul> <li>\u57fa\u7840\u955c\u50cf: <code>joseluisq/static-web-server:2</code></li> <li>\u955c\u50cf\u5927\u5c0f: \u7ea6 10MB\uff08\u6781\u5c0f\uff09</li> <li>\u6784\u5efa\u65b9\u5f0f: \u591a\u9636\u6bb5\u6784\u5efa</li> <li>\u8fd0\u884c\u7528\u6237: \u975e root \u7528\u6237</li> <li>\u7279\u6027:</li> <li>\u539f\u751f\u652f\u6301 Gzip \u548c Brotli \u538b\u7f29</li> <li>\u81ea\u52a8\u7f13\u5b58\u63a7\u5236</li> <li>SPA \u8def\u7531\u652f\u6301</li> <li>HTTP/2 \u652f\u6301</li> </ul>"},{"location":"deployment/DOCKER_FRONTEND/#dockerfile","title":"Dockerfile \u8bf4\u660e","text":"<pre><code># \u6784\u5efa\u9636\u6bb5\nFROM node:20-alpine as builder\n\nWORKDIR /app\n\n# \u5b89\u88c5\u4f9d\u8d56\nCOPY package*.json pnpm-lock.yaml ./\nRUN corepack enable &amp;&amp; corepack prepare pnpm@10.18.3 --activate\nRUN pnpm install --frozen-lockfile\n\n# \u6784\u5efa\u5e94\u7528\nCOPY . .\nRUN pnpm build\n\n# \u751f\u4ea7\u9636\u6bb5\nFROM joseluisq/static-web-server:2\n\n# \u590d\u5236\u6784\u5efa\u4ea7\u7269\nCOPY --from=builder /app/dist /public\n\n# \u914d\u7f6e\u73af\u5883\u53d8\u91cf\nENV SERVER_PORT=8080 \\\n    SERVER_ROOT=/public \\\n    SERVER_LOG_LEVEL=info \\\n    SERVER_FALLBACK_PAGE=/public/index.html \\\n    SERVER_COMPRESSION_GZIP=true \\\n    SERVER_COMPRESSION_BROTLI=true \\\n    SERVER_CACHE_CONTROL_HEADERS=true\n\nEXPOSE 8080\n</code></pre>"},{"location":"deployment/DOCKER_FRONTEND/#docker-compose_1","title":"Docker Compose \u90e8\u7f72","text":""},{"location":"deployment/DOCKER_FRONTEND/#_5","title":"\u57fa\u7840\u914d\u7f6e","text":"<p><code>docker/docker-compose.frontend.yml</code>:</p> <pre><code>version: '3.8'\n\nservices:\n  shortener-frontend:\n    build:\n      context: ../shortener-frontend\n      dockerfile: ../docker/Dockerfile.frontend\n    container_name: shortener-frontend\n    ports:\n      - \"80:8080\"\n    environment:\n      - SERVER_PORT=8080\n      - SERVER_ROOT=/public\n      - SERVER_LOG_LEVEL=info\n      - SERVER_FALLBACK_PAGE=/public/index.html\n      - SERVER_COMPRESSION_GZIP=true\n      - SERVER_COMPRESSION_BROTLI=true\n      - SERVER_CACHE_CONTROL_HEADERS=true\n    restart: unless-stopped\n    networks:\n      - shortener-network\n\nnetworks:\n  shortener-network:\n    driver: bridge\n    name: shortener-network\n</code></pre>"},{"location":"deployment/DOCKER_FRONTEND/#_6","title":"\u4e0e\u540e\u7aef\u670d\u52a1\u96c6\u6210","text":"<p>\u521b\u5efa\u5b8c\u6574\u7684\u670d\u52a1\u6808\u914d\u7f6e\uff1a</p> <pre><code>version: '3.8'\n\nservices:\n  # \u540e\u7aef\u670d\u52a1\n  shortener-server:\n    image: ghcr.io/jetsung/shortener-server:latest\n    container_name: shortener-server\n    ports:\n      - \"8080:8080\"\n    environment:\n      - RUST_LOG=info\n      - DATABASE_TYPE=sqlite\n      - DATABASE_PATH=/var/lib/shortener/shortener.db\n    volumes:\n      - ./data:/var/lib/shortener\n    networks:\n      - shortener-network\n    restart: unless-stopped\n\n  # \u524d\u7aef\u670d\u52a1\n  shortener-frontend:\n    build:\n      context: ../shortener-frontend\n      dockerfile: ../docker/Dockerfile.frontend\n    container_name: shortener-frontend\n    ports:\n      - \"80:8080\"\n    environment:\n      - SERVER_PORT=8080\n      - SERVER_ROOT=/public\n      - SERVER_LOG_LEVEL=info\n      - SERVER_FALLBACK_PAGE=/public/index.html\n      - SERVER_COMPRESSION_GZIP=true\n      - SERVER_COMPRESSION_BROTLI=true\n    depends_on:\n      - shortener-server\n    networks:\n      - shortener-network\n    restart: unless-stopped\n\nnetworks:\n  shortener-network:\n    driver: bridge\n    name: shortener-network\n</code></pre>"},{"location":"deployment/DOCKER_FRONTEND/#_7","title":"\u73af\u5883\u53d8\u91cf\u914d\u7f6e","text":""},{"location":"deployment/DOCKER_FRONTEND/#static-web-server","title":"Static Web Server \u73af\u5883\u53d8\u91cf","text":"\u53d8\u91cf\u540d \u9ed8\u8ba4\u503c \u8bf4\u660e <code>SERVER_PORT</code> 8080 \u670d\u52a1\u76d1\u542c\u7aef\u53e3 <code>SERVER_ROOT</code> /public \u9759\u6001\u6587\u4ef6\u6839\u76ee\u5f55 <code>SERVER_HOST</code> 0.0.0.0 \u76d1\u542c\u5730\u5740 <code>SERVER_LOG_LEVEL</code> error \u65e5\u5fd7\u7ea7\u522b (error/warn/info/debug/trace) <code>SERVER_FALLBACK_PAGE</code> - SPA \u8def\u7531\u56de\u9000\u9875\u9762\uff08\u8bbe\u7f6e\u4e3a /public/index.html\uff09 <code>SERVER_COMPRESSION_GZIP</code> false \u542f\u7528 Gzip \u538b\u7f29 <code>SERVER_COMPRESSION_BROTLI</code> false \u542f\u7528 Brotli \u538b\u7f29 <code>SERVER_CACHE_CONTROL_HEADERS</code> false \u542f\u7528\u7f13\u5b58\u63a7\u5236\u5934 <code>SERVER_CORS_ALLOW_ORIGINS</code> - CORS \u5141\u8bb8\u7684\u6e90\uff08\u9017\u53f7\u5206\u9694\uff09 <code>SERVER_CORS_ALLOW_HEADERS</code> - CORS \u5141\u8bb8\u7684\u8bf7\u6c42\u5934"},{"location":"deployment/DOCKER_FRONTEND/#_8","title":"\u6784\u5efa\u65f6\u73af\u5883\u53d8\u91cf","text":"<p>\u5728\u6784\u5efa\u9636\u6bb5\u53ef\u4ee5\u901a\u8fc7 <code>.env</code> \u6587\u4ef6\u914d\u7f6e Vite \u73af\u5883\u53d8\u91cf\uff1a</p> <pre><code># .env.production\nVITE_API_BASE_URL=https://api.yourdomain.com\nVITE_APP_TITLE=Shortener\nVITE_DEBUG=false\n</code></pre> <p>\u7136\u540e\u5728\u6784\u5efa\u65f6\u4f7f\u7528\uff1a</p> <pre><code>docker build \\\n  --build-arg VITE_API_BASE_URL=https://api.yourdomain.com \\\n  -f docker/Dockerfile.frontend \\\n  -t shortener-frontend:latest \\\n  ./shortener-frontend\n</code></pre>"},{"location":"deployment/DOCKER_FRONTEND/#_9","title":"\u53cd\u5411\u4ee3\u7406\u914d\u7f6e","text":""},{"location":"deployment/DOCKER_FRONTEND/#caddy","title":"\u4f7f\u7528 Caddy","text":"<p><code>Caddyfile</code>:</p> <pre><code>short.example.com {\n    reverse_proxy shortener-frontend:8080\n\n    # \u5b89\u5168\u5934\n    header {\n        X-Frame-Options \"SAMEORIGIN\"\n        X-XSS-Protection \"1; mode=block\"\n        X-Content-Type-Options \"nosniff\"\n        Referrer-Policy \"strict-origin-when-cross-origin\"\n    }\n\n    # \u542f\u7528\u538b\u7f29\n    encode gzip zstd\n\n    # \u65e5\u5fd7\n    log {\n        output file /var/log/caddy/shortener.log\n    }\n}\n</code></pre>"},{"location":"deployment/DOCKER_FRONTEND/#traefik","title":"\u4f7f\u7528 Traefik","text":"<p><code>docker-compose.yml</code>:</p> <pre><code>version: '3.8'\n\nservices:\n  traefik:\n    image: traefik:v2.10\n    command:\n      - \"--api.insecure=true\"\n      - \"--providers.docker=true\"\n      - \"--entrypoints.web.address=:80\"\n      - \"--entrypoints.websecure.address=:443\"\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n      - \"8081:8080\"\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock:ro\n    networks:\n      - shortener-network\n\n  shortener-frontend:\n    build:\n      context: ../shortener-frontend\n      dockerfile: ../docker/Dockerfile.frontend\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.frontend.rule=Host(`short.example.com`)\"\n      - \"traefik.http.routers.frontend.entrypoints=websecure\"\n      - \"traefik.http.routers.frontend.tls=true\"\n      - \"traefik.http.services.frontend.loadbalancer.server.port=8080\"\n    networks:\n      - shortener-network\n\nnetworks:\n  shortener-network:\n    driver: bridge\n</code></pre>"},{"location":"deployment/DOCKER_FRONTEND/#_10","title":"\u6027\u80fd\u4f18\u5316","text":""},{"location":"deployment/DOCKER_FRONTEND/#1","title":"1. \u542f\u7528\u538b\u7f29","text":"<pre><code>environment:\n  - SERVER_COMPRESSION_GZIP=true\n  - SERVER_COMPRESSION_BROTLI=true\n</code></pre>"},{"location":"deployment/DOCKER_FRONTEND/#2","title":"2. \u542f\u7528\u7f13\u5b58","text":"<pre><code>environment:\n  - SERVER_CACHE_CONTROL_HEADERS=true\n</code></pre>"},{"location":"deployment/DOCKER_FRONTEND/#3","title":"3. \u8d44\u6e90\u9650\u5236","text":"<pre><code>services:\n  shortener-frontend:\n    # ... \u5176\u4ed6\u914d\u7f6e\n    deploy:\n      resources:\n        limits:\n          cpus: '0.5'\n          memory: 256M\n        reservations:\n          cpus: '0.25'\n          memory: 128M\n</code></pre>"},{"location":"deployment/DOCKER_FRONTEND/#4","title":"4. \u5065\u5eb7\u68c0\u67e5","text":"<p>\u7531\u4e8e static-web-server:2 \u57fa\u4e8e scratch \u6784\u5efa\uff0c\u65e0\u6cd5\u5728\u5bb9\u5668\u5185\u6267\u884c\u5065\u5eb7\u68c0\u67e5\u547d\u4ee4\u3002\u5efa\u8bae\u5728\u7f16\u6392\u5c42\u914d\u7f6e\uff1a</p> <pre><code># \u4f7f\u7528\u5916\u90e8\u5065\u5eb7\u68c0\u67e5\nhealthcheck:\n  test: [\"CMD-SHELL\", \"wget --no-verbose --tries=1 --spider http://localhost:8080/ || exit 1\"]\n  interval: 30s\n  timeout: 10s\n  retries: 3\n  start_period: 40s\n</code></pre> <p>\u6216\u8005\u4f7f\u7528 Traefik/Kubernetes \u7684\u5065\u5eb7\u68c0\u67e5\u529f\u80fd\u3002</p>"},{"location":"deployment/DOCKER_FRONTEND/#_11","title":"\u65e5\u5fd7\u7ba1\u7406","text":""},{"location":"deployment/DOCKER_FRONTEND/#_12","title":"\u67e5\u770b\u65e5\u5fd7","text":"<pre><code># \u67e5\u770b\u5bb9\u5668\u65e5\u5fd7\ndocker logs shortener-frontend\n\n# \u5b9e\u65f6\u8ddf\u8e2a\u65e5\u5fd7\ndocker logs -f shortener-frontend\n\n# \u67e5\u770b\u6700\u8fd1 100 \u884c\u65e5\u5fd7\ndocker logs --tail 100 shortener-frontend\n\n# \u4f7f\u7528 Docker Compose\ndocker compose -f docker/docker-compose.frontend.yml logs -f\n</code></pre>"},{"location":"deployment/DOCKER_FRONTEND/#_13","title":"\u65e5\u5fd7\u7ea7\u522b","text":"<p>\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u63a7\u5236\u65e5\u5fd7\u8be6\u7ec6\u7a0b\u5ea6\uff1a</p> <pre><code>environment:\n  # \u751f\u4ea7\u73af\u5883\uff1a\u53ea\u8bb0\u5f55\u9519\u8bef\n  - SERVER_LOG_LEVEL=error\n\n  # \u5f00\u53d1\u73af\u5883\uff1a\u8bb0\u5f55\u8be6\u7ec6\u4fe1\u606f\n  - SERVER_LOG_LEVEL=debug\n</code></pre>"},{"location":"deployment/DOCKER_FRONTEND/#_14","title":"\u6545\u969c\u6392\u67e5","text":""},{"location":"deployment/DOCKER_FRONTEND/#_15","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"deployment/DOCKER_FRONTEND/#1_1","title":"1. \u5bb9\u5668\u65e0\u6cd5\u542f\u52a8","text":"<pre><code># \u67e5\u770b\u5bb9\u5668\u72b6\u6001\ndocker ps -a | grep shortener-frontend\n\n# \u67e5\u770b\u8be6\u7ec6\u65e5\u5fd7\ndocker logs shortener-frontend\n\n# \u68c0\u67e5\u7aef\u53e3\u5360\u7528\nsudo netstat -tlnp | grep :8080\n</code></pre>"},{"location":"deployment/DOCKER_FRONTEND/#2_1","title":"2. \u9875\u9762\u65e0\u6cd5\u8bbf\u95ee","text":"<pre><code># \u68c0\u67e5\u5bb9\u5668\u662f\u5426\u8fd0\u884c\ndocker ps | grep shortener-frontend\n\n# \u68c0\u67e5\u7aef\u53e3\u6620\u5c04\ndocker port shortener-frontend\n\n# \u6d4b\u8bd5\u5bb9\u5668\u5185\u90e8\u670d\u52a1\ndocker exec shortener-frontend wget -O- http://localhost:8080\n</code></pre>"},{"location":"deployment/DOCKER_FRONTEND/#3-api","title":"3. API \u8bf7\u6c42\u5931\u8d25","text":"<p>\u68c0\u67e5\u524d\u7aef\u6784\u5efa\u65f6\u7684 API \u5730\u5740\u914d\u7f6e\uff1a</p> <pre><code># \u67e5\u770b\u6784\u5efa\u65f6\u7684\u73af\u5883\u53d8\u91cf\ndocker inspect shortener-frontend | grep VITE_API_BASE_URL\n</code></pre>"},{"location":"deployment/DOCKER_FRONTEND/#4-404","title":"4. \u8def\u7531 404 \u9519\u8bef","text":"<p>\u786e\u8ba4\u8bbe\u7f6e\u4e86 SPA \u56de\u9000\u9875\u9762\uff1a</p> <pre><code>environment:\n  - SERVER_FALLBACK_PAGE=/public/index.html\n</code></pre>"},{"location":"deployment/DOCKER_FRONTEND/#_16","title":"\u8c03\u8bd5\u6280\u5de7","text":"<pre><code># 1. \u4f7f\u7528 alpine \u7248\u672c\u8fdb\u884c\u8c03\u8bd5\uff08\u5305\u542b shell\uff09\ndocker run -it joseluisq/static-web-server:2-alpine sh\n\n# 2. \u68c0\u67e5\u6784\u5efa\u4ea7\u7269\ndocker run --rm -it --entrypoint sh shortener-frontend:latest\nls -la /public\n\n# 3. \u6d4b\u8bd5\u9759\u6001\u6587\u4ef6\u670d\u52a1\ncurl -I http://localhost:8080/\n\n# 4. \u68c0\u67e5\u538b\u7f29\u662f\u5426\u751f\u6548\ncurl -H \"Accept-Encoding: gzip\" -I http://localhost:8080/\n</code></pre>"},{"location":"deployment/DOCKER_FRONTEND/#_17","title":"\u5b89\u5168\u5efa\u8bae","text":"<ol> <li>\u4f7f\u7528 HTTPS</li> <li>\u5728\u53cd\u5411\u4ee3\u7406\u5c42\u914d\u7f6e SSL/TLS</li> <li> <p>\u4f7f\u7528 Let's Encrypt \u514d\u8d39\u8bc1\u4e66</p> </li> <li> <p>\u8bbe\u7f6e\u5b89\u5168\u5934</p> </li> <li>\u5728\u53cd\u5411\u4ee3\u7406\u5c42\u6dfb\u52a0\u5b89\u5168\u54cd\u5e94\u5934</li> <li> <p>\u914d\u7f6e CSP\uff08Content Security Policy\uff09</p> </li> <li> <p>\u9650\u5236\u8bbf\u95ee</p> </li> <li>\u914d\u7f6e\u9632\u706b\u5899\u89c4\u5219</li> <li>\u4f7f\u7528 rate limiting</li> <li> <p>\u542f\u7528 CORS \u767d\u540d\u5355</p> </li> <li> <p>\u5b9a\u671f\u66f4\u65b0</p> </li> <li>\u53ca\u65f6\u66f4\u65b0\u57fa\u7840\u955c\u50cf</li> <li>\u66f4\u65b0\u524d\u7aef\u4f9d\u8d56\u5305</li> <li>\u76d1\u63a7\u5b89\u5168\u6f0f\u6d1e</li> </ol>"},{"location":"deployment/DOCKER_FRONTEND/#_18","title":"\u53c2\u8003\u8d44\u6e90","text":"<ul> <li>Static Web Server \u5b98\u65b9\u6587\u6863</li> <li>Static Web Server \u73af\u5883\u53d8\u91cf</li> <li>Docker \u6700\u4f73\u5b9e\u8df5</li> <li>\u524d\u7aef\u90e8\u7f72\u6307\u5357</li> </ul>"},{"location":"deployment/DOCKER_FULL/","title":"Docker \u90e8\u7f72\u6307\u5357","text":"<p>\u672c\u6587\u6863\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 Docker \u548c Docker Compose \u90e8\u7f72 Shortener URL \u77ed\u94fe\u63a5\u670d\u52a1\u3002</p>"},{"location":"deployment/DOCKER_FULL/#_1","title":"\u76ee\u5f55","text":"<ul> <li>\u5feb\u901f\u5f00\u59cb</li> <li>Docker Compose \u90e8\u7f72</li> <li>\u5355\u72ec\u4f7f\u7528 Docker</li> <li>\u6570\u636e\u5e93\u914d\u7f6e</li> <li>\u73af\u5883\u53d8\u91cf</li> <li>\u6570\u636e\u6301\u4e45\u5316</li> <li>\u5065\u5eb7\u68c0\u67e5</li> <li>\u6545\u969c\u6392\u67e5</li> </ul>"},{"location":"deployment/DOCKER_FULL/#_2","title":"\u5feb\u901f\u5f00\u59cb","text":"<p>\u4f7f\u7528 Docker Compose \u5feb\u901f\u542f\u52a8\u5b8c\u6574\u7684\u670d\u52a1\u6808\uff08\u5305\u62ec PostgreSQL \u548c Redis\uff09\uff1a</p> <pre><code># \u514b\u9686\u4ed3\u5e93\ngit clone https://github.com/jetsung/shortener.git\ncd shortener\n\n# \u4f7f\u7528 Docker Compose \u542f\u52a8\u670d\u52a1\ndocker compose -f docker/docker-compose.yml up -d\n\n# \u67e5\u770b\u65e5\u5fd7\ndocker compose -f docker/docker-compose.yml logs -f shortener-server\n\n# \u505c\u6b62\u670d\u52a1\ndocker compose -f docker/docker-compose.yml down\n</code></pre> <p>\u670d\u52a1\u542f\u52a8\u540e\uff0c\u8bbf\u95ee http://localhost:8080 \u5373\u53ef\u4f7f\u7528\u3002</p>"},{"location":"deployment/DOCKER_FULL/#docker-compose","title":"Docker Compose \u90e8\u7f72","text":""},{"location":"deployment/DOCKER_FULL/#_3","title":"\u5b8c\u6574\u670d\u52a1\u6808\uff08\u63a8\u8350\uff09","text":"<p>\u4f7f\u7528 <code>docker-compose.yml</code> \u90e8\u7f72\u5305\u542b PostgreSQL \u548c Redis \u7684\u5b8c\u6574\u670d\u52a1\uff1a</p> <pre><code>docker compose -f docker/docker-compose.yml up -d\n</code></pre> <p>\u8be5\u914d\u7f6e\u5305\u542b\uff1a - shortener-server: URL \u77ed\u94fe\u63a5\u670d\u52a1\uff08\u7aef\u53e3 8080\uff09 - postgres: PostgreSQL \u6570\u636e\u5e93\uff08\u7aef\u53e3 5432\uff09 - redis: Redis \u7f13\u5b58\uff08\u7aef\u53e3 6379\uff09</p>"},{"location":"deployment/DOCKER_FULL/#sqlite","title":"\u4f7f\u7528 SQLite\uff08\u8f7b\u91cf\u7ea7\u90e8\u7f72\uff09","text":"<p>\u5982\u679c\u4e0d\u9700\u8981 PostgreSQL\uff0c\u53ef\u4ee5\u4f7f\u7528 SQLite\uff1a</p> <pre><code>services:\n  shortener-server:\n    image: jetsung/shortener-server:latest\n    container_name: shortener-server\n    restart: unless-stopped\n    ports:\n      - \"8080:8080\"\n    environment:\n      - RUST_LOG=info\n      - DATABASE_TYPE=sqlite\n      - DATABASE_PATH=/var/lib/shortener/shortener.db\n      - CACHE_ENABLED=false\n      - GEOIP_ENABLED=true\n    volumes:\n      - ./config/config.toml:/etc/shortener/config.toml:ro\n      - ./data:/var/lib/shortener\n      - shortener-logs:/var/log/shortener\n\nvolumes:\n  shortener-logs:\n</code></pre>"},{"location":"deployment/DOCKER_FULL/#mysql","title":"\u4f7f\u7528 MySQL","text":"<p>\u5982\u679c\u9700\u8981\u4f7f\u7528 MySQL \u800c\u4e0d\u662f PostgreSQL\uff1a</p> <pre><code># \u542f\u52a8 MySQL \u914d\u7f6e\ndocker compose -f docker/docker-compose.yml --profile mysql up -d\n</code></pre> <p>\u6216\u4fee\u6539 <code>docker-compose.yml</code> \u4e2d\u7684\u73af\u5883\u53d8\u91cf\uff1a</p> <pre><code>environment:\n  - DATABASE_TYPE=mysql\n  - DATABASE_HOST=mysql\n  - DATABASE_PORT=3306\n  - DATABASE_NAME=shortener\n  - DATABASE_USER=shortener\n  - DATABASE_PASSWORD=shortener_password\n</code></pre>"},{"location":"deployment/DOCKER_FULL/#_4","title":"\u5f00\u53d1\u73af\u5883","text":"<p>\u4f7f\u7528 <code>docker-compose.dev.yml</code> \u8fdb\u884c\u5f00\u53d1\uff1a</p> <pre><code>docker compose -f docker/docker-compose.dev.yml up -d\n</code></pre> <p>\u5f00\u53d1\u73af\u5883\u914d\u7f6e\u5305\u542b\uff1a - \u70ed\u91cd\u8f7d\u652f\u6301 - \u8be6\u7ec6\u7684\u65e5\u5fd7\u8f93\u51fa - \u5f00\u53d1\u5de5\u5177\u96c6\u6210</p>"},{"location":"deployment/DOCKER_FULL/#docker_1","title":"\u5355\u72ec\u4f7f\u7528 Docker","text":""},{"location":"deployment/DOCKER_FULL/#_5","title":"\u6784\u5efa\u955c\u50cf","text":"<pre><code># \u4ece\u9879\u76ee\u6839\u76ee\u5f55\u6784\u5efa\ndocker build -f docker/Dockerfile -t shortener-server:latest .\n\n# \u4f7f\u7528 Alpine \u57fa\u7840\u955c\u50cf\uff08\u66f4\u5c0f\u7684\u955c\u50cf\u4f53\u79ef\uff09\ndocker build -f docker/Dockerfile.alpine -t shortener-server:alpine .\n</code></pre>"},{"location":"deployment/DOCKER_FULL/#_6","title":"\u8fd0\u884c\u5bb9\u5668","text":"<pre><code># \u4f7f\u7528 SQLite\uff08\u6700\u7b80\u5355\uff09\ndocker run -d \\\n  --name shortener-server \\\n  -p 8080:8080 \\\n  -v $(pwd)/config/config.toml:/etc/shortener/config.toml:ro \\\n  -v $(pwd)/data:/var/lib/shortener \\\n  -e RUST_LOG=info \\\n  -e DATABASE_TYPE=sqlite \\\n  shortener-server:latest\n\n# \u8fde\u63a5\u5230\u5916\u90e8 PostgreSQL\ndocker run -d \\\n  --name shortener-server \\\n  -p 8080:8080 \\\n  -v $(pwd)/config/config.toml:/etc/shortener/config.toml:ro \\\n  -e RUST_LOG=info \\\n  -e DATABASE_TYPE=postgres \\\n  -e DATABASE_HOST=your-postgres-host \\\n  -e DATABASE_PORT=5432 \\\n  -e DATABASE_NAME=shortener \\\n  -e DATABASE_USER=shortener \\\n  -e DATABASE_PASSWORD=your-password \\\n  shortener-server:latest\n</code></pre>"},{"location":"deployment/DOCKER_FULL/#_7","title":"\u6570\u636e\u5e93\u914d\u7f6e","text":""},{"location":"deployment/DOCKER_FULL/#postgresql","title":"PostgreSQL\uff08\u63a8\u8350\u7528\u4e8e\u751f\u4ea7\u73af\u5883\uff09","text":"<pre><code>services:\n  shortener-server:\n    environment:\n      - DATABASE_TYPE=postgres\n      - DATABASE_HOST=postgres\n      - DATABASE_PORT=5432\n      - DATABASE_NAME=shortener\n      - DATABASE_USER=shortener\n      - DATABASE_PASSWORD=shortener_password\n    depends_on:\n      postgres:\n        condition: service_healthy\n\n  postgres:\n    image: postgres:16-alpine\n    environment:\n      - POSTGRES_DB=shortener\n      - POSTGRES_USER=shortener\n      - POSTGRES_PASSWORD=shortener_password\n    volumes:\n      - postgres-data:/var/lib/postgresql/data\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U shortener\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n</code></pre>"},{"location":"deployment/DOCKER_FULL/#mysql_1","title":"MySQL","text":"<pre><code>services:\n  shortener-server:\n    environment:\n      - DATABASE_TYPE=mysql\n      - DATABASE_HOST=mysql\n      - DATABASE_PORT=3306\n      - DATABASE_NAME=shortener\n      - DATABASE_USER=shortener\n      - DATABASE_PASSWORD=shortener_password\n    depends_on:\n      mysql:\n        condition: service_healthy\n\n  mysql:\n    image: mysql:8.0\n    environment:\n      - MYSQL_ROOT_PASSWORD=root_password\n      - MYSQL_DATABASE=shortener\n      - MYSQL_USER=shortener\n      - MYSQL_PASSWORD=shortener_password\n    volumes:\n      - mysql-data:/var/lib/mysql\n    healthcheck:\n      test: [\"CMD\", \"mysqladmin\", \"ping\", \"-h\", \"localhost\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n</code></pre>"},{"location":"deployment/DOCKER_FULL/#sqlite_1","title":"SQLite\uff08\u9002\u5408\u5c0f\u89c4\u6a21\u90e8\u7f72\uff09","text":"<pre><code>services:\n  shortener-server:\n    environment:\n      - DATABASE_TYPE=sqlite\n      - DATABASE_PATH=/var/lib/shortener/shortener.db\n    volumes:\n      - ./data:/var/lib/shortener\n</code></pre>"},{"location":"deployment/DOCKER_FULL/#_8","title":"\u73af\u5883\u53d8\u91cf","text":""},{"location":"deployment/DOCKER_FULL/#_9","title":"\u670d\u52a1\u5668\u914d\u7f6e","text":"\u53d8\u91cf\u540d \u8bf4\u660e \u9ed8\u8ba4\u503c <code>RUST_LOG</code> \u65e5\u5fd7\u7ea7\u522b <code>info</code> <code>CONFIG_PATH</code> \u914d\u7f6e\u6587\u4ef6\u8def\u5f84 <code>/etc/shortener/config.toml</code> <code>SERVER_ADDRESS</code> \u76d1\u542c\u5730\u5740 <code>0.0.0.0:8080</code> <code>SITE_URL</code> \u7ad9\u70b9 URL <code>http://localhost:8080</code>"},{"location":"deployment/DOCKER_FULL/#_10","title":"\u6570\u636e\u5e93\u914d\u7f6e","text":"\u53d8\u91cf\u540d \u8bf4\u660e \u9ed8\u8ba4\u503c <code>DATABASE_TYPE</code> \u6570\u636e\u5e93\u7c7b\u578b\uff08sqlite/postgres/mysql\uff09 <code>postgres</code> <code>DATABASE_HOST</code> \u6570\u636e\u5e93\u4e3b\u673a <code>localhost</code> <code>DATABASE_PORT</code> \u6570\u636e\u5e93\u7aef\u53e3 <code>5432</code> <code>DATABASE_NAME</code> \u6570\u636e\u5e93\u540d\u79f0 <code>shortener</code> <code>DATABASE_USER</code> \u6570\u636e\u5e93\u7528\u6237 <code>shortener</code> <code>DATABASE_PASSWORD</code> \u6570\u636e\u5e93\u5bc6\u7801 - <code>DATABASE_PATH</code> SQLite \u6570\u636e\u5e93\u8def\u5f84 <code>/var/lib/shortener/shortener.db</code>"},{"location":"deployment/DOCKER_FULL/#_11","title":"\u7f13\u5b58\u914d\u7f6e","text":"\u53d8\u91cf\u540d \u8bf4\u660e \u9ed8\u8ba4\u503c <code>CACHE_ENABLED</code> \u662f\u5426\u542f\u7528\u7f13\u5b58 <code>true</code> <code>CACHE_TYPE</code> \u7f13\u5b58\u7c7b\u578b\uff08redis/valkey\uff09 <code>redis</code> <code>CACHE_HOST</code> \u7f13\u5b58\u4e3b\u673a <code>localhost</code> <code>CACHE_PORT</code> \u7f13\u5b58\u7aef\u53e3 <code>6379</code> <code>CACHE_PASSWORD</code> \u7f13\u5b58\u5bc6\u7801 - <code>CACHE_EXPIRE</code> \u7f13\u5b58\u8fc7\u671f\u65f6\u95f4\uff08\u79d2\uff09 <code>3600</code>"},{"location":"deployment/DOCKER_FULL/#geoip","title":"GeoIP \u914d\u7f6e","text":"\u53d8\u91cf\u540d \u8bf4\u660e \u9ed8\u8ba4\u503c <code>GEOIP_ENABLED</code> \u662f\u5426\u542f\u7528 GeoIP <code>true</code> <code>GEOIP_DB_PATH</code> GeoIP \u6570\u636e\u5e93\u8def\u5f84 <code>/var/lib/shortener/ip2region.xdb</code>"},{"location":"deployment/DOCKER_FULL/#_12","title":"\u6570\u636e\u6301\u4e45\u5316","text":"<p>Docker Compose \u914d\u7f6e\u4f7f\u7528\u4ee5\u4e0b\u5377\u6765\u6301\u4e45\u5316\u6570\u636e\uff1a</p> <pre><code>volumes:\n  postgres-data:      # PostgreSQL \u6570\u636e\n  mysql-data:         # MySQL \u6570\u636e\n  redis-data:         # Redis \u6570\u636e\n  shortener-logs:     # \u5e94\u7528\u65e5\u5fd7\n</code></pre>"},{"location":"deployment/DOCKER_FULL/#_13","title":"\u5907\u4efd\u6570\u636e","text":"<pre><code># \u5907\u4efd PostgreSQL\ndocker exec shortener-postgres pg_dump -U shortener shortener &gt; backup.sql\n\n# \u5907\u4efd SQLite\ndocker cp shortener-server:/var/lib/shortener/shortener.db ./backup.db\n\n# \u5907\u4efd\u914d\u7f6e\ncp config/config.toml config/config.toml.backup\n</code></pre>"},{"location":"deployment/DOCKER_FULL/#_14","title":"\u6062\u590d\u6570\u636e","text":"<pre><code># \u6062\u590d PostgreSQL\ndocker exec -i shortener-postgres psql -U shortener shortener &lt; backup.sql\n\n# \u6062\u590d SQLite\ndocker cp ./backup.db shortener-server:/var/lib/shortener/shortener.db\n</code></pre>"},{"location":"deployment/DOCKER_FULL/#_15","title":"\u5065\u5eb7\u68c0\u67e5","text":"<p>\u670d\u52a1\u5305\u542b\u5065\u5eb7\u68c0\u67e5\u7aef\u70b9\uff1a</p> <pre><code># \u68c0\u67e5\u670d\u52a1\u5065\u5eb7\u72b6\u6001\ncurl http://localhost:8080/health\n\n# \u67e5\u770b Docker \u5065\u5eb7\u72b6\u6001\ndocker ps\ndocker inspect shortener-server | grep -A 10 Health\n</code></pre>"},{"location":"deployment/DOCKER_FULL/#_16","title":"\u6545\u969c\u6392\u67e5","text":""},{"location":"deployment/DOCKER_FULL/#_17","title":"\u67e5\u770b\u65e5\u5fd7","text":"<pre><code># \u67e5\u770b\u6240\u6709\u670d\u52a1\u65e5\u5fd7\ndocker compose -f docker/docker-compose.yml logs\n\n# \u67e5\u770b\u7279\u5b9a\u670d\u52a1\u65e5\u5fd7\ndocker compose -f docker/docker-compose.yml logs shortener-server\ndocker compose -f docker/docker-compose.yml logs postgres\ndocker compose -f docker/docker-compose.yml logs redis\n\n# \u5b9e\u65f6\u8ddf\u8e2a\u65e5\u5fd7\ndocker compose -f docker/docker-compose.yml logs -f shortener-server\n</code></pre>"},{"location":"deployment/DOCKER_FULL/#_18","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"deployment/DOCKER_FULL/#1","title":"1. \u6570\u636e\u5e93\u8fde\u63a5\u5931\u8d25","text":"<p>\u68c0\u67e5\u6570\u636e\u5e93\u670d\u52a1\u662f\u5426\u6b63\u5e38\u8fd0\u884c\uff1a</p> <pre><code># \u68c0\u67e5 PostgreSQL\ndocker exec shortener-postgres pg_isready -U shortener\n\n# \u68c0\u67e5 MySQL\ndocker exec shortener-mysql mysqladmin ping -h localhost\n</code></pre>"},{"location":"deployment/DOCKER_FULL/#2","title":"2. \u7aef\u53e3\u51b2\u7a81","text":"<p>\u5982\u679c\u7aef\u53e3 8080 \u5df2\u88ab\u5360\u7528\uff0c\u4fee\u6539 <code>docker-compose.yml</code> \u4e2d\u7684\u7aef\u53e3\u6620\u5c04\uff1a</p> <pre><code>ports:\n  - \"8081:8080\"  # \u4f7f\u7528 8081 \u7aef\u53e3\n</code></pre>"},{"location":"deployment/DOCKER_FULL/#3","title":"3. \u6743\u9650\u95ee\u9898","text":"<p>\u786e\u4fdd\u6570\u636e\u76ee\u5f55\u6709\u6b63\u786e\u7684\u6743\u9650\uff1a</p> <pre><code>sudo chown -R 1000:1000 data/\nsudo chmod -R 755 data/\n</code></pre>"},{"location":"deployment/DOCKER_FULL/#4","title":"4. \u5bb9\u5668\u65e0\u6cd5\u542f\u52a8","text":"<p>\u68c0\u67e5\u5bb9\u5668\u65e5\u5fd7\u548c\u914d\u7f6e\uff1a</p> <pre><code>docker logs shortener-server\ndocker inspect shortener-server\n</code></pre>"},{"location":"deployment/DOCKER_FULL/#_19","title":"\u91cd\u7f6e\u670d\u52a1","text":"<pre><code># \u505c\u6b62\u5e76\u5220\u9664\u6240\u6709\u5bb9\u5668\u548c\u5377\ndocker compose -f docker/docker-compose.yml down -v\n\n# \u91cd\u65b0\u542f\u52a8\ndocker compose -f docker/docker-compose.yml up -d\n</code></pre>"},{"location":"deployment/DOCKER_FULL/#_20","title":"\u751f\u4ea7\u73af\u5883\u5efa\u8bae","text":"<ol> <li>\u4f7f\u7528\u73af\u5883\u53d8\u91cf\u6587\u4ef6: \u521b\u5efa <code>.env</code> \u6587\u4ef6\u7ba1\u7406\u654f\u611f\u4fe1\u606f</li> <li>\u542f\u7528 HTTPS: \u4f7f\u7528 Nginx \u6216 Traefik \u4f5c\u4e3a\u53cd\u5411\u4ee3\u7406</li> <li>\u914d\u7f6e\u8d44\u6e90\u9650\u5236: \u5728 <code>docker-compose.yml</code> \u4e2d\u6dfb\u52a0\u8d44\u6e90\u9650\u5236</li> <li>\u5b9a\u671f\u5907\u4efd: \u8bbe\u7f6e\u81ea\u52a8\u5907\u4efd\u4efb\u52a1</li> <li>\u76d1\u63a7\u548c\u65e5\u5fd7: \u96c6\u6210 Prometheus\u3001Grafana \u7b49\u76d1\u63a7\u5de5\u5177</li> <li>\u4f7f\u7528 PostgreSQL: \u751f\u4ea7\u73af\u5883\u63a8\u8350\u4f7f\u7528 PostgreSQL \u800c\u4e0d\u662f SQLite</li> <li>\u542f\u7528 Redis: \u542f\u7528\u7f13\u5b58\u4ee5\u63d0\u5347\u6027\u80fd</li> </ol>"},{"location":"deployment/DOCKER_FULL/#_21","title":"\u8d44\u6e90\u9650\u5236\u793a\u4f8b","text":"<pre><code>services:\n  shortener-server:\n    deploy:\n      resources:\n        limits:\n          cpus: '2'\n          memory: 1G\n        reservations:\n          cpus: '0.5'\n          memory: 512M\n</code></pre>"},{"location":"deployment/DOCKER_FULL/#_22","title":"\u76f8\u5173\u6587\u6863","text":"<ul> <li>\u4e3b\u6587\u6863</li> <li>\u914d\u7f6e\u6307\u5357</li> <li>API \u6587\u6863</li> <li>\u90e8\u7f72\u6307\u5357</li> </ul>"},{"location":"deployment/SYSTEMD/","title":"Systemd \u670d\u52a1\u90e8\u7f72","text":"<p>\u6b64\u76ee\u5f55\u5305\u542b\u5728 Linux \u7cfb\u7edf\u4e0a\u90e8\u7f72 Shortener \u670d\u52a1\u5668\u7684 systemd \u670d\u52a1\u914d\u7f6e\u3002</p>"},{"location":"deployment/SYSTEMD/#_1","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"deployment/SYSTEMD/#_2","title":"\u5b89\u88c5","text":"<pre><code># \u9996\u5148\u6784\u5efa\u53d1\u5e03\u7248\u672c\ncd ../..\ncargo build --release -p shortener-server\n\n# \u5b89\u88c5\u670d\u52a1\uff08\u9700\u8981 root \u6743\u9650\uff09\ncd deploy/systemd\nsudo ./install.sh\n</code></pre>"},{"location":"deployment/SYSTEMD/#_3","title":"\u914d\u7f6e","text":"<p>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\uff1a</p> <pre><code>sudo vim /etc/shortener/config.toml\n</code></pre>"},{"location":"deployment/SYSTEMD/#_4","title":"\u542f\u52a8\u670d\u52a1","text":"<pre><code># \u542f\u52a8\u670d\u52a1\nsudo systemctl start shortener-server\n\n# \u542f\u7528\u5f00\u673a\u81ea\u542f\u52a8\nsudo systemctl enable shortener-server\n\n# \u68c0\u67e5\u72b6\u6001\nsudo systemctl status shortener-server\n</code></pre>"},{"location":"deployment/SYSTEMD/#_5","title":"\u670d\u52a1\u7ba1\u7406","text":""},{"location":"deployment/SYSTEMD/#_6","title":"\u542f\u52a8/\u505c\u6b62/\u91cd\u542f","text":"<pre><code># \u542f\u52a8\nsudo systemctl start shortener-server\n\n# \u505c\u6b62\nsudo systemctl stop shortener-server\n\n# \u91cd\u542f\nsudo systemctl restart shortener-server\n\n# \u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\uff08\u5982\u679c\u652f\u6301\uff09\nsudo systemctl reload shortener-server\n</code></pre>"},{"location":"deployment/SYSTEMD/#_7","title":"\u542f\u7528/\u7981\u7528\u81ea\u52a8\u542f\u52a8","text":"<pre><code># \u542f\u7528\u5f00\u673a\u81ea\u542f\u52a8\nsudo systemctl enable shortener-server\n\n# \u7981\u7528\u81ea\u52a8\u542f\u52a8\nsudo systemctl disable shortener-server\n\n# \u68c0\u67e5\u662f\u5426\u5df2\u542f\u7528\nsystemctl is-enabled shortener-server\n</code></pre>"},{"location":"deployment/SYSTEMD/#_8","title":"\u67e5\u770b\u72b6\u6001","text":"<pre><code># \u8be6\u7ec6\u72b6\u6001\nsudo systemctl status shortener-server\n\n# \u68c0\u67e5\u662f\u5426\u8fd0\u884c\nsystemctl is-active shortener-server\n\n# \u68c0\u67e5\u662f\u5426\u5931\u8d25\nsystemctl is-failed shortener-server\n</code></pre>"},{"location":"deployment/SYSTEMD/#_9","title":"\u65e5\u5fd7","text":""},{"location":"deployment/SYSTEMD/#_10","title":"\u67e5\u770b\u65e5\u5fd7","text":"<pre><code># \u67e5\u770b\u6700\u8fd1\u7684\u65e5\u5fd7\nsudo journalctl -u shortener-server\n\n# \u5b9e\u65f6\u8ddf\u8e2a\u65e5\u5fd7\nsudo journalctl -u shortener-server -f\n\n# \u67e5\u770b\u81ea\u542f\u52a8\u4ee5\u6765\u7684\u65e5\u5fd7\nsudo journalctl -u shortener-server -b\n\n# \u67e5\u770b\u6700\u8fd1\u4e00\u5c0f\u65f6\u7684\u65e5\u5fd7\nsudo journalctl -u shortener-server --since \"1 hour ago\"\n\n# \u67e5\u770b\u7279\u5b9a\u4f18\u5148\u7ea7\u7684\u65e5\u5fd7\nsudo journalctl -u shortener-server -p err\n\n# \u5bfc\u51fa\u65e5\u5fd7\u5230\u6587\u4ef6\nsudo journalctl -u shortener-server &gt; shortener.log\n</code></pre>"},{"location":"deployment/SYSTEMD/#_11","title":"\u65e5\u5fd7\u8f6e\u8f6c","text":"<p>Systemd \u901a\u8fc7 journald \u81ea\u52a8\u5904\u7406\u65e5\u5fd7\u8f6e\u8f6c\u3002\u5728 <code>/etc/systemd/journald.conf</code> \u4e2d\u914d\u7f6e\uff1a</p> <pre><code>[Journal]\nSystemMaxUse=500M\nSystemMaxFileSize=100M\nSystemMaxFiles=5\n</code></pre>"},{"location":"deployment/SYSTEMD/#_12","title":"\u6587\u4ef6\u4f4d\u7f6e","text":""},{"location":"deployment/SYSTEMD/#_13","title":"\u4e8c\u8fdb\u5236\u6587\u4ef6","text":"<ul> <li><code>/usr/local/bin/shortener-server</code> - \u4e3b\u53ef\u6267\u884c\u6587\u4ef6</li> </ul>"},{"location":"deployment/SYSTEMD/#_14","title":"\u914d\u7f6e","text":"<ul> <li><code>/etc/shortener/config.toml</code> - \u4e3b\u914d\u7f6e\u6587\u4ef6</li> </ul>"},{"location":"deployment/SYSTEMD/#_15","title":"\u6570\u636e","text":"<ul> <li><code>/var/lib/shortener/</code> - \u6570\u636e\u76ee\u5f55</li> <li><code>shortener.db</code> - SQLite \u6570\u636e\u5e93\uff08\u5982\u679c\u4f7f\u7528 SQLite\uff09</li> <li><code>ip2region.xdb</code> - GeoIP \u6570\u636e\u5e93</li> </ul>"},{"location":"deployment/SYSTEMD/#_16","title":"\u65e5\u5fd7","text":"<ul> <li><code>/var/log/shortener/</code> - \u65e5\u5fd7\u76ee\u5f55\uff08\u5982\u679c\u542f\u7528\u6587\u4ef6\u65e5\u5fd7\uff09</li> <li><code>journalctl -u shortener-server</code> - Systemd \u65e5\u5fd7</li> </ul>"},{"location":"deployment/SYSTEMD/#_17","title":"\u670d\u52a1","text":"<ul> <li><code>/etc/systemd/system/shortener-server.service</code> - \u670d\u52a1\u5355\u5143\u6587\u4ef6</li> </ul>"},{"location":"deployment/SYSTEMD/#_18","title":"\u670d\u52a1\u914d\u7f6e","text":"<p>\u670d\u52a1\u6587\u4ef6\u5305\u62ec\uff1a</p>"},{"location":"deployment/SYSTEMD/#_19","title":"\u5b89\u5168\u7279\u6027","text":"<ul> <li>NoNewPrivileges\uff1a\u9632\u6b62\u6743\u9650\u63d0\u5347</li> <li>PrivateTmp\uff1a\u9694\u79bb\u7684 /tmp \u76ee\u5f55</li> <li>ProtectSystem\uff1a\u53ea\u8bfb\u7cfb\u7edf\u76ee\u5f55</li> <li>ProtectHome\uff1a\u65e0\u6cd5\u8bbf\u95ee\u5bb6\u76ee\u5f55</li> <li>ProtectKernelTunables\uff1a\u53d7\u4fdd\u62a4\u7684\u5185\u6838\u53c2\u6570</li> <li>RestrictRealtime\uff1a\u65e0\u5b9e\u65f6\u8c03\u5ea6</li> <li>MemoryDenyWriteExecute\uff1aW^X \u5185\u5b58\u4fdd\u62a4</li> </ul>"},{"location":"deployment/SYSTEMD/#_20","title":"\u8d44\u6e90\u9650\u5236","text":"<ul> <li>LimitNOFILE\uff1a65536 \u4e2a\u6253\u5f00\u6587\u4ef6</li> <li>LimitNPROC\uff1a512 \u4e2a\u8fdb\u7a0b</li> </ul>"},{"location":"deployment/SYSTEMD/#_21","title":"\u91cd\u542f\u7b56\u7565","text":"<ul> <li>Restart\uff1a\u5931\u8d25\u65f6\u91cd\u542f</li> <li>RestartSec\uff1a5 \u79d2</li> <li>StartLimitInterval\uff1a60 \u79d2</li> <li>StartLimitBurst\uff1a3 \u6b21\u5c1d\u8bd5</li> </ul>"},{"location":"deployment/SYSTEMD/#_22","title":"\u81ea\u5b9a\u4e49","text":""},{"location":"deployment/SYSTEMD/#_23","title":"\u7f16\u8f91\u670d\u52a1\u6587\u4ef6","text":"<pre><code># \u7f16\u8f91\u670d\u52a1\u6587\u4ef6\nsudo systemctl edit --full shortener-server\n\n# \u6216\u76f4\u63a5\u7f16\u8f91\nsudo vim /etc/systemd/system/shortener-server.service\n\n# \u66f4\u6539\u540e\u91cd\u65b0\u52a0\u8f7d\nsudo systemctl daemon-reload\nsudo systemctl restart shortener-server\n</code></pre>"},{"location":"deployment/SYSTEMD/#_24","title":"\u73af\u5883\u53d8\u91cf","text":"<p>\u5728\u670d\u52a1\u6587\u4ef6\u4e2d\u6dfb\u52a0\u73af\u5883\u53d8\u91cf\uff1a</p> <pre><code>[Service]\nEnvironment=\"RUST_LOG=debug\"\nEnvironment=\"DATABASE_TYPE=postgres\"\nEnvironment=\"DATABASE_HOST=localhost\"\n</code></pre> <p>\u6216\u4f7f\u7528\u73af\u5883\u6587\u4ef6\uff1a</p> <pre><code>[Service]\nEnvironmentFile=/etc/shortener/environment\n</code></pre> <p>\u521b\u5efa <code>/etc/shortener/environment</code>\uff1a</p> <pre><code>RUST_LOG=info\nDATABASE_TYPE=postgres\nDATABASE_HOST=localhost\nDATABASE_PORT=5432\n</code></pre>"},{"location":"deployment/SYSTEMD/#_25","title":"\u6545\u969c\u6392\u9664","text":""},{"location":"deployment/SYSTEMD/#_26","title":"\u670d\u52a1\u65e0\u6cd5\u542f\u52a8","text":"<pre><code># \u68c0\u67e5\u72b6\u6001\nsudo systemctl status shortener-server\n\n# \u67e5\u770b\u8be6\u7ec6\u65e5\u5fd7\nsudo journalctl -u shortener-server -n 50 --no-pager\n\n# \u68c0\u67e5\u914d\u7f6e\nsudo /usr/local/bin/shortener-server --version\n\n# \u6d4b\u8bd5\u914d\u7f6e\nsudo -u shortener /usr/local/bin/shortener-server\n</code></pre>"},{"location":"deployment/SYSTEMD/#_27","title":"\u6743\u9650\u95ee\u9898","text":"<pre><code># \u68c0\u67e5\u6587\u4ef6\u6240\u6709\u6743\nls -la /usr/local/bin/shortener-server\nls -la /etc/shortener/config.toml\nls -la /var/lib/shortener/\n\n# \u4fee\u590d\u6240\u6709\u6743\nsudo chown shortener:shortener /var/lib/shortener/\nsudo chown shortener:shortener /var/log/shortener/\n</code></pre>"},{"location":"deployment/SYSTEMD/#_28","title":"\u7aef\u53e3\u5df2\u88ab\u5360\u7528","text":"<pre><code># \u68c0\u67e5\u4ec0\u4e48\u5728\u4f7f\u7528\u7aef\u53e3 8080\nsudo lsof -i :8080\nsudo netstat -tulpn | grep 8080\n\n# \u5728\u914d\u7f6e\u4e2d\u66f4\u6539\u7aef\u53e3\nsudo vim /etc/shortener/config.toml\n</code></pre>"},{"location":"deployment/SYSTEMD/#_29","title":"\u670d\u52a1\u7acb\u5373\u5d29\u6e83","text":"<pre><code># \u68c0\u67e5\u9519\u8bef\nsudo journalctl -u shortener-server -n 100 --no-pager\n\n# \u624b\u52a8\u8fd0\u884c\u4ee5\u67e5\u770b\u9519\u8bef\nsudo -u shortener /usr/local/bin/shortener-server\n\n# \u68c0\u67e5\u4f9d\u8d56\u9879\nldd /usr/local/bin/shortener-server\n</code></pre>"},{"location":"deployment/SYSTEMD/#_30","title":"\u5378\u8f7d","text":"<pre><code># \u8fd0\u884c\u5378\u8f7d\u811a\u672c\ncd deploy/systemd\nsudo ./uninstall.sh\n\n# \u624b\u52a8\u5220\u9664\u6240\u6709\u6587\u4ef6\uff08\u53ef\u9009\uff09\nsudo rm -rf /usr/local/bin/shortener-server\nsudo rm -rf /etc/shortener\nsudo rm -rf /var/lib/shortener\nsudo rm -rf /var/log/shortener\nsudo userdel shortener\n</code></pre>"},{"location":"deployment/SYSTEMD/#_31","title":"\u4e0e\u5176\u4ed6\u670d\u52a1\u96c6\u6210","text":""},{"location":"deployment/SYSTEMD/#nginx","title":"Nginx \u53cd\u5411\u4ee3\u7406","text":"<p>\u521b\u5efa <code>/etc/nginx/sites-available/shortener</code>\uff1a</p> <pre><code>server {\n    listen 80;\n    server_name short.example.com;\n\n    location / {\n        proxy_pass http://127.0.0.1:8080;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n</code></pre> <p>\u542f\u7528\u5e76\u91cd\u542f\uff1a</p> <pre><code>sudo ln -s /etc/nginx/sites-available/shortener /etc/nginx/sites-enabled/\nsudo nginx -t\nsudo systemctl restart nginx\n</code></pre>"},{"location":"deployment/SYSTEMD/#postgresql","title":"PostgreSQL \u6570\u636e\u5e93","text":"<p>\u786e\u4fdd PostgreSQL \u5728\u670d\u52a1\u4e4b\u524d\u542f\u52a8\uff1a</p> <pre><code>[Unit]\nAfter=network-online.target postgresql.service\nWants=network-online.target\nRequires=postgresql.service\n</code></pre>"},{"location":"deployment/SYSTEMD/#redis","title":"Redis \u7f13\u5b58","text":"<p>\u786e\u4fdd Redis \u5728\u670d\u52a1\u4e4b\u524d\u542f\u52a8\uff1a</p> <pre><code>[Unit]\nAfter=network-online.target redis.service\nWants=network-online.target\nRequires=redis.service\n</code></pre>"},{"location":"deployment/SYSTEMD/#_32","title":"\u76d1\u63a7","text":""},{"location":"deployment/SYSTEMD/#systemd_1","title":"Systemd \u72b6\u6001","text":"<pre><code># \u76d1\u89c6\u72b6\u6001\nwatch -n 1 'systemctl status shortener-server'\n\n# \u68c0\u67e5\u91cd\u542f\u6b21\u6570\nsystemctl show shortener-server -p NRestarts\n</code></pre>"},{"location":"deployment/SYSTEMD/#_33","title":"\u8d44\u6e90\u4f7f\u7528","text":"<pre><code># CPU \u548c\u5185\u5b58\nsystemd-cgtop\n\n# \u8be6\u7ec6\u7edf\u8ba1\nsystemctl show shortener-server\n</code></pre>"},{"location":"deployment/SYSTEMD/#_34","title":"\u6700\u4f73\u5b9e\u8df5","text":"<ol> <li>\u59cb\u7ec8\u6d4b\u8bd5\u914d\u7f6e\uff0c\u7136\u540e\u518d\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u91cd\u542f</li> <li>\u4f7f\u7528\u73af\u5883\u6587\u4ef6\u5b58\u50a8\u654f\u611f\u6570\u636e</li> <li>\u542f\u7528\u81ea\u52a8\u542f\u52a8\u7528\u4e8e\u751f\u4ea7\u670d\u52a1</li> <li>\u5b9a\u671f\u76d1\u63a7\u65e5\u5fd7</li> <li>\u8bbe\u7f6e\u8d44\u6e90\u9650\u5236\u4ee5\u9632\u6b62\u8d44\u6e90\u8017\u5c3d</li> <li>\u4f7f\u7528 systemd \u63d0\u4f9b\u7684\u5b89\u5168\u7279\u6027</li> <li>\u4fdd\u7559\u914d\u7f6e\u548c\u6570\u636e\u7684\u5907\u4efd</li> <li>\u8bb0\u5f55\u670d\u52a1\u914d\u7f6e\u7684\u66f4\u6539</li> </ol>"},{"location":"deployment/SYSTEMD/#_35","title":"\u53c2\u8003","text":"<ul> <li>systemd.service \u624b\u518c</li> <li>systemd.exec \u624b\u518c</li> <li>journalctl \u624b\u518c</li> </ul>"},{"location":"frontend/","title":"\u524d\u7aef\u6587\u6863","text":"<p>Shortener Frontend \u662f\u4e00\u4e2a\u57fa\u4e8e React \u548c Semi Design \u7684\u73b0\u4ee3\u5316\u77ed\u94fe\u63a5\u7ba1\u7406\u754c\u9762\u3002</p>"},{"location":"frontend/#_2","title":"\ud83d\udcda \u6587\u6863\u5217\u8868","text":"<ul> <li>\u7ec4\u4ef6\u6587\u6863 - \u7ec4\u4ef6\u4f7f\u7528\u8bf4\u660e</li> <li>\u90e8\u7f72\u6307\u5357 - \u524d\u7aef\u90e8\u7f72\u8bf4\u660e</li> </ul>"},{"location":"frontend/#_3","title":"\ud83d\ude80 \u5feb\u901f\u5f00\u59cb","text":""},{"location":"frontend/#_4","title":"\u73af\u5883\u8981\u6c42","text":"<ul> <li>Node.js &gt;= 18.0.0</li> <li>pnpm &gt;= 8.0.0 (\u63a8\u8350) \u6216 npm</li> </ul>"},{"location":"frontend/#_5","title":"\u5b89\u88c5\u4f9d\u8d56","text":"<pre><code>cd shortener-frontend\n\n# \u4f7f\u7528 pnpm (\u63a8\u8350)\npnpm install\n\n# \u6216\u4f7f\u7528 npm\nnpm install\n</code></pre>"},{"location":"frontend/#_6","title":"\u672c\u5730\u5f00\u53d1","text":"<pre><code># \u542f\u52a8\u5f00\u53d1\u670d\u52a1\u5668\npnpm dev\n\n# \u8bbf\u95ee http://localhost:8000\n</code></pre>"},{"location":"frontend/#_7","title":"\u6784\u5efa","text":"<pre><code># \u751f\u4ea7\u6784\u5efa\npnpm build\n\n# \u9884\u89c8\u6784\u5efa\u7ed3\u679c\npnpm preview\n</code></pre>"},{"location":"frontend/#_8","title":"\u2728 \u4e3b\u8981\u7279\u6027","text":"<ul> <li>\ud83c\udfa8 \u57fa\u4e8e Semi Design \u7684\u73b0\u4ee3\u5316 UI</li> <li>\ud83d\udcf1 \u54cd\u5e94\u5f0f\u8bbe\u8ba1\uff0c\u652f\u6301\u79fb\u52a8\u7aef</li> <li>\u26a1 Vite \u5feb\u901f\u6784\u5efa\u548c\u70ed\u91cd\u8f7d</li> <li>\ud83d\udd27 \u5b8c\u6574\u7684 TypeScript \u652f\u6301</li> <li>\ud83e\uddea \u5168\u9762\u7684\u6d4b\u8bd5\u8986\u76d6</li> <li>\ud83c\udf10 \u56fd\u9645\u5316\u652f\u6301</li> </ul>"},{"location":"frontend/#_9","title":"\ud83d\udee0\ufe0f \u6280\u672f\u6808","text":"<ul> <li>\u6846\u67b6: React 19.2.0</li> <li>\u8bed\u8a00: TypeScript 5.9.3</li> <li>UI \u5e93: Semi Design 2.87.1</li> <li>\u8def\u7531: React Router DOM 7.9.4</li> <li>\u6784\u5efa\u5de5\u5177: Vite 7.1.10</li> <li>\u6d4b\u8bd5: Vitest 3.2.4</li> </ul>"},{"location":"frontend/#_10","title":"\ud83d\udcd6 \u8be6\u7ec6\u6587\u6863","text":"<ul> <li>\u7ec4\u4ef6\u6587\u6863 - \u4e86\u89e3\u5982\u4f55\u4f7f\u7528\u5404\u4e2a\u7ec4\u4ef6</li> <li>\u90e8\u7f72\u6307\u5357 - \u4e86\u89e3\u5982\u4f55\u90e8\u7f72\u5230\u751f\u4ea7\u73af\u5883</li> </ul>"},{"location":"frontend/#_11","title":"\ud83d\udd27 \u914d\u7f6e","text":""},{"location":"frontend/#_12","title":"\u73af\u5883\u53d8\u91cf","text":"<p>\u521b\u5efa <code>.env.local</code> \u6587\u4ef6\uff1a</p> <pre><code># API \u57fa\u7840\u5730\u5740\nVITE_API_BASE_URL=http://localhost:8080\n\n# \u5e94\u7528\u6807\u9898\nVITE_APP_TITLE=Shortener\n</code></pre>"},{"location":"frontend/#_13","title":"\u4e3b\u9898\u5b9a\u5236","text":"<p>\u5728 <code>config/theme.ts</code> \u4e2d\u81ea\u5b9a\u4e49\u4e3b\u9898\uff1a</p> <pre><code>export const semiTheme = {\n  palette: {\n    primary: '#1890ff',\n    secondary: '#722ed1',\n  },\n};\n</code></pre>"},{"location":"frontend/#_14","title":"\ud83e\uddea \u6d4b\u8bd5","text":"<pre><code># \u8fd0\u884c\u6d4b\u8bd5\npnpm test\n\n# \u751f\u6210\u8986\u76d6\u7387\u62a5\u544a\npnpm test:coverage\n</code></pre>"},{"location":"frontend/#_15","title":"\ud83d\udce6 \u6784\u5efa\u4f18\u5316","text":"<p>\u9879\u76ee\u5df2\u5b9e\u73b0\u4ee5\u4e0b\u4f18\u5316\uff1a</p> <ul> <li>\u4ee3\u7801\u5206\u5272\u548c\u61d2\u52a0\u8f7d</li> <li>\u7ec4\u4ef6\u7ea7\u522b\u7684\u6027\u80fd\u4f18\u5316</li> <li>\u8d44\u6e90\u538b\u7f29\u548c\u7f13\u5b58</li> <li>Tree shaking</li> </ul>"},{"location":"frontend/#_16","title":"\ud83c\udf10 \u6d4f\u89c8\u5668\u652f\u6301","text":"<ul> <li>Chrome &gt;= 60</li> <li>Firefox &gt;= 55</li> <li>Safari &gt;= 12</li> <li>Edge &gt;= 79</li> </ul>"},{"location":"frontend/COMPONENTS/","title":"\u7ec4\u4ef6\u4f7f\u7528\u6587\u6863","text":"<p>\u672c\u6587\u6863\u8be6\u7ec6\u4ecb\u7ecd\u4e86\u9879\u76ee\u4e2d\u5404\u4e2a\u7ec4\u4ef6\u7684\u4f7f\u7528\u65b9\u6cd5\u548c API\u3002</p>"},{"location":"frontend/COMPONENTS/#_2","title":"\u76ee\u5f55","text":"<ul> <li>SemiTable \u8868\u683c\u7ec4\u4ef6</li> <li>SemiForm \u8868\u5355\u7ec4\u4ef6</li> <li>SemiModalForm \u6a21\u6001\u6846\u8868\u5355</li> <li>AvatarDropdown \u7528\u6237\u4e0b\u62c9\u83dc\u5355</li> <li>MainLayout \u4e3b\u5e03\u5c40</li> </ul>"},{"location":"frontend/COMPONENTS/#semitable","title":"SemiTable \u8868\u683c\u7ec4\u4ef6","text":"<p>\u57fa\u4e8e Semi Design Table \u7ec4\u4ef6\u7684\u589e\u5f3a\u7248\u672c\uff0c\u63d0\u4f9b\u4e86\u5206\u9875\u3001\u6392\u5e8f\u3001\u641c\u7d22\u3001\u64cd\u4f5c\u7b49\u529f\u80fd\u3002</p>"},{"location":"frontend/COMPONENTS/#_3","title":"\u57fa\u672c\u7528\u6cd5","text":"<pre><code>import { SemiTable } from '@/components';\nimport type { SemiTableColumn } from '@/components/SemiTable';\n\ninterface DataType {\n  id: number;\n  name: string;\n  status: string;\n  createdAt: string;\n}\n\nconst columns: SemiTableColumn&lt;DataType&gt;[] = [\n  {\n    title: '\u540d\u79f0',\n    dataIndex: 'name',\n    key: 'name',\n  },\n  {\n    title: '\u72b6\u6001',\n    dataIndex: 'status',\n    key: 'status',\n    valueEnum: {\n      active: { text: '\u6d3b\u8dc3', status: 'success' },\n      inactive: { text: '\u975e\u6d3b\u8dc3', status: 'danger' },\n    },\n  },\n  {\n    title: '\u521b\u5efa\u65f6\u95f4',\n    dataIndex: 'createdAt',\n    key: 'createdAt',\n    valueType: 'dateTime',\n  },\n];\n\n&lt;SemiTable&lt;DataType&gt;\n  headerTitle=\"\u6570\u636e\u5217\u8868\"\n  columns={columns}\n  request={async (params) =&gt; {\n    const response = await fetchData(params);\n    return {\n      data: response.data,\n      success: true,\n      total: response.total,\n    };\n  }}\n/&gt;\n</code></pre>"},{"location":"frontend/COMPONENTS/#_4","title":"\u5e26\u641c\u7d22\u529f\u80fd","text":"<pre><code>&lt;SemiTable&lt;DataType&gt;\n  headerTitle=\"\u6570\u636e\u5217\u8868\"\n  columns={columns}\n  request={fetchData}\n  search={{\n    labelWidth: 'auto',\n    span: 8,\n  }}\n  searchFormRender={(form, props) =&gt; [\n    &lt;Form.Input\n      key=\"name\"\n      field=\"name\"\n      label=\"\u540d\u79f0\"\n      placeholder=\"\u8bf7\u8f93\u5165\u540d\u79f0\"\n    /&gt;,\n    &lt;Form.Select\n      key=\"status\"\n      field=\"status\"\n      label=\"\u72b6\u6001\"\n      placeholder=\"\u8bf7\u9009\u62e9\u72b6\u6001\"\n      optionList={[\n        { label: '\u6d3b\u8dc3', value: 'active' },\n        { label: '\u975e\u6d3b\u8dc3', value: 'inactive' },\n      ]}\n    /&gt;,\n  ]}\n/&gt;\n</code></pre>"},{"location":"frontend/COMPONENTS/#_5","title":"\u53ef\u590d\u5236\u5217","text":"<pre><code>const columns: SemiTableColumn&lt;DataType&gt;[] = [\n  {\n    title: 'URL',\n    dataIndex: 'url',\n    key: 'url',\n    copyable: true, // \u542f\u7528\u590d\u5236\u529f\u80fd\n  },\n];\n</code></pre>"},{"location":"frontend/COMPONENTS/#api","title":"API","text":"\u5c5e\u6027 \u8bf4\u660e \u7c7b\u578b \u9ed8\u8ba4\u503c headerTitle \u8868\u683c\u6807\u9898 <code>string</code> - columns \u8868\u683c\u5217\u914d\u7f6e <code>SemiTableColumn&lt;T&gt;[]</code> - request \u6570\u636e\u8bf7\u6c42\u51fd\u6570 <code>(params: any) =&gt; Promise&lt;RequestResult&lt;T&gt;&gt;</code> - search \u641c\u7d22\u914d\u7f6e <code>SearchConfig \\| false</code> <code>false</code> searchFormRender \u81ea\u5b9a\u4e49\u641c\u7d22\u8868\u5355 <code>(form: FormApi, props: any) =&gt; ReactNode[]</code> - pagination \u5206\u9875\u914d\u7f6e <code>PaginationConfig \\| false</code> <code>{ pageSize: 10 }</code> actionRef \u64cd\u4f5c\u5f15\u7528 <code>MutableRefObject&lt;ActionType&gt;</code> -"},{"location":"frontend/COMPONENTS/#semiform","title":"SemiForm \u8868\u5355\u7ec4\u4ef6","text":"<p>\u57fa\u4e8e Semi Design Form \u7684\u5c01\u88c5\u7ec4\u4ef6\uff0c\u63d0\u4f9b\u4e86\u7edf\u4e00\u7684\u8868\u5355\u5904\u7406\u903b\u8f91\u3002</p>"},{"location":"frontend/COMPONENTS/#_6","title":"\u57fa\u672c\u7528\u6cd5","text":"<pre><code>import { SemiForm } from '@/components';\nimport type { SemiFormRef } from '@/components/SemiForm/types';\n\nconst formRef = useRef&lt;SemiFormRef&gt;(null);\n\n&lt;SemiForm\n  ref={formRef}\n  onFinish={async (values) =&gt; {\n    console.log('\u8868\u5355\u6570\u636e:', values);\n    await submitData(values);\n  }}\n  onFinishFailed={(error) =&gt; {\n    console.error('\u63d0\u4ea4\u5931\u8d25:', error);\n  }}\n  initialValues={{\n    name: '',\n    email: '',\n  }}\n&gt;\n  &lt;Form.Input\n    field=\"name\"\n    label=\"\u59d3\u540d\"\n    rules={[{ required: true, message: '\u8bf7\u8f93\u5165\u59d3\u540d' }]}\n  /&gt;\n  &lt;Form.Input\n    field=\"email\"\n    label=\"\u90ae\u7bb1\"\n    rules={[\n      { required: true, message: '\u8bf7\u8f93\u5165\u90ae\u7bb1' },\n      { type: 'email', message: '\u8bf7\u8f93\u5165\u6709\u6548\u7684\u90ae\u7bb1\u5730\u5740' },\n    ]}\n  /&gt;\n  &lt;Button htmlType=\"submit\"&gt;\u63d0\u4ea4&lt;/Button&gt;\n&lt;/SemiForm&gt;\n</code></pre>"},{"location":"frontend/COMPONENTS/#_7","title":"\u5916\u90e8\u63a7\u5236","text":"<pre><code>const handleSubmit = async () =&gt; {\n  await formRef.current?.submit();\n};\n\nconst handleReset = () =&gt; {\n  formRef.current?.reset();\n};\n\nconst handleSetValues = () =&gt; {\n  formRef.current?.setValues({\n    name: 'John Doe',\n    email: 'john@example.com',\n  });\n};\n</code></pre>"},{"location":"frontend/COMPONENTS/#api_1","title":"API","text":"\u5c5e\u6027 \u8bf4\u660e \u7c7b\u578b \u9ed8\u8ba4\u503c onFinish \u8868\u5355\u63d0\u4ea4\u6210\u529f\u56de\u8c03 <code>(values: any) =&gt; Promise&lt;void&gt; \\| void</code> - onFinishFailed \u8868\u5355\u63d0\u4ea4\u5931\u8d25\u56de\u8c03 <code>(error: any) =&gt; void</code> - initialValues \u521d\u59cb\u503c <code>Record&lt;string, any&gt;</code> - children \u8868\u5355\u5185\u5bb9 <code>ReactNode</code> -"},{"location":"frontend/COMPONENTS/#ref","title":"Ref \u65b9\u6cd5","text":"\u65b9\u6cd5 \u8bf4\u660e \u7c7b\u578b submit \u63d0\u4ea4\u8868\u5355 <code>() =&gt; Promise&lt;void&gt;</code> reset \u91cd\u7f6e\u8868\u5355 <code>() =&gt; void</code> setValues \u8bbe\u7f6e\u8868\u5355\u503c <code>(values: Record&lt;string, any&gt;) =&gt; void</code>"},{"location":"frontend/COMPONENTS/#semimodalform","title":"SemiModalForm \u6a21\u6001\u6846\u8868\u5355","text":"<p>\u7ed3\u5408 Modal \u548c Form \u7684\u7ec4\u4ef6\uff0c\u7528\u4e8e\u5f39\u7a97\u4e2d\u7684\u8868\u5355\u64cd\u4f5c\u3002</p>"},{"location":"frontend/COMPONENTS/#_8","title":"\u57fa\u672c\u7528\u6cd5","text":"<pre><code>import { SemiModalForm } from '@/components';\n\nconst [visible, setVisible] = useState(false);\n\n&lt;SemiModalForm\n  title=\"\u65b0\u5efa\u7528\u6237\"\n  visible={visible}\n  onVisibleChange={setVisible}\n  onFinish={async (values) =&gt; {\n    await createUser(values);\n    setVisible(false);\n  }}\n  modalProps={{\n    width: 600,\n    maskClosable: false,\n  }}\n&gt;\n  &lt;Form.Input\n    field=\"name\"\n    label=\"\u59d3\u540d\"\n    rules={[{ required: true, message: '\u8bf7\u8f93\u5165\u59d3\u540d' }]}\n  /&gt;\n  &lt;Form.Input\n    field=\"email\"\n    label=\"\u90ae\u7bb1\"\n    rules={[{ required: true, message: '\u8bf7\u8f93\u5165\u90ae\u7bb1' }]}\n  /&gt;\n&lt;/SemiModalForm&gt;\n</code></pre>"},{"location":"frontend/COMPONENTS/#api_2","title":"API","text":"\u5c5e\u6027 \u8bf4\u660e \u7c7b\u578b \u9ed8\u8ba4\u503c title \u6a21\u6001\u6846\u6807\u9898 <code>string</code> - visible \u662f\u5426\u663e\u793a <code>boolean</code> <code>false</code> onVisibleChange \u663e\u793a\u72b6\u6001\u6539\u53d8\u56de\u8c03 <code>(visible: boolean) =&gt; void</code> - onFinish \u8868\u5355\u63d0\u4ea4\u6210\u529f\u56de\u8c03 <code>(values: any) =&gt; Promise&lt;void&gt; \\| void</code> - modalProps Modal \u7ec4\u4ef6\u5c5e\u6027 <code>ModalProps</code> - formProps Form \u7ec4\u4ef6\u5c5e\u6027 <code>FormProps</code> - children \u8868\u5355\u5185\u5bb9 <code>ReactNode</code> -"},{"location":"frontend/COMPONENTS/#avatardropdown","title":"AvatarDropdown \u7528\u6237\u4e0b\u62c9\u83dc\u5355","text":"<p>\u7528\u6237\u5934\u50cf\u548c\u4e0b\u62c9\u83dc\u5355\u7ec4\u4ef6\u3002</p>"},{"location":"frontend/COMPONENTS/#_9","title":"\u57fa\u672c\u7528\u6cd5","text":"<pre><code>import { AvatarDropdown } from '@/components';\n\n&lt;AvatarDropdown\n  currentUser={{\n    name: 'John Doe',\n    avatar: 'https://example.com/avatar.jpg',\n    email: 'john@example.com',\n  }}\n  onLogout={() =&gt; {\n    // \u5904\u7406\u767b\u51fa\u903b\u8f91\n    logout();\n  }}\n/&gt;\n</code></pre>"},{"location":"frontend/COMPONENTS/#api_3","title":"API","text":"\u5c5e\u6027 \u8bf4\u660e \u7c7b\u578b \u9ed8\u8ba4\u503c currentUser \u5f53\u524d\u7528\u6237\u4fe1\u606f <code>CurrentUser</code> - onLogout \u767b\u51fa\u56de\u8c03 <code>() =&gt; void</code> -"},{"location":"frontend/COMPONENTS/#mainlayout","title":"MainLayout \u4e3b\u5e03\u5c40","text":"<p>\u5e94\u7528\u7684\u4e3b\u8981\u5e03\u5c40\u7ec4\u4ef6\uff0c\u5305\u542b\u5bfc\u822a\u3001\u4fa7\u8fb9\u680f\u3001\u5185\u5bb9\u533a\u57df\u7b49\u3002</p>"},{"location":"frontend/COMPONENTS/#_10","title":"\u57fa\u672c\u7528\u6cd5","text":"<pre><code>import MainLayout from '@/layouts/MainLayout';\n\n// \u5728\u8def\u7531\u4e2d\u4f7f\u7528\n&lt;Route path=\"/\" element={&lt;MainLayout /&gt;}&gt;\n  &lt;Route path=\"dashboard\" element={&lt;Dashboard /&gt;} /&gt;\n  &lt;Route path=\"users\" element={&lt;Users /&gt;} /&gt;\n&lt;/Route&gt;\n</code></pre>"},{"location":"frontend/COMPONENTS/#_11","title":"\u7279\u6027","text":"<ul> <li>\u54cd\u5e94\u5f0f\u8bbe\u8ba1\uff0c\u81ea\u52a8\u9002\u914d\u684c\u9762\u7aef\u548c\u79fb\u52a8\u7aef</li> <li>\u53ef\u6298\u53e0\u7684\u4fa7\u8fb9\u680f</li> <li>\u79fb\u52a8\u7aef\u62bd\u5c49\u5f0f\u5bfc\u822a</li> <li>\u7528\u6237\u4fe1\u606f\u663e\u793a\u548c\u767b\u51fa\u529f\u80fd</li> <li>\u9762\u5305\u5c51\u5bfc\u822a\uff08\u53ef\u9009\uff09</li> </ul>"},{"location":"frontend/COMPONENTS/#_12","title":"\u81ea\u5b9a\u4e49\u5bfc\u822a","text":"<p>\u5bfc\u822a\u83dc\u5355\u9879\u5728\u7ec4\u4ef6\u5185\u90e8\u5b9a\u4e49\uff0c\u5982\u9700\u4fee\u6539\u8bf7\u7f16\u8f91 <code>src/layouts/MainLayout.tsx</code> \u6587\u4ef6\u4e2d\u7684 <code>navItems</code> \u914d\u7f6e\u3002</p> <pre><code>const navItems = [\n  {\n    itemKey: '/dashboard',\n    text: '\u4eea\u8868\u76d8',\n    icon: &lt;IconHome /&gt;,\n  },\n  {\n    itemKey: '/users',\n    text: '\u7528\u6237\u7ba1\u7406',\n    icon: &lt;IconUser /&gt;,\n  },\n  // \u6dfb\u52a0\u66f4\u591a\u83dc\u5355\u9879...\n];\n</code></pre>"},{"location":"frontend/COMPONENTS/#_13","title":"\u6027\u80fd\u4f18\u5316\u5efa\u8bae","text":""},{"location":"frontend/COMPONENTS/#1-reactmemo","title":"1. \u4f7f\u7528 React.memo","text":"<p>\u5bf9\u4e8e\u4e0d\u7ecf\u5e38\u53d8\u5316\u7684\u7ec4\u4ef6\uff0c\u4f7f\u7528 <code>React.memo</code> \u8fdb\u884c\u4f18\u5316\uff1a</p> <pre><code>const MyComponent = React.memo(({ data }) =&gt; {\n  return &lt;div&gt;{data.name}&lt;/div&gt;;\n});\n</code></pre>"},{"location":"frontend/COMPONENTS/#2-usememo-usecallback","title":"2. \u5408\u7406\u4f7f\u7528 useMemo \u548c useCallback","text":"<pre><code>const ExpensiveComponent = ({ items, onItemClick }) =&gt; {\n  const expensiveValue = useMemo(() =&gt; {\n    return items.reduce((sum, item) =&gt; sum + item.value, 0);\n  }, [items]);\n\n  const handleClick = useCallback((id) =&gt; {\n    onItemClick(id);\n  }, [onItemClick]);\n\n  return (\n    &lt;div&gt;\n      &lt;div&gt;Total: {expensiveValue}&lt;/div&gt;\n      {items.map(item =&gt; (\n        &lt;Item key={item.id} onClick={() =&gt; handleClick(item.id)} /&gt;\n      ))}\n    &lt;/div&gt;\n  );\n};\n</code></pre>"},{"location":"frontend/COMPONENTS/#3","title":"3. \u8868\u683c\u6570\u636e\u4f18\u5316","text":"<p>\u5bf9\u4e8e\u5927\u91cf\u6570\u636e\u7684\u8868\u683c\uff0c\u8003\u8651\u4f7f\u7528\u865a\u62df\u6eda\u52a8\u6216\u5206\u9875\uff1a</p> <pre><code>&lt;SemiTable\n  pagination={{\n    pageSize: 50, // \u5408\u7406\u7684\u5206\u9875\u5927\u5c0f\n    showSizeChanger: true,\n    showQuickJumper: true,\n  }}\n  scroll={{ y: 400 }} // \u56fa\u5b9a\u9ad8\u5ea6\uff0c\u542f\u7528\u6eda\u52a8\n/&gt;\n</code></pre>"},{"location":"frontend/COMPONENTS/#_14","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"frontend/COMPONENTS/#q","title":"Q: \u5982\u4f55\u81ea\u5b9a\u4e49\u8868\u683c\u7684\u64cd\u4f5c\u5217\uff1f","text":"<p>A: \u5728 columns \u914d\u7f6e\u4e2d\u6dfb\u52a0\u64cd\u4f5c\u5217\uff1a</p> <pre><code>const columns = [\n  // \u5176\u4ed6\u5217...\n  {\n    title: '\u64cd\u4f5c',\n    key: 'action',\n    render: (text, record) =&gt; (\n      &lt;Space&gt;\n        &lt;Button size=\"small\" onClick={() =&gt; handleEdit(record)}&gt;\n          \u7f16\u8f91\n        &lt;/Button&gt;\n        &lt;Button size=\"small\" type=\"danger\" onClick={() =&gt; handleDelete(record)}&gt;\n          \u5220\u9664\n        &lt;/Button&gt;\n      &lt;/Space&gt;\n    ),\n  },\n];\n</code></pre>"},{"location":"frontend/COMPONENTS/#q_1","title":"Q: \u5982\u4f55\u5904\u7406\u8868\u5355\u9a8c\u8bc1\uff1f","text":"<p>A: \u4f7f\u7528 Semi Design \u7684\u8868\u5355\u9a8c\u8bc1\u89c4\u5219\uff1a</p> <pre><code>&lt;Form.Input\n  field=\"email\"\n  label=\"\u90ae\u7bb1\"\n  rules={[\n    { required: true, message: '\u8bf7\u8f93\u5165\u90ae\u7bb1' },\n    { type: 'email', message: '\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e' },\n    {\n      validator: (rule, value) =&gt; {\n        if (value &amp;&amp; value.length &lt; 6) {\n          return Promise.reject('\u90ae\u7bb1\u957f\u5ea6\u4e0d\u80fd\u5c11\u4e8e6\u4f4d');\n        }\n        return Promise.resolve();\n      }\n    }\n  ]}\n/&gt;\n</code></pre>"},{"location":"frontend/COMPONENTS/#q_2","title":"Q: \u5982\u4f55\u5b9e\u73b0\u56fd\u9645\u5316\uff1f","text":"<p>A: \u9879\u76ee\u5df2\u914d\u7f6e Semi Design \u7684\u56fd\u9645\u5316\u652f\u6301\uff0c\u5982\u9700\u6dfb\u52a0\u66f4\u591a\u8bed\u8a00\uff1a</p> <ol> <li>\u5728 <code>src/locales/</code> \u76ee\u5f55\u4e0b\u6dfb\u52a0\u8bed\u8a00\u6587\u4ef6</li> <li>\u5728 <code>src/main.tsx</code> \u4e2d\u914d\u7f6e LocaleProvider</li> <li>\u4f7f\u7528 Semi Design \u7684\u56fd\u9645\u5316 API</li> </ol> <p>\u66f4\u591a\u95ee\u9898\u8bf7\u67e5\u770b Semi Design \u5b98\u65b9\u6587\u6863\u3002</p>"},{"location":"frontend/DEPLOYMENT/","title":"\u90e8\u7f72\u6307\u5357","text":"<p>\u672c\u6587\u6863\u8be6\u7ec6\u4ecb\u7ecd\u4e86\u5982\u4f55\u5c06 Shortener Frontend \u90e8\u7f72\u5230\u4e0d\u540c\u7684\u73af\u5883\u4e2d\u3002</p>"},{"location":"frontend/DEPLOYMENT/#_2","title":"\u76ee\u5f55","text":"<ul> <li>\u6784\u5efa\u51c6\u5907</li> <li>\u73af\u5883\u53d8\u91cf\u914d\u7f6e</li> <li>Docker \u90e8\u7f72</li> <li>\u4e91\u670d\u52a1\u90e8\u7f72</li> <li>\u6027\u80fd\u4f18\u5316</li> <li>\u76d1\u63a7\u548c\u65e5\u5fd7</li> </ul>"},{"location":"frontend/DEPLOYMENT/#_3","title":"\u6784\u5efa\u51c6\u5907","text":""},{"location":"frontend/DEPLOYMENT/#_4","title":"\u7cfb\u7edf\u8981\u6c42","text":"<ul> <li>Node.js &gt;= 18.0.0</li> <li>pnpm &gt;= 10.0.0 (\u63a8\u8350) \u6216 npm &gt;= 9.0.0</li> <li>\u81f3\u5c11 2GB \u53ef\u7528\u5185\u5b58\u7528\u4e8e\u6784\u5efa</li> </ul>"},{"location":"frontend/DEPLOYMENT/#_5","title":"\u6784\u5efa\u6b65\u9aa4","text":"<ol> <li>\u5b89\u88c5\u4f9d\u8d56</li> </ol> <pre><code>pnpm install --frozen-lockfile\n</code></pre> <ol> <li>\u7c7b\u578b\u68c0\u67e5</li> </ol> <pre><code>pnpm type-check\n</code></pre> <ol> <li>\u4ee3\u7801\u8d28\u91cf\u68c0\u67e5</li> </ol> <pre><code>pnpm lint\n</code></pre> <ol> <li>\u8fd0\u884c\u6d4b\u8bd5</li> </ol> <pre><code>pnpm test\n</code></pre> <ol> <li>\u751f\u4ea7\u6784\u5efa</li> </ol> <pre><code>pnpm build\n</code></pre> <p>\u6784\u5efa\u5b8c\u6210\u540e\uff0c\u6240\u6709\u9759\u6001\u6587\u4ef6\u5c06\u751f\u6210\u5728 <code>dist/</code> \u76ee\u5f55\u4e2d\u3002</p>"},{"location":"frontend/DEPLOYMENT/#_6","title":"\u73af\u5883\u53d8\u91cf\u914d\u7f6e","text":""},{"location":"frontend/DEPLOYMENT/#envdevelopment","title":"\u5f00\u53d1\u73af\u5883 (.env.development)","text":"<pre><code># API \u57fa\u7840\u5730\u5740\nVITE_API_BASE_URL=http://localhost:8080\n\n# \u5e94\u7528\u6807\u9898\nVITE_APP_TITLE=Shortener (\u5f00\u53d1)\n\n# \u662f\u5426\u542f\u7528\u8c03\u8bd5\u6a21\u5f0f\nVITE_DEBUG=true\n\n# \u662f\u5426\u542f\u7528 Mock \u6570\u636e\nVITE_USE_MOCK=false\n</code></pre>"},{"location":"frontend/DEPLOYMENT/#envproduction","title":"\u751f\u4ea7\u73af\u5883 (.env.production)","text":"<pre><code># API \u57fa\u7840\u5730\u5740\nVITE_API_BASE_URL=https://api.yourdomain.com\n\n# \u5e94\u7528\u6807\u9898\nVITE_APP_TITLE=Shortener\n\n# \u662f\u5426\u542f\u7528\u8c03\u8bd5\u6a21\u5f0f\nVITE_DEBUG=false\n\n# \u662f\u5426\u542f\u7528 Mock \u6570\u636e\nVITE_USE_MOCK=false\n\n# CDN \u5730\u5740 (\u53ef\u9009)\nVITE_CDN_URL=https://cdn.yourdomain.com\n\n# \u5e94\u7528\u7248\u672c\nVITE_APP_VERSION=2.0.0\n</code></pre>"},{"location":"frontend/DEPLOYMENT/#docker","title":"Docker \u90e8\u7f72","text":""},{"location":"frontend/DEPLOYMENT/#static-web-server","title":"\u4f7f\u7528 Static Web Server","text":"<p>\u6211\u4eec\u4f7f\u7528 static-web-server \u4f5c\u4e3a\u751f\u4ea7\u73af\u5883\u7684\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668\uff0c\u5b83\u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u3001\u8f7b\u91cf\u7ea7\u7684\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668\u3002</p> <p>\u521b\u5efa <code>Dockerfile</code>\uff1a</p> <pre><code># \u6784\u5efa\u9636\u6bb5\nFROM node:20-alpine as builder\n\nWORKDIR /app\n\nCOPY package*.json pnpm-lock.yaml ./\n\nRUN corepack enable &amp;&amp; corepack prepare pnpm@10.18.3 --activate\n\nRUN pnpm install --frozen-lockfile\n\nCOPY . .\n\nRUN pnpm build\n\n# \u751f\u4ea7\u9636\u6bb5\nFROM joseluisq/static-web-server:2\n\nCOPY --from=builder /app/dist /public\n\nEXPOSE 8080\n\nENV SERVER_PORT=8080 \\\n    SERVER_ROOT=/public \\\n    SERVER_LOG_LEVEL=info \\\n    SERVER_FALLBACK_PAGE=/public/index.html \\\n    SERVER_COMPRESSION_GZIP=true \\\n    SERVER_COMPRESSION_BROTLI=true \\\n    SERVER_CACHE_CONTROL_HEADERS=true\n</code></pre>"},{"location":"frontend/DEPLOYMENT/#docker-compose","title":"Docker Compose \u90e8\u7f72","text":"<p>\u521b\u5efa <code>docker-compose.yml</code>\uff1a</p> <pre><code>version: '3.8'\n\nservices:\n  shortener-frontend:\n    build:\n      context: ../shortener-frontend\n      dockerfile: ../docker/Dockerfile.frontend\n    container_name: shortener-frontend\n    ports:\n      - \"80:8080\"\n    environment:\n      - SERVER_PORT=8080\n      - SERVER_ROOT=/public\n      - SERVER_LOG_LEVEL=info\n      - SERVER_FALLBACK_PAGE=/public/index.html\n      - SERVER_COMPRESSION_GZIP=true\n      - SERVER_COMPRESSION_BROTLI=true\n      - SERVER_CACHE_CONTROL_HEADERS=true\n    restart: unless-stopped\n    networks:\n      - shortener-network\n\nnetworks:\n  shortener-network:\n    driver: bridge\n    name: shortener-network\n</code></pre>"},{"location":"frontend/DEPLOYMENT/#_7","title":"\u6784\u5efa\u548c\u8fd0\u884c","text":"<pre><code># \u6784\u5efa\u955c\u50cf\ndocker build -f docker/Dockerfile.frontend -t shortener-frontend ./shortener-frontend\n\n# \u8fd0\u884c\u5bb9\u5668\ndocker run -d \\\n  --name shortener-frontend \\\n  -p 80:8080 \\\n  -e SERVER_LOG_LEVEL=info \\\n  shortener-frontend\n\n# \u6216\u4f7f\u7528 docker-compose\ndocker-compose -f docker/docker-compose.frontend.yml up -d\n</code></pre>"},{"location":"frontend/DEPLOYMENT/#static-web-server_1","title":"Static Web Server \u73af\u5883\u53d8\u91cf","text":"<p>\u5e38\u7528\u73af\u5883\u53d8\u91cf\u914d\u7f6e\uff1a</p> \u53d8\u91cf\u540d \u9ed8\u8ba4\u503c \u8bf4\u660e <code>SERVER_PORT</code> 8080 \u670d\u52a1\u76d1\u542c\u7aef\u53e3 <code>SERVER_ROOT</code> /public \u9759\u6001\u6587\u4ef6\u6839\u76ee\u5f55 <code>SERVER_LOG_LEVEL</code> error \u65e5\u5fd7\u7ea7\u522b (error/warn/info/debug/trace) <code>SERVER_FALLBACK_PAGE</code> - SPA \u8def\u7531\u56de\u9000\u9875\u9762 <code>SERVER_COMPRESSION_GZIP</code> false \u542f\u7528 Gzip \u538b\u7f29 <code>SERVER_COMPRESSION_BROTLI</code> false \u542f\u7528 Brotli \u538b\u7f29 <code>SERVER_CACHE_CONTROL_HEADERS</code> false \u542f\u7528\u7f13\u5b58\u63a7\u5236\u5934 <code>SERVER_CORS_ALLOW_ORIGINS</code> - CORS \u5141\u8bb8\u7684\u6e90 <p>\u66f4\u591a\u914d\u7f6e\u9009\u9879\u8bf7\u53c2\u8003\uff1ahttps://static-web-server.net/configuration/environment-variables/</p>"},{"location":"frontend/DEPLOYMENT/#_8","title":"\u4e91\u670d\u52a1\u90e8\u7f72","text":""},{"location":"frontend/DEPLOYMENT/#vercel","title":"Vercel \u90e8\u7f72","text":"<ol> <li>\u5b89\u88c5 Vercel CLI</li> </ol> <pre><code>npm i -g vercel\n</code></pre> <ol> <li>\u914d\u7f6e vercel.json</li> </ol> <pre><code>{\n  \"version\": 2,\n  \"builds\": [\n    {\n      \"src\": \"package.json\",\n      \"use\": \"@vercel/static-build\",\n      \"config\": {\n        \"distDir\": \"dist\"\n      }\n    }\n  ],\n  \"routes\": [\n    {\n      \"handle\": \"filesystem\"\n    },\n    {\n      \"src\": \"/(.*)\",\n      \"dest\": \"/index.html\"\n    }\n  ],\n  \"env\": {\n    \"VITE_API_BASE_URL\": \"@api_base_url\"\n  }\n}\n</code></pre> <ol> <li>\u90e8\u7f72</li> </ol> <pre><code>vercel --prod\n</code></pre>"},{"location":"frontend/DEPLOYMENT/#netlify","title":"Netlify \u90e8\u7f72","text":"<ol> <li>\u914d\u7f6e netlify.toml</li> </ol> <pre><code>[build]\n  publish = \"dist\"\n  command = \"pnpm build\"\n\n[build.environment]\n  NODE_VERSION = \"20\"\n\n[[redirects]]\n  from = \"/*\"\n  to = \"/index.html\"\n  status = 200\n\n[[headers]]\n  for = \"/assets/*\"\n  [headers.values]\n    Cache-Control = \"public, max-age=31536000, immutable\"\n</code></pre> <ol> <li>\u90e8\u7f72</li> </ol> <pre><code># \u5b89\u88c5 Netlify CLI\nnpm install -g netlify-cli\n\n# \u90e8\u7f72\nnetlify deploy --prod --dir=dist\n</code></pre>"},{"location":"frontend/DEPLOYMENT/#aws-s3-cloudfront","title":"AWS S3 + CloudFront \u90e8\u7f72","text":"<ol> <li>\u6784\u5efa\u5e76\u4e0a\u4f20\u5230 S3</li> </ol> <pre><code># \u6784\u5efa\npnpm build\n\n# \u4e0a\u4f20\u5230 S3\naws s3 sync dist/ s3://your-bucket-name --delete\n\n# \u8bbe\u7f6e\u7f13\u5b58\u7b56\u7565\naws s3 cp dist/index.html s3://your-bucket-name/index.html \\\n  --cache-control \"no-cache\"\n</code></pre> <ol> <li>\u914d\u7f6e CloudFront</li> </ol> <p>\u521b\u5efa CloudFront \u5206\u53d1\uff0c\u914d\u7f6e\uff1a - Origin: S3 bucket - Default Root Object: index.html - Error Pages: 404 -&gt; /index.html (for SPA routing) - Caching: \u6839\u636e\u6587\u4ef6\u7c7b\u578b\u8bbe\u7f6e\u4e0d\u540c\u7684\u7f13\u5b58\u7b56\u7565</p>"},{"location":"frontend/DEPLOYMENT/#_9","title":"\u6027\u80fd\u4f18\u5316","text":""},{"location":"frontend/DEPLOYMENT/#1","title":"1. \u538b\u7f29\u914d\u7f6e","text":"<p>Static Web Server \u5185\u7f6e\u652f\u6301 Gzip \u548c Brotli \u538b\u7f29\uff1a</p> <pre><code># \u542f\u7528\u538b\u7f29\nSERVER_COMPRESSION_GZIP=true\nSERVER_COMPRESSION_BROTLI=true\n</code></pre>"},{"location":"frontend/DEPLOYMENT/#2","title":"2. \u7f13\u5b58\u7b56\u7565","text":"<p>Static Web Server \u81ea\u52a8\u4e3a\u9759\u6001\u8d44\u6e90\u8bbe\u7f6e\u5408\u9002\u7684\u7f13\u5b58\u5934\uff1a</p> <pre><code># \u542f\u7528\u7f13\u5b58\u63a7\u5236\nSERVER_CACHE_CONTROL_HEADERS=true\n</code></pre>"},{"location":"frontend/DEPLOYMENT/#3-http2","title":"3. HTTP/2 \u652f\u6301","text":"<p>Static Web Server \u539f\u751f\u652f\u6301 HTTP/2\uff0c\u65e0\u9700\u989d\u5916\u914d\u7f6e\u3002</p>"},{"location":"frontend/DEPLOYMENT/#4","title":"4. \u9884\u52a0\u8f7d\u5173\u952e\u8d44\u6e90","text":"<p>\u5728 <code>index.html</code> \u4e2d\u6dfb\u52a0\uff1a</p> <pre><code>&lt;link rel=\"preload\" href=\"/assets/main.js\" as=\"script\"&gt;\n&lt;link rel=\"preload\" href=\"/assets/main.css\" as=\"style\"&gt;\n</code></pre>"},{"location":"frontend/DEPLOYMENT/#_10","title":"\u76d1\u63a7\u548c\u65e5\u5fd7","text":""},{"location":"frontend/DEPLOYMENT/#1_1","title":"1. \u5e94\u7528\u76d1\u63a7","text":"<p>\u96c6\u6210\u5e94\u7528\u6027\u80fd\u76d1\u63a7\u5de5\u5177\uff1a</p> <pre><code>// \u5728 main.tsx \u4e2d\u6dfb\u52a0\nimport { initWebVitals } from './utils/performance';\n\n// \u521d\u59cb\u5316\u6027\u80fd\u76d1\u63a7\ninitWebVitals();\n</code></pre>"},{"location":"frontend/DEPLOYMENT/#2_1","title":"2. \u9519\u8bef\u76d1\u63a7","text":"<pre><code>// \u5168\u5c40\u9519\u8bef\u5904\u7406\nwindow.addEventListener('error', (event) =&gt; {\n  console.error('Global error:', event.error);\n  // \u53d1\u9001\u5230\u9519\u8bef\u76d1\u63a7\u670d\u52a1\n});\n\nwindow.addEventListener('unhandledrejection', (event) =&gt; {\n  console.error('Unhandled promise rejection:', event.reason);\n  // \u53d1\u9001\u5230\u9519\u8bef\u76d1\u63a7\u670d\u52a1\n});\n</code></pre>"},{"location":"frontend/DEPLOYMENT/#3","title":"3. \u65e5\u5fd7\u7ea7\u522b","text":"<p>\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u63a7\u5236\u65e5\u5fd7\u8f93\u51fa\uff1a</p> <pre><code># \u751f\u4ea7\u73af\u5883\nSERVER_LOG_LEVEL=error\n\n# \u5f00\u53d1\u73af\u5883\nSERVER_LOG_LEVEL=debug\n</code></pre>"},{"location":"frontend/DEPLOYMENT/#_11","title":"\u6545\u969c\u6392\u9664","text":""},{"location":"frontend/DEPLOYMENT/#_12","title":"\u5e38\u89c1\u95ee\u9898","text":"<ol> <li>\u767d\u5c4f\u95ee\u9898</li> <li>\u68c0\u67e5\u63a7\u5236\u53f0\u9519\u8bef</li> <li>\u786e\u8ba4\u9759\u6001\u8d44\u6e90\u8def\u5f84\u6b63\u786e</li> <li> <p>\u68c0\u67e5 API \u5730\u5740\u914d\u7f6e</p> </li> <li> <p>\u8def\u7531 404 \u9519\u8bef</p> </li> <li>\u786e\u8ba4\u8bbe\u7f6e\u4e86 <code>SERVER_FALLBACK_PAGE=/public/index.html</code></li> <li> <p>\u68c0\u67e5 SPA \u8def\u7531\u914d\u7f6e</p> </li> <li> <p>API \u8bf7\u6c42\u5931\u8d25</p> </li> <li>\u68c0\u67e5 CORS \u914d\u7f6e</li> <li>\u786e\u8ba4 API \u5730\u5740\u6b63\u786e</li> <li> <p>\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5</p> </li> <li> <p>\u6784\u5efa\u5931\u8d25</p> </li> <li>\u68c0\u67e5 Node.js \u7248\u672c</li> <li>\u6e05\u7406 node_modules \u91cd\u65b0\u5b89\u88c5</li> <li>\u68c0\u67e5\u5185\u5b58\u662f\u5426\u8db3\u591f</li> </ol>"},{"location":"frontend/DEPLOYMENT/#_13","title":"\u8c03\u8bd5\u5de5\u5177","text":"<pre><code># \u67e5\u770b\u5bb9\u5668\u65e5\u5fd7\ndocker logs shortener-frontend\n\n# \u8fdb\u5165\u5bb9\u5668\uff08\u6ce8\u610f\uff1a\u57fa\u4e8e scratch \u7684\u955c\u50cf\u65e0\u6cd5\u8fdb\u5165\uff09\n# \u4f7f\u7528 alpine \u7248\u672c\u8fdb\u884c\u8c03\u8bd5\ndocker run -it joseluisq/static-web-server:2-alpine sh\n\n# \u68c0\u67e5\u7aef\u53e3\u5360\u7528\nsudo netstat -tlnp | grep :8080\n\n# \u68c0\u67e5\u5bb9\u5668\u72b6\u6001\ndocker ps -a | grep shortener-frontend\n</code></pre>"},{"location":"frontend/DEPLOYMENT/#_14","title":"\u5b89\u5168\u5efa\u8bae","text":"<ol> <li>HTTPS \u914d\u7f6e</li> <li>\u4f7f\u7528\u53cd\u5411\u4ee3\u7406\uff08\u5982 Caddy\u3001Traefik\uff09\u5904\u7406 HTTPS</li> <li>\u914d\u7f6e HSTS \u5934</li> <li> <p>\u7981\u7528\u4e0d\u5b89\u5168\u7684 SSL/TLS \u7248\u672c</p> </li> <li> <p>\u5b89\u5168\u5934\u8bbe\u7f6e</p> </li> </ol> <p>\u4f7f\u7528\u53cd\u5411\u4ee3\u7406\u6dfb\u52a0\u5b89\u5168\u5934\uff1a</p> <pre><code># Caddy \u793a\u4f8b\nheader {\n    X-Frame-Options \"SAMEORIGIN\"\n    X-XSS-Protection \"1; mode=block\"\n    X-Content-Type-Options \"nosniff\"\n    Referrer-Policy \"strict-origin-when-cross-origin\"\n}\n</code></pre> <ol> <li>\u8bbf\u95ee\u63a7\u5236</li> <li>\u914d\u7f6e\u9632\u706b\u5899\u89c4\u5219</li> <li>\u9650\u5236\u8bbf\u95ee\u9891\u7387</li> <li> <p>\u4f7f\u7528 CDN \u9632\u62a4</p> </li> <li> <p>\u5b9a\u671f\u66f4\u65b0</p> </li> <li>\u53ca\u65f6\u66f4\u65b0\u4f9d\u8d56\u5305</li> <li>\u5b9a\u671f\u66f4\u65b0\u5bb9\u5668\u955c\u50cf</li> <li>\u76d1\u63a7\u5b89\u5168\u6f0f\u6d1e</li> </ol> <p>\u66f4\u591a\u90e8\u7f72\u76f8\u5173\u95ee\u9898\uff0c\u8bf7\u53c2\u8003 Static Web Server \u6587\u6863 \u6216\u8054\u7cfb\u6280\u672f\u652f\u6301\u3002</p>"},{"location":"general/","title":"\u901a\u7528\u6587\u6863","text":"<p>\u672c\u76ee\u5f55\u5305\u542b Shortener \u9879\u76ee\u7684\u901a\u7528\u6587\u6863\uff0c\u9002\u7528\u4e8e\u670d\u52a1\u5668\u548c CLI \u5de5\u5177\u3002</p>"},{"location":"general/#_2","title":"\u6587\u6863\u5217\u8868","text":"<ul> <li>\u5b89\u88c5\u6307\u5357 - \u8be6\u7ec6\u7684\u5b89\u88c5\u8bf4\u660e\u548c\u591a\u79cd\u5b89\u88c5\u65b9\u5f0f</li> <li>\u914d\u7f6e\u8bf4\u660e - \u670d\u52a1\u5668\u548c CLI \u914d\u7f6e\u9009\u9879</li> </ul>"},{"location":"general/#_3","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"general/#_4","title":"\u5b89\u88c5","text":"<p>\u67e5\u770b \u5b89\u88c5\u6307\u5357 \u4e86\u89e3\uff1a - \u4ece\u6e90\u7801\u7f16\u8bd1 - \u4f7f\u7528\u9884\u7f16\u8bd1\u4e8c\u8fdb\u5236 - \u4f7f\u7528 Docker - \u4f7f\u7528\u5305\u7ba1\u7406\u5668</p>"},{"location":"general/#_5","title":"\u914d\u7f6e","text":"<p>\u67e5\u770b \u914d\u7f6e\u8bf4\u660e \u4e86\u89e3\uff1a - \u670d\u52a1\u5668\u914d\u7f6e\u9009\u9879 - CLI \u914d\u7f6e\u9009\u9879 - \u6570\u636e\u5e93\u914d\u7f6e - \u7f13\u5b58\u914d\u7f6e - GeoIP \u914d\u7f6e</p>"},{"location":"general/#_6","title":"\u76f8\u5173\u6587\u6863","text":"<ul> <li>\u670d\u52a1\u5668\u6587\u6863</li> <li>CLI \u6587\u6863</li> <li>\u90e8\u7f72\u6307\u5357</li> </ul>"},{"location":"general/CONFIGURATION/","title":"\u914d\u7f6e\u6307\u5357","text":"<p>Shortener \u670d\u52a1\u5668\u7684\u5b8c\u6574\u914d\u7f6e\u53c2\u8003\u3002</p>"},{"location":"general/CONFIGURATION/#_2","title":"\u76ee\u5f55","text":"<ul> <li>\u6982\u8ff0</li> <li>\u914d\u7f6e\u6587\u4ef6</li> <li>\u73af\u5883\u53d8\u91cf</li> <li>\u670d\u52a1\u5668\u914d\u7f6e</li> <li>\u6570\u636e\u5e93\u914d\u7f6e</li> <li>\u7f13\u5b58\u914d\u7f6e</li> <li>GeoIP \u914d\u7f6e</li> </ul>"},{"location":"general/CONFIGURATION/#_3","title":"\u6982\u8ff0","text":"<p>Shortener \u670d\u52a1\u5668\u4f7f\u7528 TOML \u683c\u5f0f\u8fdb\u884c\u914d\u7f6e\u3002\u914d\u7f6e\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u4f4d\u7f6e\u52a0\u8f7d\uff1a</p> <ol> <li>\u914d\u7f6e\u6587\u4ef6\uff08\u9ed8\u8ba4\uff1a<code>config/config.toml</code>\uff09</li> <li>\u73af\u5883\u53d8\u91cf\uff08\u524d\u7f00\uff1a<code>SHORTENER__</code>\uff09</li> <li>\u547d\u4ee4\u884c\u53c2\u6570</li> </ol> <p>\u4f18\u5148\u7ea7\uff08\u4ece\u9ad8\u5230\u4f4e\uff09\uff1a\u547d\u4ee4\u884c &gt; \u73af\u5883\u53d8\u91cf &gt; \u914d\u7f6e\u6587\u4ef6</p>"},{"location":"general/CONFIGURATION/#_4","title":"\u914d\u7f6e\u6587\u4ef6","text":""},{"location":"general/CONFIGURATION/#_5","title":"\u4f4d\u7f6e","text":"<p>\u9ed8\u8ba4\u4f4d\u7f6e\uff08\u6309\u4f18\u5148\u7ea7\u987a\u5e8f\uff09\uff1a</p> <ol> <li><code>--config</code> \u6807\u5fd7\u6307\u5b9a\u7684\u8def\u5f84</li> <li><code>./config/config.toml</code></li> <li><code>/etc/shortener/config.toml</code></li> </ol>"},{"location":"general/CONFIGURATION/#_6","title":"\u683c\u5f0f","text":"<pre><code>[server]\n# \u670d\u52a1\u5668\u8bbe\u7f6e\n\n[shortener]\n# \u77ed\u4ee3\u7801\u751f\u6210\u8bbe\u7f6e\n\n[admin]\n# \u7ba1\u7406\u5458\u8d26\u6237\u8bbe\u7f6e\n\n[database]\n# \u6570\u636e\u5e93\u8fde\u63a5\u8bbe\u7f6e\n\n[cache]\n# \u7f13\u5b58\u8bbe\u7f6e\n\n[geoip]\n# GeoIP \u8bbe\u7f6e\n</code></pre>"},{"location":"general/CONFIGURATION/#_7","title":"\u73af\u5883\u53d8\u91cf","text":"<p>\u73af\u5883\u53d8\u91cf\u4f7f\u7528\u524d\u7f00 <code>SHORTENER__</code>\uff0c\u7528\u53cc\u4e0b\u5212\u7ebf\u5206\u9694\u5d4c\u5957\u952e\uff1a</p> <pre><code># \u670d\u52a1\u5668\u5730\u5740\nexport SHORTENER__SERVER__ADDRESS=\":9090\"\n\n# \u6570\u636e\u5e93\u7c7b\u578b\nexport SHORTENER__DATABASE__TYPE=\"postgres\"\n\n# \u542f\u7528\u7f13\u5b58\nexport SHORTENER__CACHE__ENABLED=\"true\"\n\n# API \u5bc6\u94a5\nexport SHORTENER__SERVER__API_KEY=\"your-secret-key\"\n</code></pre>"},{"location":"general/CONFIGURATION/#_8","title":"\u670d\u52a1\u5668\u914d\u7f6e","text":"<pre><code>[server]\naddress = \":8080\"                          # \u76d1\u542c\u5730\u5740\nsite_url = \"http://localhost:8080\"        # \u516c\u5171\u7ad9\u70b9 URL\napi_key = \"your-secret-api-key\"           # API \u5bc6\u94a5\uff08\u5fc5\u9700\uff09\n</code></pre>"},{"location":"general/CONFIGURATION/#_9","title":"\u8be6\u7ec6\u8bf4\u660e","text":"<ul> <li><code>address</code>\uff1a\u670d\u52a1\u5668\u76d1\u542c\u5730\u5740\uff0c\u9ed8\u8ba4 <code>:8080</code></li> <li><code>site_url</code>\uff1a\u7ad9\u70b9\u7684\u516c\u5171 URL\uff0c\u7528\u4e8e\u751f\u6210\u77ed\u94fe\u63a5</li> <li><code>api_key</code>\uff1a\u7528\u4e8e\u8ba4\u8bc1\u7684 API \u5bc6\u94a5\uff0c\u4f7f\u7528 <code>openssl rand -base64 32</code> \u751f\u6210</li> </ul>"},{"location":"general/CONFIGURATION/#_10","title":"\u77ed\u94fe\u63a5\u914d\u7f6e","text":"<pre><code>[shortener]\ncode_length = 6                           # \u77ed\u4ee3\u7801\u957f\u5ea6\uff084-16\uff09\ncode_charset = \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n</code></pre>"},{"location":"general/CONFIGURATION/#_11","title":"\u7ba1\u7406\u5458\u914d\u7f6e","text":"<pre><code>[admin]\nusername = \"admin\"                        # \u7ba1\u7406\u5458\u7528\u6237\u540d\uff08\u5fc5\u9700\uff09\npassword = \"your-secure-password\"         # \u7ba1\u7406\u5458\u5bc6\u7801\uff08\u5fc5\u9700\uff09\n</code></pre>"},{"location":"general/CONFIGURATION/#_12","title":"\u6570\u636e\u5e93\u914d\u7f6e","text":""},{"location":"general/CONFIGURATION/#sqlite","title":"SQLite","text":"<pre><code>[database]\ntype = \"sqlite\"\nlog_level = 1\n\n[database.sqlite]\npath = \"data/shortener.db\"\n</code></pre>"},{"location":"general/CONFIGURATION/#postgresql","title":"PostgreSQL","text":"<pre><code>[database]\ntype = \"postgres\"\nlog_level = 1\n\n[database.postgres]\nhost = \"localhost\"\nport = 5432\nuser = \"postgres\"\npassword = \"postgres\"\ndatabase = \"shortener\"\nsslmode = \"disable\"\ntimezone = \"Asia/Shanghai\"\n</code></pre>"},{"location":"general/CONFIGURATION/#mysql","title":"MySQL","text":"<pre><code>[database]\ntype = \"mysql\"\nlog_level = 1\n\n[database.mysql]\nhost = \"localhost\"\nport = 3306\nuser = \"root\"\npassword = \"root\"\ndatabase = \"shortener\"\ncharset = \"utf8mb4\"\n</code></pre>"},{"location":"general/CONFIGURATION/#_13","title":"\u7f13\u5b58\u914d\u7f6e","text":""},{"location":"general/CONFIGURATION/#redis","title":"Redis","text":"<pre><code>[cache]\nenabled = true\ntype = \"redis\"\nexpire = 3600\nprefix = \"shorten:\"\n\n[cache.redis]\nhost = \"localhost\"\nport = 6379\npassword = \"\"\ndb = 0\n</code></pre>"},{"location":"general/CONFIGURATION/#valkey","title":"Valkey","text":"<pre><code>[cache]\nenabled = true\ntype = \"valkey\"\nexpire = 3600\n\n[cache.valkey]\nhost = \"localhost\"\nport = 6379\npassword = \"\"\ndb = 0\n</code></pre>"},{"location":"general/CONFIGURATION/#geoip","title":"GeoIP \u914d\u7f6e","text":"<p>GeoIP \u529f\u80fd\u7528\u4e8e\u8ffd\u8e2a\u8bbf\u95ee\u8005\u7684\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u3002\u9ed8\u8ba4\u7981\u7528\uff0c\u9700\u8981\u624b\u52a8\u914d\u7f6e\u3002</p> <pre><code>[geoip]\nenabled = false  # \u9ed8\u8ba4\u7981\u7528\ntype = \"ip2region\"\n\n[geoip.ip2region]\npath = \"data/ip2region.xdb\"\nmode = \"vector\"\nversion = \"4\"\n</code></pre>"},{"location":"general/CONFIGURATION/#geoip_1","title":"\u542f\u7528 GeoIP","text":"<p>\u8981\u542f\u7528 GeoIP \u529f\u80fd\uff0c\u9700\u8981\uff1a</p> <ol> <li> <p>\u4e0b\u8f7d ip2region \u6570\u636e\u5e93\u6587\u4ef6\uff1a    <pre><code>curl -fsSL https://github.com/lionsoul2014/ip2region/raw/master/data/ip2region_v4.xdb \\\n    -o data/ip2region.xdb\n</code></pre></p> </li> <li> <p>\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u542f\u7528\uff1a    <pre><code>[geoip]\nenabled = true\n</code></pre></p> </li> <li> <p>\u91cd\u542f\u670d\u52a1</p> </li> </ol> <p>\u8be6\u7ec6\u7684 GeoIP \u914d\u7f6e\u548c\u4f7f\u7528\u8bf4\u660e\uff0c\u8bf7\u53c2\u9605 GeoIP \u914d\u7f6e\u6307\u5357\u3002</p>"},{"location":"general/CONFIGURATION/#_14","title":"\u914d\u7f6e\u793a\u4f8b","text":""},{"location":"general/CONFIGURATION/#_15","title":"\u5f00\u53d1\u73af\u5883","text":"<pre><code>[server]\naddress = \":8080\"\nsite_url = \"http://localhost:8080\"\napi_key = \"dev-api-key\"\n\n[admin]\nusername = \"admin\"\npassword = \"admin123\"\n\n[database]\ntype = \"sqlite\"\n\n[database.sqlite]\npath = \"data/shortener.db\"\n\n[cache]\nenabled = false\n\n[geoip]\nenabled = false\n</code></pre>"},{"location":"general/CONFIGURATION/#_16","title":"\u751f\u4ea7\u73af\u5883","text":"<pre><code>[server]\naddress = \":8080\"\nsite_url = \"https://short.example.com\"\napi_key = \"${SHORTENER_API_KEY}\"\n\n[admin]\nusername = \"${SHORTENER_ADMIN_USER}\"\npassword = \"${SHORTENER_ADMIN_PASS}\"\n\n[database]\ntype = \"postgres\"\n\n[database.postgres]\nhost = \"postgres\"\nport = 5432\nuser = \"shortener\"\npassword = \"${POSTGRES_PASSWORD}\"\ndatabase = \"shortener\"\nsslmode = \"require\"\n\n[cache]\nenabled = true\ntype = \"redis\"\n\n[cache.redis]\nhost = \"redis\"\nport = 6379\npassword = \"${REDIS_PASSWORD}\"\n\n[geoip]\nenabled = true\n\n[geoip.ip2region]\npath = \"/var/lib/shortener/ip2region.xdb\"\n</code></pre>"},{"location":"general/CONFIGURATION/#_17","title":"\u6700\u4f73\u5b9e\u8df5","text":"<ol> <li>\u4f7f\u7528\u73af\u5883\u53d8\u91cf\u5b58\u50a8\u654f\u611f\u6570\u636e\uff08\u5bc6\u7801\u3001API \u5bc6\u94a5\uff09</li> <li>\u4e0d\u540c\u73af\u5883\u4f7f\u7528\u4e0d\u540c\u914d\u7f6e\uff08\u5f00\u53d1\u3001\u751f\u4ea7\uff09</li> <li>\u5b9a\u671f\u8f6e\u6362 API \u5bc6\u94a5\u548c\u5bc6\u7801</li> <li>\u751f\u4ea7\u73af\u5883\u4f7f\u7528\u9002\u5f53\u7684\u65e5\u5fd7\u7ea7\u522b</li> <li>\u542f\u7528\u7f13\u5b58\u4ee5\u63d0\u9ad8\u6027\u80fd</li> </ol>"},{"location":"general/CONFIGURATION/#_18","title":"\u53e6\u89c1","text":"<ul> <li>GeoIP \u914d\u7f6e\u6307\u5357</li> <li>API \u6587\u6863</li> <li>\u90e8\u7f72\u6307\u5357</li> <li>Docker \u90e8\u7f72</li> </ul>"},{"location":"general/CONFIG_FILES/","title":"\u914d\u7f6e\u6587\u4ef6\u8bf4\u660e","text":""},{"location":"general/CONFIG_FILES/#_2","title":"\u914d\u7f6e\u6587\u4ef6\u5217\u8868","text":"<ul> <li><code>config.example.toml</code> - \u5b8c\u6574\u7684\u914d\u7f6e\u793a\u4f8b\u548c\u6587\u6863\uff08\u63a8\u8350\u9605\u8bfb\uff09</li> <li><code>config.local.toml</code> - \u672c\u5730\u5f00\u53d1\u914d\u7f6e\uff08git \u5df2\u5ffd\u7565\uff09</li> <li><code>config.development.toml</code> - \u5f00\u53d1\u73af\u5883\u9884\u8bbe</li> <li><code>config.production.toml</code> - \u751f\u4ea7\u73af\u5883\u914d\u7f6e\u6a21\u677f</li> <li><code>config.docker.toml</code> - Docker \u90e8\u7f72\u914d\u7f6e</li> <li><code>test-config.toml</code> - \u6d4b\u8bd5\u4e13\u7528\u914d\u7f6e</li> </ul>"},{"location":"general/CONFIG_FILES/#_3","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"general/CONFIG_FILES/#_4","title":"\u672c\u5730\u5f00\u53d1","text":"<ol> <li> <p>\u590d\u5236\u5e76\u7f16\u8f91\u672c\u5730\u914d\u7f6e\uff1a    <pre><code>cp config/config.example.toml config/config.local.toml\n# \u7f16\u8f91 config.local.toml\uff0c\u4fee\u6539 api_key \u7b49\u654f\u611f\u4fe1\u606f\n</code></pre></p> </li> <li> <p>\u8fd0\u884c\u670d\u52a1\uff1a    <pre><code>cargo run -p shortener-server -- --config config/config.local.toml\n</code></pre></p> </li> </ol>"},{"location":"general/CONFIG_FILES/#_5","title":"\u4f7f\u7528\u9884\u8bbe\u914d\u7f6e","text":"<p>\u76f4\u63a5\u4f7f\u7528\u5f00\u53d1\u73af\u5883\u9884\u8bbe\uff1a <pre><code>cargo run -p shortener-server -- --config config/config.development.toml\n</code></pre></p>"},{"location":"general/CONFIG_FILES/#_6","title":"\u914d\u7f6e\u4f18\u5316","text":""},{"location":"general/CONFIG_FILES/#_7","title":"\u53ef\u9009\u5b57\u6bb5","text":"<p>\u5f53\u67d0\u4e9b\u529f\u80fd\u88ab\u7981\u7528\u65f6\uff0c\u76f8\u5173\u7684\u914d\u7f6e\u5b57\u6bb5\u53ef\u4ee5\u7701\u7565\uff1a</p> <pre><code># \u7981\u7528\u7f13\u5b58\u65f6\uff0c\u53ef\u4ee5\u7701\u7565 cache.type \u548c\u5177\u4f53\u914d\u7f6e\n[cache]\nenabled = false\n\n# \u7981\u7528 GeoIP \u65f6\uff0c\u53ef\u4ee5\u7701\u7565 geoip.type \u548c\u5177\u4f53\u914d\u7f6e\n[geoip]\nenabled = false\n</code></pre>"},{"location":"general/CONFIG_FILES/#_8","title":"\u73af\u5883\u53d8\u91cf","text":"<p>\u652f\u6301\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u8986\u76d6\u914d\u7f6e\uff08\u524d\u7f00 <code>SHORTENER__</code>\uff09\uff1a</p> <pre><code>export SHORTENER__SERVER__API_KEY=\"your-secret-key\"\nexport SHORTENER__ADMIN__PASSWORD=\"secure-password\"\ncargo run -p shortener-server\n</code></pre>"},{"location":"general/CONFIG_FILES/#git","title":"Git \u5ffd\u7565\u89c4\u5219","text":"<p>\u4ee5\u4e0b\u6587\u4ef6\u4f1a\u88ab git \u5ffd\u7565\uff0c\u53ef\u4ee5\u5b89\u5168\u5730\u5b58\u50a8\u654f\u611f\u4fe1\u606f\uff1a - <code>*.local.toml</code> - <code>config/config.toml</code></p>"},{"location":"general/GEOIP/","title":"GeoIP \u914d\u7f6e\u6307\u5357","text":"<p>\u672c\u6307\u5357\u4ecb\u7ecd\u5982\u4f55\u5728 Shortener \u4e2d\u542f\u7528\u548c\u914d\u7f6e GeoIP \u529f\u80fd\uff0c\u7528\u4e8e\u8ffd\u8e2a\u8bbf\u95ee\u8005\u7684\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u3002</p>"},{"location":"general/GEOIP/#_1","title":"\u76ee\u5f55","text":"<ul> <li>\u6982\u8ff0</li> <li>ip2region \u7b80\u4ecb</li> <li>\u5b89\u88c5\u6b65\u9aa4</li> <li>\u914d\u7f6e\u8bf4\u660e</li> <li>\u4f7f\u7528\u793a\u4f8b</li> <li>\u6027\u80fd\u4f18\u5316</li> <li>\u6545\u969c\u6392\u9664</li> </ul>"},{"location":"general/GEOIP/#_2","title":"\u6982\u8ff0","text":"<p>Shortener \u652f\u6301\u4f7f\u7528 GeoIP \u529f\u80fd\u6765\u8ffd\u8e2a\u77ed\u94fe\u63a5\u8bbf\u95ee\u8005\u7684\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u3002\u76ee\u524d\u652f\u6301\u7684 GeoIP \u63d0\u4f9b\u5546\uff1a</p> <ul> <li>ip2region - \u9ad8\u6027\u80fd\u7684\u79bb\u7ebf IP \u5730\u5740\u5b9a\u4f4d\u5e93\uff08\u63a8\u8350\uff09</li> </ul> <p>GeoIP \u529f\u80fd\u9ed8\u8ba4\u662f\u7981\u7528\u7684\uff0c\u9700\u8981\u624b\u52a8\u4e0b\u8f7d\u6570\u636e\u5e93\u6587\u4ef6\u5e76\u914d\u7f6e\u540e\u624d\u80fd\u4f7f\u7528\u3002</p>"},{"location":"general/GEOIP/#ip2region","title":"ip2region \u7b80\u4ecb","text":"<p>ip2region \u662f\u4e00\u4e2a\u79bb\u7ebf IP \u5730\u5740\u5b9a\u4f4d\u5e93\u548c IP \u5b9a\u4f4d\u6570\u636e\u7ba1\u7406\u6846\u67b6\uff0c\u5177\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a</p> <ul> <li>\u9ad8\u6027\u80fd\uff1a10 \u5fae\u79d2\u7ea7\u522b\u7684\u67e5\u8be2\u901f\u5ea6</li> <li>\u51c6\u786e\u6027\u9ad8\uff1a\u63d0\u4f9b\u56fd\u5bb6\u3001\u7701\u4efd\u3001\u57ce\u5e02\u7ea7\u522b\u7684\u5b9a\u4f4d</li> <li>\u4f53\u79ef\u5c0f\uff1a\u6570\u636e\u5e93\u6587\u4ef6\u4ec5\u7ea6 11MB</li> <li>\u79bb\u7ebf\u4f7f\u7528\uff1a\u65e0\u9700\u7f51\u7edc\u8bf7\u6c42\uff0c\u4fdd\u62a4\u9690\u79c1</li> <li>\u591a\u8bed\u8a00\u652f\u6301\uff1a\u652f\u6301\u591a\u79cd\u7f16\u7a0b\u8bed\u8a00</li> </ul>"},{"location":"general/GEOIP/#_3","title":"\u6570\u636e\u683c\u5f0f","text":"<p>ip2region \u8fd4\u56de\u7684\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u683c\u5f0f\uff1a</p> <pre><code>\u56fd\u5bb6|\u533a\u57df|\u7701\u4efd|\u57ce\u5e02|ISP\n</code></pre> <p>\u793a\u4f8b\uff1a <pre><code>\u4e2d\u56fd|0|\u6d59\u6c5f\u7701|\u676d\u5dde\u5e02|\u963f\u91cc\u4e91\n\u7f8e\u56fd|0|\u52a0\u5229\u798f\u5c3c\u4e9a|\u6d1b\u6749\u77f6|0\n</code></pre></p>"},{"location":"general/GEOIP/#_4","title":"\u5b89\u88c5\u6b65\u9aa4","text":""},{"location":"general/GEOIP/#1-ip2region","title":"1. \u4e0b\u8f7d ip2region \u6570\u636e\u5e93","text":"<p>\u4ece GitHub \u4e0b\u8f7d\u6700\u65b0\u7684 ip2region \u6570\u636e\u5e93\u6587\u4ef6\uff1a</p> <pre><code># \u521b\u5efa\u6570\u636e\u76ee\u5f55\nmkdir -p data\n\n# \u4e0b\u8f7d IPv4 \u6570\u636e\u5e93\uff08\u63a8\u8350\uff09\ncurl -fsSL https://github.com/lionsoul2014/ip2region/raw/master/data/ip2region_v4.xdb \\\n    -o data/ip2region.xdb\n\n# \u6216\u8005\u4f7f\u7528 wget\nwget https://github.com/lionsoul2014/ip2region/raw/master/data/ip2region_v4.xdb \\\n    -O data/ip2region.xdb\n</code></pre> <p>\u6570\u636e\u5e93\u6587\u4ef6\u8bf4\u660e\uff1a - <code>ip2region_v4.xdb</code> - IPv4 \u6570\u636e\u5e93\uff08\u7ea6 11MB\uff09 - \u6570\u636e\u5e93\u4f1a\u5b9a\u671f\u66f4\u65b0\uff0c\u5efa\u8bae\u5b9a\u671f\u4e0b\u8f7d\u6700\u65b0\u7248\u672c</p>"},{"location":"general/GEOIP/#2","title":"2. \u9a8c\u8bc1\u6587\u4ef6","text":"<p>\u786e\u8ba4\u6587\u4ef6\u5df2\u6210\u529f\u4e0b\u8f7d\uff1a</p> <pre><code>ls -lh data/ip2region.xdb\n</code></pre> <p>\u5e94\u8be5\u770b\u5230\u7c7b\u4f3c\u8f93\u51fa\uff1a <pre><code>-rw-r--r-- 1 user user 11M Nov 4 2025 data/ip2region.xdb\n</code></pre></p>"},{"location":"general/GEOIP/#3-shortener","title":"3. \u914d\u7f6e Shortener","text":"<p>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6 <code>config/config.toml</code>\uff1a</p> <pre><code>[geoip]\n# \u542f\u7528 GeoIP \u529f\u80fd\nenabled = true\n\n# \u4f7f\u7528 ip2region \u63d0\u4f9b\u5546\ntype = \"ip2region\"\n\n[geoip.ip2region]\n# \u6570\u636e\u5e93\u6587\u4ef6\u8def\u5f84\npath = \"data/ip2region.xdb\"\n\n# \u641c\u7d22\u6a21\u5f0f\uff1avector\uff08\u6700\u5feb\uff09\u3001btree\uff08\u5e73\u8861\uff09\u3001binary\uff08\u6700\u5c0f\u5185\u5b58\uff09\nmode = \"vector\"\n\n# IP \u7248\u672c\uff1a4 \u8868\u793a IPv4\nversion = \"4\"\n</code></pre>"},{"location":"general/GEOIP/#4","title":"4. \u91cd\u542f\u670d\u52a1","text":"<pre><code># \u5982\u679c\u4f7f\u7528 systemd\nsudo systemctl restart shortener\n\n# \u5982\u679c\u76f4\u63a5\u8fd0\u884c\ncargo run --release -p shortener-server\n\n# \u5982\u679c\u4f7f\u7528 Docker\ndocker compose restart\n</code></pre>"},{"location":"general/GEOIP/#_5","title":"\u914d\u7f6e\u8bf4\u660e","text":""},{"location":"general/GEOIP/#_6","title":"\u641c\u7d22\u6a21\u5f0f","text":"<p>ip2region \u652f\u6301\u4e09\u79cd\u641c\u7d22\u6a21\u5f0f\uff0c\u5404\u6709\u4f18\u7f3a\u70b9\uff1a</p> \u6a21\u5f0f \u901f\u5ea6 \u5185\u5b58\u5360\u7528 \u9002\u7528\u573a\u666f <code>vector</code> \u6700\u5feb\uff08~10\u03bcs\uff09 \u6700\u5927\uff08~11MB\uff09 \u751f\u4ea7\u73af\u5883\uff08\u63a8\u8350\uff09 <code>btree</code> \u4e2d\u7b49\uff08~20\u03bcs\uff09 \u4e2d\u7b49\uff08~5MB\uff09 \u5185\u5b58\u53d7\u9650\u73af\u5883 <code>binary</code> \u8f83\u6162\uff08~50\u03bcs\uff09 \u6700\u5c0f\uff08~1MB\uff09 \u6781\u5ea6\u5185\u5b58\u53d7\u9650 <p>\u63a8\u8350\u914d\u7f6e\uff1a <pre><code>[geoip.ip2region]\nmode = \"vector\"  # \u751f\u4ea7\u73af\u5883\u63a8\u8350\n</code></pre></p>"},{"location":"general/GEOIP/#_7","title":"\u6587\u4ef6\u8def\u5f84","text":"<p>\u6839\u636e\u90e8\u7f72\u65b9\u5f0f\u914d\u7f6e\u4e0d\u540c\u7684\u8def\u5f84\uff1a</p> <p>\u672c\u5730\u5f00\u53d1\uff1a <pre><code>path = \"data/ip2region.xdb\"\n</code></pre></p> <p>Docker \u90e8\u7f72\uff1a <pre><code>path = \"/var/lib/shortener/ip2region.xdb\"\n</code></pre></p> <p>\u7cfb\u7edf\u670d\u52a1\uff1a <pre><code>path = \"/var/lib/shortener/ip2region.xdb\"\n</code></pre></p>"},{"location":"general/GEOIP/#_8","title":"\u4f7f\u7528\u793a\u4f8b","text":""},{"location":"general/GEOIP/#docker","title":"Docker \u90e8\u7f72","text":"<p>\u5982\u679c\u4f7f\u7528 Docker \u90e8\u7f72\uff0c\u9700\u8981\u5c06\u6570\u636e\u5e93\u6587\u4ef6\u6302\u8f7d\u5230\u5bb9\u5668\u4e2d\uff1a</p>"},{"location":"general/GEOIP/#1-volume","title":"\u65b9\u6cd5 1\uff1a\u4f7f\u7528 Volume \u6302\u8f7d","text":"<pre><code># docker-compose.yml\nservices:\n  shortener:\n    image: ghcr.io/jetsung/shortener:latest\n    volumes:\n      - ./data/ip2region.xdb:/var/lib/shortener/ip2region.xdb:ro\n    environment:\n      - GEOIP_ENABLED=true\n</code></pre>"},{"location":"general/GEOIP/#2_1","title":"\u65b9\u6cd5 2\uff1a\u5728\u5bb9\u5668\u542f\u52a8\u65f6\u4e0b\u8f7d","text":"<pre><code># \u81ea\u5b9a\u4e49 Dockerfile\nFROM ghcr.io/jetsung/shortener:latest\n\nUSER root\n\n# \u4e0b\u8f7d ip2region \u6570\u636e\u5e93\nRUN apt-get update &amp;&amp; apt-get install -y curl &amp;&amp; \\\n    curl -fsSL https://github.com/lionsoul2014/ip2region/raw/master/data/ip2region_v4.xdb \\\n    -o /var/lib/shortener/ip2region.xdb &amp;&amp; \\\n    chown shortener:shortener /var/lib/shortener/ip2region.xdb &amp;&amp; \\\n    apt-get remove -y curl &amp;&amp; \\\n    rm -rf /var/lib/apt/lists/*\n\nUSER shortener\n</code></pre>"},{"location":"general/GEOIP/#_9","title":"\u73af\u5883\u53d8\u91cf\u914d\u7f6e","text":"<p>\u4f7f\u7528\u73af\u5883\u53d8\u91cf\u542f\u7528 GeoIP\uff1a</p> <pre><code># \u542f\u7528 GeoIP\nexport SHORTENER__GEOIP__ENABLED=true\n\n# \u8bbe\u7f6e\u6570\u636e\u5e93\u8def\u5f84\nexport SHORTENER__GEOIP__IP2REGION__PATH=/path/to/ip2region.xdb\n\n# \u8bbe\u7f6e\u641c\u7d22\u6a21\u5f0f\nexport SHORTENER__GEOIP__IP2REGION__MODE=vector\n</code></pre>"},{"location":"general/GEOIP/#_10","title":"\u9a8c\u8bc1\u914d\u7f6e","text":"<p>\u542f\u52a8\u670d\u52a1\u540e\uff0c\u68c0\u67e5\u65e5\u5fd7\u786e\u8ba4 GeoIP \u5df2\u542f\u7528\uff1a</p> <pre><code># \u67e5\u770b\u65e5\u5fd7\ntail -f /var/log/shortener/shortener.log\n\n# \u5e94\u8be5\u770b\u5230\u7c7b\u4f3c\u8f93\u51fa\n[INFO] GeoIP enabled with provider: ip2region\n[INFO] ip2region database loaded: data/ip2region.xdb\n</code></pre>"},{"location":"general/GEOIP/#_11","title":"\u6027\u80fd\u4f18\u5316","text":""},{"location":"general/GEOIP/#1","title":"1. \u9009\u62e9\u5408\u9002\u7684\u641c\u7d22\u6a21\u5f0f","text":"<p>\u751f\u4ea7\u73af\u5883\u63a8\u8350\u4f7f\u7528 <code>vector</code> \u6a21\u5f0f\u4ee5\u83b7\u5f97\u6700\u4f73\u6027\u80fd\uff1a</p> <pre><code>[geoip.ip2region]\nmode = \"vector\"\n</code></pre>"},{"location":"general/GEOIP/#2_2","title":"2. \u542f\u7528\u7f13\u5b58","text":"<p>\u914d\u5408 Redis \u7f13\u5b58\u53ef\u4ee5\u8fdb\u4e00\u6b65\u63d0\u5347\u6027\u80fd\uff1a</p> <pre><code>[cache]\nenabled = true\ntype = \"redis\"\nexpire = 3600  # \u7f13\u5b58 1 \u5c0f\u65f6\n\n[cache.redis]\nhost = \"localhost\"\nport = 6379\n</code></pre>"},{"location":"general/GEOIP/#3","title":"3. \u5b9a\u671f\u66f4\u65b0\u6570\u636e\u5e93","text":"<p>ip2region \u6570\u636e\u5e93\u4f1a\u5b9a\u671f\u66f4\u65b0\uff0c\u5efa\u8bae\u6bcf\u6708\u66f4\u65b0\u4e00\u6b21\uff1a</p> <pre><code>#!/bin/bash\n# update-geoip.sh\n\n# \u5907\u4efd\u65e7\u6570\u636e\u5e93\ncp data/ip2region.xdb data/ip2region.xdb.bak\n\n# \u4e0b\u8f7d\u65b0\u6570\u636e\u5e93\ncurl -fsSL https://github.com/lionsoul2014/ip2region/raw/master/data/ip2region_v4.xdb \\\n    -o data/ip2region.xdb\n\n# \u91cd\u542f\u670d\u52a1\nsystemctl restart shortener\n\necho \"GeoIP database updated successfully\"\n</code></pre> <p>\u8bbe\u7f6e\u5b9a\u65f6\u4efb\u52a1\uff1a <pre><code># \u6bcf\u6708 1 \u53f7\u51cc\u6668 2 \u70b9\u66f4\u65b0\n0 2 1 * * /path/to/update-geoip.sh\n</code></pre></p>"},{"location":"general/GEOIP/#_12","title":"\u6545\u969c\u6392\u9664","text":""},{"location":"general/GEOIP/#1_1","title":"\u95ee\u9898 1\uff1a\u6570\u636e\u5e93\u6587\u4ef6\u672a\u627e\u5230","text":"<p>\u9519\u8bef\u4fe1\u606f\uff1a <pre><code>Error: Failed to load ip2region database: No such file or directory\n</code></pre></p> <p>\u89e3\u51b3\u65b9\u6cd5\uff1a 1. \u786e\u8ba4\u6587\u4ef6\u8def\u5f84\u6b63\u786e 2. \u68c0\u67e5\u6587\u4ef6\u6743\u9650 3. \u786e\u8ba4\u6587\u4ef6\u5df2\u4e0b\u8f7d\u5b8c\u6574</p> <pre><code># \u68c0\u67e5\u6587\u4ef6\nls -lh data/ip2region.xdb\n\n# \u68c0\u67e5\u6743\u9650\nchmod 644 data/ip2region.xdb\n</code></pre>"},{"location":"general/GEOIP/#2geoip","title":"\u95ee\u9898 2\uff1aGeoIP \u67e5\u8be2\u5931\u8d25","text":"<p>\u9519\u8bef\u4fe1\u606f\uff1a <pre><code>Warning: GeoIP lookup failed for IP: xxx.xxx.xxx.xxx\n</code></pre></p> <p>\u53ef\u80fd\u539f\u56e0\uff1a 1. \u6570\u636e\u5e93\u6587\u4ef6\u635f\u574f 2. IP \u5730\u5740\u683c\u5f0f\u4e0d\u6b63\u786e 3. \u6570\u636e\u5e93\u7248\u672c\u4e0d\u5339\u914d</p> <p>\u89e3\u51b3\u65b9\u6cd5\uff1a <pre><code># \u91cd\u65b0\u4e0b\u8f7d\u6570\u636e\u5e93\nrm data/ip2region.xdb\ncurl -fsSL https://github.com/lionsoul2014/ip2region/raw/master/data/ip2region_v4.xdb \\\n    -o data/ip2region.xdb\n</code></pre></p>"},{"location":"general/GEOIP/#3_1","title":"\u95ee\u9898 3\uff1a\u5185\u5b58\u5360\u7528\u8fc7\u9ad8","text":"<p>\u89e3\u51b3\u65b9\u6cd5\uff1a</p> <p>\u5207\u6362\u5230\u66f4\u8282\u7701\u5185\u5b58\u7684\u641c\u7d22\u6a21\u5f0f\uff1a</p> <pre><code>[geoip.ip2region]\nmode = \"btree\"  # \u6216 \"binary\"\n</code></pre>"},{"location":"general/GEOIP/#4docker","title":"\u95ee\u9898 4\uff1aDocker \u5bb9\u5668\u4e2d\u65e0\u6cd5\u8bbf\u95ee\u6587\u4ef6","text":"<p>\u89e3\u51b3\u65b9\u6cd5\uff1a</p> <p>\u786e\u4fdd\u6587\u4ef6\u5df2\u6b63\u786e\u6302\u8f7d\uff1a</p> <pre><code># \u68c0\u67e5\u5bb9\u5668\u5185\u6587\u4ef6\ndocker exec shortener ls -lh /var/lib/shortener/ip2region.xdb\n\n# \u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u68c0\u67e5 volume \u6302\u8f7d\ndocker inspect shortener | grep -A 10 Mounts\n</code></pre>"},{"location":"general/GEOIP/#_13","title":"\u76f8\u5173\u8d44\u6e90","text":"<ul> <li>ip2region GitHub \u4ed3\u5e93</li> <li>ip2region \u6587\u6863</li> <li>\u6570\u636e\u5e93\u4e0b\u8f7d\u5730\u5740</li> <li>Shortener \u914d\u7f6e\u6307\u5357</li> <li>Docker \u90e8\u7f72\u6307\u5357</li> </ul>"},{"location":"general/GEOIP/#_14","title":"\u53e6\u89c1","text":"<ul> <li>\u914d\u7f6e\u6307\u5357</li> <li>API \u6587\u6863</li> <li>\u90e8\u7f72\u6307\u5357</li> </ul>"},{"location":"general/INSTALLATION/","title":"\u5b89\u88c5\u6307\u5357","text":"<p>\u672c\u6587\u6863\u63d0\u4f9b\u4e86 Shortener \u9879\u76ee\u7684\u8be6\u7ec6\u5b89\u88c5\u8bf4\u660e\uff0c\u5305\u62ec\u591a\u79cd\u5b89\u88c5\u65b9\u5f0f\u548c\u5e73\u53f0\u652f\u6301\u3002</p>"},{"location":"general/INSTALLATION/#_2","title":"\u76ee\u5f55","text":"<ul> <li>\u7cfb\u7edf\u8981\u6c42</li> <li>Cargo \u5b89\u88c5\u65b9\u5f0f</li> <li>Docker \u5b89\u88c5</li> <li>\u9884\u6784\u5efa\u4e8c\u8fdb\u5236\u6587\u4ef6</li> <li>DEB \u5305\u5b89\u88c5</li> <li>\u4ece\u6e90\u7801\u6784\u5efa</li> <li>\u9a8c\u8bc1\u5b89\u88c5</li> <li>\u6545\u969c\u6392\u9664</li> </ul>"},{"location":"general/INSTALLATION/#_3","title":"\u7cfb\u7edf\u8981\u6c42","text":""},{"location":"general/INSTALLATION/#_4","title":"\u6700\u4f4e\u8981\u6c42","text":"<ul> <li>\u64cd\u4f5c\u7cfb\u7edf: Linux, macOS, Windows</li> <li>Rust: 1.90 \u6216\u66f4\u9ad8\u7248\u672c</li> <li>\u5185\u5b58: \u6700\u5c11 512MB RAM</li> <li>\u5b58\u50a8: \u6700\u5c11 100MB \u53ef\u7528\u7a7a\u95f4</li> </ul>"},{"location":"general/INSTALLATION/#_5","title":"\u63a8\u8350\u914d\u7f6e","text":"<ul> <li>\u64cd\u4f5c\u7cfb\u7edf: Linux (Ubuntu 20.04+, CentOS 8+, Debian 11+)</li> <li>Rust: \u6700\u65b0\u7a33\u5b9a\u7248</li> <li>\u5185\u5b58: 1GB+ RAM</li> <li>\u5b58\u50a8: 1GB+ \u53ef\u7528\u7a7a\u95f4</li> <li>\u6570\u636e\u5e93: PostgreSQL \u6216 MySQL\uff08\u751f\u4ea7\u73af\u5883\uff09</li> </ul>"},{"location":"general/INSTALLATION/#cargo","title":"Cargo \u5b89\u88c5\u65b9\u5f0f","text":""},{"location":"general/INSTALLATION/#git","title":"\u4ece Git \u4ed3\u5e93\u5b89\u88c5\uff08\u63a8\u8350\uff09","text":"<p>\u8fd9\u662f\u6700\u7b80\u5355\u548c\u6700\u65b0\u7684\u5b89\u88c5\u65b9\u5f0f\uff0c\u76f4\u63a5\u4ece GitHub \u4ed3\u5e93\u5b89\u88c5\u6700\u65b0\u7248\u672c\u3002</p>"},{"location":"general/INSTALLATION/#_6","title":"\u5b89\u88c5\u6700\u65b0\u7248\u672c","text":"<pre><code># \u5b89\u88c5\u670d\u52a1\u5668\ncargo install --git https://github.com/jetsung/shortener.git shortener-server\n\n# \u5b89\u88c5 CLI \u5de5\u5177\ncargo install --git https://github.com/jetsung/shortener.git shortener-cli\n</code></pre>"},{"location":"general/INSTALLATION/#_7","title":"\u5b89\u88c5\u6307\u5b9a\u7248\u672c","text":"<pre><code># \u5b89\u88c5\u7279\u5b9a\u6807\u7b7e\u7248\u672c\ncargo install --git https://github.com/jetsung/shortener.git --tag v1.0.0 shortener-server\ncargo install --git https://github.com/jetsung/shortener.git --tag v1.0.0 shortener-cli\n\n# \u67e5\u770b\u53ef\u7528\u6807\u7b7e\ngit ls-remote --tags https://github.com/jetsung/shortener.git\n</code></pre>"},{"location":"general/INSTALLATION/#_8","title":"\u5b89\u88c5\u6307\u5b9a\u5206\u652f","text":"<pre><code># \u5b89\u88c5\u4e3b\u5206\u652f\uff08\u5f00\u53d1\u7248\u672c\uff09\ncargo install --git https://github.com/jetsung/shortener.git --branch main shortener-server\n\n# \u5b89\u88c5\u7279\u5b9a\u5206\u652f\ncargo install --git https://github.com/jetsung/shortener.git --branch develop shortener-cli\n</code></pre>"},{"location":"general/INSTALLATION/#_9","title":"\u5f3a\u5236\u91cd\u65b0\u5b89\u88c5","text":"<pre><code># \u5f3a\u5236\u91cd\u65b0\u5b89\u88c5\u6700\u65b0\u7248\u672c\ncargo install --git https://github.com/jetsung/shortener.git --force shortener-server\ncargo install --git https://github.com/jetsung/shortener.git --force shortener-cli\n</code></pre>"},{"location":"general/INSTALLATION/#_10","title":"\u5b89\u88c5\u5230\u81ea\u5b9a\u4e49\u76ee\u5f55","text":"<pre><code># \u5b89\u88c5\u5230\u6307\u5b9a\u76ee\u5f55\ncargo install --git https://github.com/jetsung/shortener.git --root /opt/shortener shortener-server\n\n# \u8bbe\u7f6e PATH\nexport PATH=\"/opt/shortener/bin:$PATH\"\n</code></pre>"},{"location":"general/INSTALLATION/#_11","title":"\u4ece\u672c\u5730\u6e90\u7801\u5b89\u88c5","text":"<p>\u5982\u679c\u4f60\u5df2\u7ecf\u514b\u9686\u4e86\u4ed3\u5e93\u6216\u60f3\u8981\u4fee\u6539\u6e90\u7801\uff1a</p> <pre><code># \u514b\u9686\u4ed3\u5e93\ngit clone https://github.com/jetsung/shortener.git\ncd shortener\n\n# \u5b89\u88c5\u670d\u52a1\u5668\ncargo install --path shortener-server\n\n# \u5b89\u88c5 CLI \u5de5\u5177\ncargo install --path shortener-cli\n\n# \u5b89\u88c5\u5230\u81ea\u5b9a\u4e49\u76ee\u5f55\ncargo install --path shortener-server --root /usr/local\n</code></pre>"},{"location":"general/INSTALLATION/#cratesio","title":"\u4ece crates.io \u5b89\u88c5","text":"<p>\u5f53\u9879\u76ee\u53d1\u5e03\u5230 crates.io \u540e\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u5f0f\u5b89\u88c5\uff1a</p> <pre><code># \u5b89\u88c5\u670d\u52a1\u5668\ncargo install shortener-server\n\n# \u5b89\u88c5 CLI \u5de5\u5177\ncargo install shortener-cli\n\n# \u5b89\u88c5\u6307\u5b9a\u7248\u672c\ncargo install shortener-server --version 1.0.0\n</code></pre>"},{"location":"general/INSTALLATION/#docker","title":"Docker \u5b89\u88c5","text":""},{"location":"general/INSTALLATION/#docker-compose","title":"\u4f7f\u7528 Docker Compose\uff08\u63a8\u8350\uff09","text":"<pre><code># \u4e0b\u8f7d docker-compose.yml\ncurl -O https://raw.githubusercontent.com/jetsung/shortener/main/docker/docker-compose.yml\n\n# \u542f\u52a8\u670d\u52a1\ndocker compose up -d\n\n# \u67e5\u770b\u65e5\u5fd7\ndocker compose logs -f shortener-server\n</code></pre>"},{"location":"general/INSTALLATION/#docker_1","title":"\u4f7f\u7528 Docker \u547d\u4ee4","text":"<pre><code># \u62c9\u53d6\u955c\u50cf\ndocker pull jetsung/shortener-server:latest\n\n# \u8fd0\u884c\u5bb9\u5668\ndocker run -d \\\n  --name shortener-server \\\n  -p 8080:8080 \\\n  -v $(pwd)/data:/app/data \\\n  -v $(pwd)/config:/app/config \\\n  jetsung/shortener-server:latest\n</code></pre> <p>\u8be6\u89c1 Docker \u90e8\u7f72\u6307\u5357\u3002</p>"},{"location":"general/INSTALLATION/#_12","title":"\u9884\u6784\u5efa\u4e8c\u8fdb\u5236\u6587\u4ef6","text":"<p>\u4ece GitHub Releases \u4e0b\u8f7d\u9884\u6784\u5efa\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002</p>"},{"location":"general/INSTALLATION/#linux","title":"Linux","text":"<pre><code># x86_64\nwget https://github.com/jetsung/shortener/releases/download/v1.0.0/shortener-server-v1.0.0-x86_64-unknown-linux-musl.tar.gz\ntar xzf shortener-server-v1.0.0-x86_64-unknown-linux-musl.tar.gz\nsudo mv shortener-server /usr/local/bin/\n\n# ARM64\nwget https://github.com/jetsung/shortener/releases/download/v1.0.0/shortener-server-v1.0.0-aarch64-unknown-linux-musl.tar.gz\ntar xzf shortener-server-v1.0.0-aarch64-unknown-linux-musl.tar.gz\nsudo mv shortener-server /usr/local/bin/\n</code></pre>"},{"location":"general/INSTALLATION/#macos","title":"macOS","text":"<pre><code># Intel Mac\nwget https://github.com/jetsung/shortener/releases/download/v1.0.0/shortener-server-v1.0.0-x86_64-apple-darwin.tar.gz\ntar xzf shortener-server-v1.0.0-x86_64-apple-darwin.tar.gz\nsudo mv shortener-server /usr/local/bin/\n\n# Apple Silicon\nwget https://github.com/jetsung/shortener/releases/download/v1.0.0/shortener-server-v1.0.0-aarch64-apple-darwin.tar.gz\ntar xzf shortener-server-v1.0.0-aarch64-apple-darwin.tar.gz\nsudo mv shortener-server /usr/local/bin/\n</code></pre>"},{"location":"general/INSTALLATION/#windows","title":"Windows","text":"<pre><code># \u4e0b\u8f7d\u5e76\u89e3\u538b\nInvoke-WebRequest -Uri \"https://github.com/jetsung/shortener/releases/download/v1.0.0/shortener-server-v1.0.0-x86_64-pc-windows-msvc.zip\" -OutFile \"shortener-server.zip\"\nExpand-Archive -Path \"shortener-server.zip\" -DestinationPath \"C:\\Program Files\\Shortener\"\n\n# \u6dfb\u52a0\u5230 PATH\n$env:PATH += \";C:\\Program Files\\Shortener\"\n</code></pre>"},{"location":"general/INSTALLATION/#deb","title":"DEB \u5305\u5b89\u88c5","text":"<p>\u9002\u7528\u4e8e Debian\u3001Ubuntu \u53ca\u5176\u884d\u751f\u53d1\u884c\u7248\u3002</p>"},{"location":"general/INSTALLATION/#_13","title":"\u4e0b\u8f7d\u5e76\u5b89\u88c5","text":"<pre><code># \u4e0b\u8f7d DEB \u5305\nwget https://github.com/jetsung/shortener/releases/download/v1.0.0/shortener-server_1.0.0_amd64.deb\n\n# \u5b89\u88c5\nsudo apt install ./shortener-server_1.0.0_amd64.deb\n\n# \u6216\u4f7f\u7528 dpkg\nsudo dpkg -i shortener-server_1.0.0_amd64.deb\nsudo apt-get install -f  # \u4fee\u590d\u4f9d\u8d56\u5173\u7cfb\n</code></pre>"},{"location":"general/INSTALLATION/#_14","title":"\u670d\u52a1\u7ba1\u7406","text":"<pre><code># \u542f\u52a8\u670d\u52a1\nsudo systemctl start shortener-server\n\n# \u5f00\u673a\u81ea\u542f\nsudo systemctl enable shortener-server\n\n# \u67e5\u770b\u72b6\u6001\nsudo systemctl status shortener-server\n\n# \u67e5\u770b\u65e5\u5fd7\nsudo journalctl -u shortener-server -f\n</code></pre>"},{"location":"general/INSTALLATION/#_15","title":"\u914d\u7f6e\u6587\u4ef6\u4f4d\u7f6e","text":"<ul> <li>\u914d\u7f6e\u6587\u4ef6: <code>/opt/shortener-server/config/config.toml</code></li> <li>\u6570\u636e\u76ee\u5f55: <code>/opt/shortener-server/data/</code></li> <li>\u65e5\u5fd7\u6587\u4ef6: <code>/var/log/shortener-server/</code></li> <li>\u670d\u52a1\u6587\u4ef6: <code>/etc/systemd/system/shortener-server.service</code></li> </ul> <p>\u8be6\u89c1 DEB \u6253\u5305\u6307\u5357\u3002</p>"},{"location":"general/INSTALLATION/#_16","title":"\u4ece\u6e90\u7801\u6784\u5efa","text":""},{"location":"general/INSTALLATION/#_17","title":"\u514b\u9686\u4ed3\u5e93","text":"<pre><code>git clone https://github.com/jetsung/shortener.git\ncd shortener\n</code></pre>"},{"location":"general/INSTALLATION/#_18","title":"\u6784\u5efa\u53d1\u5e03\u7248\u672c","text":"<pre><code># \u6784\u5efa\u6240\u6709\u5305\ncargo build --release\n\n# \u4ec5\u6784\u5efa\u670d\u52a1\u5668\ncargo build --release -p shortener-server\n\n# \u4ec5\u6784\u5efa CLI\ncargo build --release -p shortener-cli\n</code></pre>"},{"location":"general/INSTALLATION/#_19","title":"\u5b89\u88c5\u5230\u7cfb\u7edf","text":"<pre><code># \u590d\u5236\u4e8c\u8fdb\u5236\u6587\u4ef6\nsudo cp target/release/shortener-server /usr/local/bin/\nsudo cp target/release/shortener-cli /usr/local/bin/\n\n# \u8bbe\u7f6e\u6743\u9650\nsudo chmod +x /usr/local/bin/shortener-server\nsudo chmod +x /usr/local/bin/shortener-cli\n</code></pre>"},{"location":"general/INSTALLATION/#_20","title":"\u4ea4\u53c9\u7f16\u8bd1","text":"<pre><code># \u5b89\u88c5\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\nrustup target add x86_64-unknown-linux-musl\nrustup target add aarch64-unknown-linux-musl\n\n# \u4ea4\u53c9\u7f16\u8bd1\ncargo build --release --target x86_64-unknown-linux-musl\ncargo build --release --target aarch64-unknown-linux-musl\n</code></pre>"},{"location":"general/INSTALLATION/#_21","title":"\u9a8c\u8bc1\u5b89\u88c5","text":""},{"location":"general/INSTALLATION/#_22","title":"\u68c0\u67e5\u7248\u672c","text":"<pre><code># \u68c0\u67e5\u670d\u52a1\u5668\u7248\u672c\nshortener-server --version\n\n# \u68c0\u67e5 CLI \u7248\u672c\nshortener-cli --version\n</code></pre>"},{"location":"general/INSTALLATION/#_23","title":"\u6d4b\u8bd5\u8fd0\u884c","text":"<pre><code># \u6d4b\u8bd5\u670d\u52a1\u5668\uff08\u4f7f\u7528\u9ed8\u8ba4\u914d\u7f6e\uff09\nshortener-server --help\n\n# \u6d4b\u8bd5 CLI\nshortener-cli --help\n\n# \u6d4b\u8bd5 CLI \u65b0\u529f\u80fd\nshortener-cli find --help\n</code></pre>"},{"location":"general/INSTALLATION/#_24","title":"\u5b8c\u6574\u6d4b\u8bd5","text":"<pre><code># 1. \u542f\u52a8\u670d\u52a1\u5668\uff08\u540e\u53f0\u8fd0\u884c\uff09\nshortener-server &amp;\nSERVER_PID=$!\n\n# 2. \u7b49\u5f85\u670d\u52a1\u5668\u542f\u52a8\nsleep 2\n\n# 3. \u521d\u59cb\u5316 CLI\nshortener-cli init\n\n# 4. \u521b\u5efa\u6d4b\u8bd5\u94fe\u63a5\nshortener-cli create https://example.com\n\n# 5. \u6d4b\u8bd5\u67e5\u627e\u529f\u80fd\nshortener-cli find --original_url https://example.com\n\n# 6. \u505c\u6b62\u670d\u52a1\u5668\nkill $SERVER_PID\n</code></pre>"},{"location":"general/INSTALLATION/#_25","title":"\u6545\u969c\u6392\u9664","text":""},{"location":"general/INSTALLATION/#_26","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"general/INSTALLATION/#rust","title":"Rust \u7248\u672c\u8fc7\u4f4e","text":"<pre><code># \u9519\u8bef\u4fe1\u606f\nerror: package `shortener-server v1.0.0` cannot be built because it requires rustc 1.90 or newer\n\n# \u89e3\u51b3\u65b9\u6848\nrustup update stable\n</code></pre>"},{"location":"general/INSTALLATION/#_27","title":"\u7f3a\u5c11\u7cfb\u7edf\u4f9d\u8d56","text":"<pre><code># Ubuntu/Debian\nsudo apt update\nsudo apt install build-essential pkg-config libssl-dev\n\n# CentOS/RHEL\nsudo yum groupinstall \"Development Tools\"\nsudo yum install openssl-devel\n\n# macOS\nxcode-select --install\n</code></pre>"},{"location":"general/INSTALLATION/#_28","title":"\u7f51\u7edc\u8fde\u63a5\u95ee\u9898","text":"<pre><code># \u4f7f\u7528\u56fd\u5185\u955c\u50cf\u6e90\nexport RUSTUP_DIST_SERVER=https://mirrors.ustc.edu.cn/rust-static\nexport RUSTUP_UPDATE_ROOT=https://mirrors.ustc.edu.cn/rust-static/rustup\n\n# \u914d\u7f6e Cargo \u955c\u50cf\nmkdir -p ~/.cargo\ncat &gt;&gt; ~/.cargo/config.toml &lt;&lt; EOF\n[source.crates-io]\nreplace-with = 'ustc'\n\n[source.ustc]\nregistry = \"https://mirrors.ustc.edu.cn/crates.io-index\"\nEOF\n</code></pre>"},{"location":"general/INSTALLATION/#_29","title":"\u6743\u9650\u95ee\u9898","text":"<pre><code># \u5982\u679c\u5b89\u88c5\u5230\u7cfb\u7edf\u76ee\u5f55\u9700\u8981 sudo\nsudo cargo install --git https://github.com/jetsung/shortener.git --root /usr/local shortener-server\n\n# \u6216\u5b89\u88c5\u5230\u7528\u6237\u76ee\u5f55\ncargo install --git https://github.com/jetsung/shortener.git shortener-server\n# \u9ed8\u8ba4\u5b89\u88c5\u5230 ~/.cargo/bin/\n</code></pre>"},{"location":"general/INSTALLATION/#_30","title":"\u78c1\u76d8\u7a7a\u95f4\u4e0d\u8db3","text":"<pre><code># \u6e05\u7406 Cargo \u7f13\u5b58\ncargo clean\n\n# \u6e05\u7406\u6ce8\u518c\u8868\u7f13\u5b58\nrm -rf ~/.cargo/registry/cache/\nrm -rf ~/.cargo/git/db/\n\n# \u68c0\u67e5\u78c1\u76d8\u7a7a\u95f4\ndf -h\n</code></pre>"},{"location":"general/INSTALLATION/#_31","title":"\u83b7\u53d6\u5e2e\u52a9","text":"<p>\u5982\u679c\u9047\u5230\u5176\u4ed6\u95ee\u9898\uff1a</p> <ol> <li>\u67e5\u770b \u9879\u76ee\u6587\u6863</li> <li>\u641c\u7d22 GitHub Issues</li> <li>\u521b\u5efa\u65b0\u7684 Issue</li> <li>\u67e5\u770b \u8ba8\u8bba\u533a</li> </ol>"},{"location":"general/INSTALLATION/#_32","title":"\u65e5\u5fd7\u8c03\u8bd5","text":"<pre><code># \u542f\u7528\u8be6\u7ec6\u65e5\u5fd7\nRUST_LOG=debug shortener-server\n\n# \u542f\u7528\u7279\u5b9a\u6a21\u5757\u65e5\u5fd7\nRUST_LOG=shortener_server::handlers=debug shortener-server\n\n# \u4fdd\u5b58\u65e5\u5fd7\u5230\u6587\u4ef6\nshortener-server 2&gt;&amp;1 | tee shortener.log\n</code></pre>"},{"location":"general/INSTALLATION/#_33","title":"\u5378\u8f7d","text":""},{"location":"general/INSTALLATION/#cargo_1","title":"Cargo \u5b89\u88c5\u7684\u7a0b\u5e8f","text":"<pre><code># \u5378\u8f7d\u670d\u52a1\u5668\ncargo uninstall shortener-server\n\n# \u5378\u8f7d CLI\ncargo uninstall shortener-cli\n\n# \u67e5\u770b\u5df2\u5b89\u88c5\u7684\u7a0b\u5e8f\ncargo install --list\n</code></pre>"},{"location":"general/INSTALLATION/#_34","title":"\u624b\u52a8\u5b89\u88c5\u7684\u7a0b\u5e8f","text":"<pre><code># \u5220\u9664\u4e8c\u8fdb\u5236\u6587\u4ef6\nsudo rm /usr/local/bin/shortener-server\nsudo rm /usr/local/bin/shortener-cli\n\n# \u5220\u9664\u914d\u7f6e\u6587\u4ef6\uff08\u53ef\u9009\uff09\nrm -rf ~/.config/shortener/\n</code></pre>"},{"location":"general/INSTALLATION/#deb_1","title":"DEB \u5305","text":"<pre><code># \u5378\u8f7d\u5305\nsudo apt remove shortener-server\n\n# \u5b8c\u5168\u5220\u9664\uff08\u5305\u62ec\u914d\u7f6e\u6587\u4ef6\uff09\nsudo apt purge shortener-server\n</code></pre> <p>\u9700\u8981\u5e2e\u52a9\uff1f \u67e5\u770b \u9879\u76ee\u6587\u6863 \u6216\u5728 GitHub \u4e0a\u63d0\u95ee\u3002</p>"},{"location":"server/","title":"Shortener Server \u6587\u6863","text":"<p>\u672c\u76ee\u5f55\u5305\u542b shortener-server \u7684\u76f8\u5173\u6587\u6863\u3002</p>"},{"location":"server/#_1","title":"\u6587\u6863\u5217\u8868","text":"<ul> <li>API \u6587\u6863 - RESTful API \u53c2\u8003\u548c\u793a\u4f8b</li> <li>\u91cd\u6784\u8bf4\u660e - \u6309\u7167 OpenAPI \u89c4\u8303\u8fdb\u884c\u7684\u91cd\u6784\u8be6\u60c5</li> </ul>"},{"location":"server/#_2","title":"\u5feb\u901f\u94fe\u63a5","text":""},{"location":"server/#_3","title":"\u670d\u52a1\u5668\u76f8\u5173","text":"<ul> <li>\u914d\u7f6e\u8bf4\u660e</li> <li>\u90e8\u7f72\u6307\u5357</li> <li>Docker \u90e8\u7f72</li> </ul>"},{"location":"server/#_4","title":"\u5f00\u53d1\u76f8\u5173","text":"<ul> <li>\u5b89\u88c5\u6307\u5357</li> <li>\u8d21\u732e\u6307\u5357</li> </ul>"},{"location":"server/#_5","title":"\u8fc1\u79fb\u76f8\u5173","text":"<ul> <li>API \u53d8\u66f4\u8bf4\u660e</li> <li>\u6570\u636e\u5e93\u8fc1\u79fb</li> </ul>"},{"location":"server/#_6","title":"\u9879\u76ee\u7ed3\u6784","text":"<pre><code>shortener-server/\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 cache/          # \u7f13\u5b58\u5b9e\u73b0\n\u2502   \u251c\u2500\u2500 config/         # \u914d\u7f6e\u7ba1\u7406\n\u2502   \u251c\u2500\u2500 db/             # \u6570\u636e\u5e93\u8fde\u63a5\n\u2502   \u251c\u2500\u2500 errors/         # \u9519\u8bef\u5904\u7406\n\u2502   \u251c\u2500\u2500 geoip/          # GeoIP \u529f\u80fd\n\u2502   \u251c\u2500\u2500 handlers/       # HTTP \u5904\u7406\u5668\n\u2502   \u251c\u2500\u2500 logging/        # \u65e5\u5fd7\u914d\u7f6e\n\u2502   \u251c\u2500\u2500 middleware/     # \u4e2d\u95f4\u4ef6\n\u2502   \u251c\u2500\u2500 migration/      # \u6570\u636e\u5e93\u8fc1\u79fb\n\u2502   \u251c\u2500\u2500 models/         # \u6570\u636e\u6a21\u578b\n\u2502   \u251c\u2500\u2500 repositories/   # \u6570\u636e\u8bbf\u95ee\u5c42\n\u2502   \u251c\u2500\u2500 services/       # \u4e1a\u52a1\u903b\u8f91\u5c42\n\u2502   \u251c\u2500\u2500 router.rs       # \u8def\u7531\u914d\u7f6e\n\u2502   \u251c\u2500\u2500 lib.rs          # \u5e93\u5165\u53e3\n\u2502   \u2514\u2500\u2500 main.rs         # \u7a0b\u5e8f\u5165\u53e3\n\u251c\u2500\u2500 tests/              # \u6d4b\u8bd5\u6587\u4ef6\n\u251c\u2500\u2500 benches/            # \u6027\u80fd\u6d4b\u8bd5\n\u251c\u2500\u2500 docs/               # \u9879\u76ee\u6587\u6863\n\u2514\u2500\u2500 Cargo.toml          # \u9879\u76ee\u914d\u7f6e\n</code></pre>"},{"location":"server/#_7","title":"\u6280\u672f\u6808","text":"<ul> <li>Web \u6846\u67b6: Axum</li> <li>\u6570\u636e\u5e93 ORM: SeaORM</li> <li>\u5f02\u6b65\u8fd0\u884c\u65f6: Tokio</li> <li>\u5e8f\u5217\u5316: Serde</li> <li>\u65e5\u5fd7: Tracing</li> </ul>"},{"location":"server/#_8","title":"\u652f\u6301\u7684\u6570\u636e\u5e93","text":"<ul> <li>SQLite</li> <li>PostgreSQL</li> <li>MySQL</li> </ul>"},{"location":"server/#_9","title":"\u652f\u6301\u7684\u7f13\u5b58","text":"<ul> <li>Redis</li> <li>Valkey</li> <li>\u5185\u5b58\u7f13\u5b58\uff08NullCache\uff09</li> </ul>"},{"location":"server/#_10","title":"\u7279\u6027","text":"<ul> <li>\u2705 RESTful API</li> <li>\u2705 \u81ea\u5b9a\u4e49\u77ed\u7801</li> <li>\u2705 \u8bbf\u95ee\u7edf\u8ba1</li> <li>\u2705 GeoIP \u5b9a\u4f4d</li> <li>\u2705 \u7528\u6237\u4ee3\u7406\u89e3\u6790</li> <li>\u2705 API \u5bc6\u94a5\u8ba4\u8bc1</li> <li>\u2705 JWT \u4ee4\u724c\u8ba4\u8bc1</li> <li>\u2705 \u5065\u5eb7\u68c0\u67e5</li> <li>\u2705 \u7f13\u5b58\u652f\u6301</li> <li>\u2705 \u591a\u6570\u636e\u5e93\u652f\u6301</li> </ul>"},{"location":"server/#_11","title":"\u5f00\u53d1","text":""},{"location":"server/#_12","title":"\u8fd0\u884c\u6d4b\u8bd5","text":"<pre><code>cargo test\n</code></pre>"},{"location":"server/#_13","title":"\u8fd0\u884c\u670d\u52a1\u5668","text":"<pre><code>cargo run --release\n</code></pre>"},{"location":"server/#_14","title":"\u6784\u5efa","text":"<pre><code>cargo build --release\n</code></pre>"},{"location":"server/#_15","title":"\u76f8\u5173\u9879\u76ee","text":"<ul> <li>shortener-cli - \u547d\u4ee4\u884c\u5de5\u5177</li> </ul>"},{"location":"server/API/","title":"API \u6587\u6863","text":"<p>Shortener \u670d\u52a1\u5668\u7684\u5b8c\u6574 API \u53c2\u8003\u3002</p>"},{"location":"server/API/#url","title":"\u57fa\u7840 URL","text":"<pre><code>http://localhost:8080\n</code></pre>"},{"location":"server/API/#_1","title":"\u8ba4\u8bc1","text":"<p>\u6240\u6709 API \u7aef\u70b9\uff08\u5065\u5eb7\u68c0\u67e5\u9664\u5916\uff09\u9700\u8981\u4f7f\u7528\u4ee5\u4e0b\u65b9\u5f0f\u4e4b\u4e00\u8fdb\u884c\u8ba4\u8bc1\uff1a</p>"},{"location":"server/API/#api_1","title":"API \u5bc6\u94a5\u8ba4\u8bc1","text":"<p>\u5728\u8bf7\u6c42\u5934\u4e2d\u5305\u542b API \u5bc6\u94a5\uff1a</p> <pre><code>X-API-KEY: your-api-key\n</code></pre>"},{"location":"server/API/#jwt","title":"JWT \u4ee4\u724c\u8ba4\u8bc1","text":"<ol> <li>\u767b\u5f55\u83b7\u53d6\u4ee4\u724c</li> <li>\u5728\u540e\u7eed\u8bf7\u6c42\u4e2d\u5305\u542b\u4ee4\u724c\uff1a</li> </ol> <pre><code>Authorization: Bearer &lt;your-jwt-token&gt;\n</code></pre>"},{"location":"server/API/#_2","title":"\u54cd\u5e94\u683c\u5f0f","text":""},{"location":"server/API/#_3","title":"\u6210\u529f\u54cd\u5e94","text":"<pre><code>{\n  \"id\": 1,\n  \"code\": \"abc123\",\n  \"short_url\": \"http://localhost:8080/abc123\",\n  \"original_url\": \"https://example.com\",\n  \"describe\": \"\u793a\u4f8b\u7f51\u7ad9\",\n  \"status\": 1,\n  \"created_at\": \"2024-03-20T12:00:00Z\",\n  \"updated_at\": \"2024-03-20T12:00:00Z\"\n}\n</code></pre>"},{"location":"server/API/#_4","title":"\u9519\u8bef\u54cd\u5e94","text":"<pre><code>{\n  \"errcode\": \"NOT_FOUND\",\n  \"errinfo\": \"\u672a\u627e\u5230\u77ed\u94fe\u63a5\"\n}\n</code></pre>"},{"location":"server/API/#_5","title":"\u5206\u9875\u54cd\u5e94","text":"<pre><code>{\n  \"data\": [...],\n  \"meta\": {\n    \"page\": 1,\n    \"page_size\": 10,\n    \"current_count\": 10,\n    \"total_items\": 100,\n    \"total_pages\": 10\n  }\n}\n</code></pre>"},{"location":"server/API/#http","title":"HTTP \u72b6\u6001\u7801","text":"<ul> <li><code>200 OK</code> - \u8bf7\u6c42\u6210\u529f</li> <li><code>201 Created</code> - \u8d44\u6e90\u521b\u5efa\u6210\u529f</li> <li><code>204 No Content</code> - \u8bf7\u6c42\u6210\u529f\uff0c\u65e0\u5185\u5bb9\u8fd4\u56de</li> <li><code>400 Bad Request</code> - \u65e0\u6548\u7684\u8bf7\u6c42\u53c2\u6570</li> <li><code>401 Unauthorized</code> - \u9700\u8981\u8ba4\u8bc1\u6216\u8ba4\u8bc1\u5931\u8d25</li> <li><code>403 Forbidden</code> - \u6743\u9650\u4e0d\u8db3</li> <li><code>404 Not Found</code> - \u8d44\u6e90\u672a\u627e\u5230</li> <li><code>409 Conflict</code> - \u8d44\u6e90\u5df2\u5b58\u5728</li> <li><code>500 Internal Server Error</code> - \u670d\u52a1\u5668\u9519\u8bef</li> </ul>"},{"location":"server/API/#_6","title":"\u7aef\u70b9","text":""},{"location":"server/API/#_7","title":"\u8d26\u6237\u7ba1\u7406","text":""},{"location":"server/API/#_8","title":"\u767b\u5f55","text":"<p>\u83b7\u53d6\u7528\u4e8e\u8ba4\u8bc1\u7684 JWT \u4ee4\u724c\u3002</p> <pre><code>POST /api/account/login\nContent-Type: application/json\n\n{\n  \"username\": \"admin\",\n  \"password\": \"your-password\",\n  \"auto\": false\n}\n</code></pre> <p>\u54cd\u5e94\uff1a</p> <pre><code>{\n  \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n}\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>curl -X POST http://localhost:8080/api/account/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"username\":\"admin\",\"password\":\"your-password\"}'\n</code></pre>"},{"location":"server/API/#_9","title":"\u767b\u51fa","text":"<p>\u4f7f\u5f53\u524d JWT \u4ee4\u724c\u5931\u6548\u3002</p> <pre><code>POST /api/account/logout\nAuthorization: Bearer &lt;token&gt;\n</code></pre>"},{"location":"server/API/#_10","title":"\u83b7\u53d6\u5f53\u524d\u7528\u6237","text":"<p>\u83b7\u53d6\u5f53\u524d\u8ba4\u8bc1\u7528\u6237\u7684\u4fe1\u606f\u3002</p> <pre><code>GET /api/users/current\nAuthorization: Bearer &lt;token&gt;\n</code></pre>"},{"location":"server/API/#_11","title":"\u77ed\u94fe\u63a5\u7ba1\u7406","text":""},{"location":"server/API/#_12","title":"\u521b\u5efa\u77ed\u94fe\u63a5","text":"<p>\u521b\u5efa\u65b0\u7684\u77ed\u94fe\u63a5\u3002</p> <pre><code>POST /api/shortens\nX-API-KEY: your-api-key\nContent-Type: application/json\n\n{\n  \"original_url\": \"https://example.com\",\n  \"code\": \"mylink\",\n  \"describe\": \"\u793a\u4f8b\u7f51\u7ad9\"\n}\n</code></pre> <p>\u53c2\u6570\uff1a</p> <ul> <li><code>original_url</code>\uff08\u5fc5\u9700\uff09\uff1a\u539f\u59cb\u957f URL</li> <li><code>code</code>\uff08\u53ef\u9009\uff09\uff1a\u81ea\u5b9a\u4e49\u77ed\u4ee3\u7801\uff08\u672a\u63d0\u4f9b\u5219\u81ea\u52a8\u751f\u6210\uff09</li> <li><code>describe</code>\uff08\u53ef\u9009\uff09\uff1aURL \u63cf\u8ff0</li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code>curl -X POST http://localhost:8080/api/shortens \\\n  -H \"X-API-KEY: your-api-key\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"original_url\": \"https://example.com\",\n    \"code\": \"mylink\",\n    \"describe\": \"\u793a\u4f8b\u7f51\u7ad9\"\n  }'\n</code></pre>"},{"location":"server/API/#_13","title":"\u83b7\u53d6\u77ed\u94fe\u63a5","text":"<p>\u83b7\u53d6\u7279\u5b9a\u77ed\u94fe\u63a5\u7684\u8be6\u60c5\u3002</p> <pre><code>GET /api/shortens/{code}\nX-API-KEY: your-api-key\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>curl http://localhost:8080/api/shortens/mylink \\\n  -H \"X-API-KEY: your-api-key\"\n</code></pre>"},{"location":"server/API/#_14","title":"\u5217\u51fa\u77ed\u94fe\u63a5","text":"<p>\u83b7\u53d6\u77ed\u94fe\u63a5\u7684\u5206\u9875\u5217\u8868\u3002</p> <pre><code>GET /api/shortens?page=1&amp;page_size=10&amp;sort_by=created_at&amp;order=desc&amp;status=1\nX-API-KEY: your-api-key\n</code></pre> <p>\u67e5\u8be2\u53c2\u6570\uff1a</p> <ul> <li><code>page</code>\uff08\u53ef\u9009\uff0c\u9ed8\u8ba4\uff1a1\uff09\uff1a\u9875\u7801</li> <li><code>page_size</code>\uff08\u53ef\u9009\uff0c\u9ed8\u8ba4\uff1a10\uff09\uff1a\u6bcf\u9875\u9879\u6570</li> <li><code>sort_by</code>\uff08\u53ef\u9009\uff0c\u9ed8\u8ba4\uff1acreated_at\uff09\uff1a\u6392\u5e8f\u5b57\u6bb5</li> <li><code>order</code>\uff08\u53ef\u9009\uff0c\u9ed8\u8ba4\uff1adesc\uff09\uff1a\u6392\u5e8f\u987a\u5e8f\uff08asc\u3001desc\uff09</li> <li><code>code</code>\uff08\u53ef\u9009\uff09\uff1a\u6309\u77ed\u94fe\u63a5\u4ee3\u7801\u8fc7\u6ee4</li> <li><code>original_url</code>\uff08\u53ef\u9009\uff09\uff1a\u6309\u539f\u59cbURL\u6a21\u7cca\u67e5\u627e</li> <li><code>status</code>\uff08\u53ef\u9009\uff09\uff1a\u6309\u72b6\u6001\u8fc7\u6ee4\uff080=\u542f\u7528\uff0c1=\u7981\u7528\uff09</li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code># \u57fa\u672c\u67e5\u8be2\ncurl \"http://localhost:8080/api/shortens?page=1&amp;page_size=10\" \\\n  -H \"X-API-KEY: your-api-key\"\n\n# \u6309\u77ed\u94fe\u63a5\u4ee3\u7801\u8fc7\u6ee4\ncurl \"http://localhost:8080/api/shortens?code=gitmirror\" \\\n  -H \"X-API-KEY: your-api-key\"\n\n# \u6309\u539f\u59cbURL\u6a21\u7cca\u67e5\u627e\ncurl \"http://localhost:8080/api/shortens?original_url=github.com\" \\\n  -H \"X-API-KEY: your-api-key\"\n\n# \u6309\u72b6\u6001\u8fc7\u6ee4\ncurl \"http://localhost:8080/api/shortens?status=0\" \\\n  -H \"X-API-KEY: your-api-key\"\n\n# \u7ec4\u5408\u8fc7\u6ee4\ncurl \"http://localhost:8080/api/shortens?page=1&amp;page_size=10&amp;sort_by=created_at&amp;order=desc&amp;code=gitmirror&amp;original_url=github&amp;status=0\" \\\n  -H \"X-API-KEY: your-api-key\"\n</code></pre>"},{"location":"server/API/#_15","title":"\u66f4\u65b0\u77ed\u94fe\u63a5","text":"<p>\u66f4\u65b0\u73b0\u6709\u77ed\u94fe\u63a5\u3002</p> <pre><code>PUT /api/shortens/{code}\nX-API-KEY: your-api-key\nContent-Type: application/json\n\n{\n  \"original_url\": \"https://newurl.com\",\n  \"describe\": \"\u66f4\u65b0\u7684\u63cf\u8ff0\"\n}\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>curl -X PUT http://localhost:8080/api/shortens/mylink \\\n  -H \"X-API-KEY: your-api-key\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"original_url\": \"https://newurl.com\",\n    \"describe\": \"\u66f4\u65b0\u7684\u63cf\u8ff0\"\n  }'\n</code></pre>"},{"location":"server/API/#_16","title":"\u5220\u9664\u77ed\u94fe\u63a5","text":"<p>\u5220\u9664\u7279\u5b9a\u77ed\u94fe\u63a5\u3002</p> <pre><code>DELETE /api/shortens/{code}\nX-API-KEY: your-api-key\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>curl -X DELETE http://localhost:8080/api/shortens/mylink \\\n  -H \"X-API-KEY: your-api-key\"\n</code></pre>"},{"location":"server/API/#_17","title":"\u6279\u91cf\u5220\u9664\u77ed\u94fe\u63a5","text":"<p>\u4e00\u6b21\u5220\u9664\u591a\u4e2a\u77ed\u94fe\u63a5\u3002</p> <pre><code>POST /api/shortens/batch-delete\nX-API-KEY: your-api-key\nContent-Type: application/json\n\n{\n  \"ids\": [1, 2, 3]\n}\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>curl -X POST \"http://localhost:8080/api/shortens/batch-delete\" \\\n  -H \"X-API-KEY: your-api-key\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"ids\": [1, 2, 3]}'\n</code></pre>"},{"location":"server/API/#_18","title":"\u8bbf\u95ee\u5386\u53f2","text":""},{"location":"server/API/#_19","title":"\u5217\u51fa\u8bbf\u95ee\u5386\u53f2","text":"<p>\u83b7\u53d6\u8bbf\u95ee\u5386\u53f2\u8bb0\u5f55\u7684\u5206\u9875\u5217\u8868\u3002</p> <pre><code>GET /api/histories?page=1&amp;page_size=10&amp;sort_by=accessed_at&amp;order=desc\nX-API-KEY: your-api-key\n</code></pre> <p>\u67e5\u8be2\u53c2\u6570\uff1a</p> <ul> <li><code>page</code>\uff08\u53ef\u9009\uff0c\u9ed8\u8ba4\uff1a1\uff09\uff1a\u9875\u7801</li> <li><code>page_size</code>\uff08\u53ef\u9009\uff0c\u9ed8\u8ba4\uff1a10\uff09\uff1a\u6bcf\u9875\u9879\u6570</li> <li><code>sort_by</code>\uff08\u53ef\u9009\uff0c\u9ed8\u8ba4\uff1aaccessed_at\uff09\uff1a\u6392\u5e8f\u5b57\u6bb5</li> <li><code>order</code>\uff08\u53ef\u9009\uff0c\u9ed8\u8ba4\uff1adesc\uff09\uff1a\u6392\u5e8f\u987a\u5e8f</li> <li><code>ip_address</code>\uff08\u53ef\u9009\uff09\uff1a\u6309IP\u5730\u5740\u8fc7\u6ee4</li> <li><code>short_code</code>\uff08\u53ef\u9009\uff09\uff1a\u6309\u77ed\u94fe\u63a5\u4ee3\u7801\u8fc7\u6ee4</li> <li><code>url_id</code>\uff08\u53ef\u9009\uff09\uff1a\u6309URL ID\u8fc7\u6ee4</li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code># \u57fa\u672c\u67e5\u8be2\ncurl \"http://localhost:8080/api/histories?page=1&amp;page_size=10\" \\\n  -H \"X-API-KEY: your-api-key\"\n\n# \u6309IP\u5730\u5740\u8fc7\u6ee4\ncurl \"http://localhost:8080/api/histories?ip_address=192.168.1.1\" \\\n  -H \"X-API-KEY: your-api-key\"\n\n# \u6309\u77ed\u94fe\u63a5\u4ee3\u7801\u8fc7\u6ee4\ncurl \"http://localhost:8080/api/histories?short_code=abc123\" \\\n  -H \"X-API-KEY: your-api-key\"\n</code></pre>"},{"location":"server/API/#_20","title":"\u6279\u91cf\u5220\u9664\u5386\u53f2","text":"<p>\u4e00\u6b21\u5220\u9664\u591a\u4e2a\u5386\u53f2\u8bb0\u5f55\u3002</p> <pre><code>POST /api/histories/batch-delete\nX-API-KEY: your-api-key\nContent-Type: application/json\n\n{\n  \"ids\": [1, 2, 3]\n}\n</code></pre> <p>\u793a\u4f8b\uff1a</p> <pre><code>curl -X POST \"http://localhost:8080/api/histories/batch-delete\" \\\n  -H \"X-API-KEY: your-api-key\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"ids\": [1, 2, 3]}'\n</code></pre>"},{"location":"server/API/#_21","title":"\u9519\u8bef\u4ee3\u7801","text":"\u4ee3\u7801 \u63cf\u8ff0 <code>SYSTEM_ERROR</code> \u5185\u90e8\u7cfb\u7edf\u9519\u8bef <code>CONFIG_ERROR</code> \u914d\u7f6e\u9519\u8bef <code>URL_NOT_FOUND</code> \u672a\u627e\u5230\u77ed\u94fe\u63a5 <code>CODE_EXISTS</code> \u77ed\u4ee3\u7801\u5df2\u5b58\u5728 <code>INVALID_URL</code> \u65e0\u6548\u7684 URL \u683c\u5f0f <code>UNAUTHORIZED</code> \u9700\u8981\u8ba4\u8bc1\u6216\u8ba4\u8bc1\u5931\u8d25 <code>FORBIDDEN</code> \u6743\u9650\u4e0d\u8db3 <code>NOT_FOUND</code> \u8d44\u6e90\u672a\u627e\u5230 <code>BAD_REQUEST</code> \u65e0\u6548\u7684\u8bf7\u6c42\u53c2\u6570 <code>DATABASE_ERROR</code> \u6570\u636e\u5e93\u64cd\u4f5c\u5931\u8d25 <code>CACHE_ERROR</code> \u7f13\u5b58\u64cd\u4f5c\u5931\u8d25 <code>GEOIP_ERROR</code> GeoIP \u67e5\u627e\u5931\u8d25"},{"location":"server/API/#_22","title":"\u5b8c\u6574\u5de5\u4f5c\u6d41\u793a\u4f8b","text":"<pre><code># 1. \u767b\u5f55\nTOKEN=$(curl -s -X POST http://localhost:8080/api/account/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"username\":\"admin\",\"password\":\"password\"}' \\\n  | jq -r '.token')\n\n# 2. \u521b\u5efa\u77ed\u94fe\u63a5\ncurl -X POST http://localhost:8080/api/shortens \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"original_url\":\"https://example.com\",\"code\":\"test\"}'\n\n# 3. \u83b7\u53d6\u77ed\u94fe\u63a5\ncurl http://localhost:8080/api/shortens/test \\\n  -H \"Authorization: Bearer $TOKEN\"\n\n# 4. \u5217\u51fa\u6240\u6709 URL\ncurl \"http://localhost:8080/api/shortens?page=1&amp;page_size=10\" \\\n  -H \"Authorization: Bearer $TOKEN\"\n\n# 5. \u66f4\u65b0 URL\ncurl -X PUT http://localhost:8080/api/shortens/test \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"original_url\":\"https://newurl.com\"}'\n\n# 6. \u5220\u9664 URL\ncurl -X DELETE http://localhost:8080/api/shortens/test \\\n  -H \"Authorization: Bearer $TOKEN\"\n\n# 7. \u767b\u51fa\ncurl -X POST http://localhost:8080/api/account/logout \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"server/API/#openapi","title":"OpenAPI \u89c4\u8303","text":"<p>\u5b8c\u6574\u7684\u673a\u5668\u53ef\u8bfb API \u89c4\u8303\uff0c\u8bf7\u53c2\u9605 openapi.yml\u3002</p> <p>\u4f60\u53ef\u4ee5\u4f7f\u7528\u6b64\u89c4\u8303\u914d\u5408\u4ee5\u4e0b\u5de5\u5177\uff1a - Swagger UI - Postman - Insomnia</p>"},{"location":"server/API/#_23","title":"\u652f\u6301","text":"<p>API \u652f\u6301\uff1a - \ud83d\udc1b \u62a5\u544a\u95ee\u9898</p>"},{"location":"server/BENCHMARKS/","title":"\u57fa\u51c6\u6d4b\u8bd5\u5feb\u901f\u53c2\u8003","text":""},{"location":"server/BENCHMARKS/#_2","title":"\u8fd0\u884c\u57fa\u51c6\u6d4b\u8bd5","text":"<pre><code># \u8fd0\u884c\u6240\u6709\u57fa\u51c6\u6d4b\u8bd5\uff08\u9700\u8981\u51e0\u5206\u949f\uff09\ncargo bench\n\n# \u8fd0\u884c\u7279\u5b9a\u57fa\u51c6\u6d4b\u8bd5\u5957\u4ef6\ncargo bench --bench code_generation_bench\ncargo bench --bench url_validation_bench\ncargo bench --bench database_bench\ncargo bench --bench cache_bench\ncargo bench --bench service_bench\n\n# \u5feb\u901f\u6d4b\u8bd5\u6a21\u5f0f\uff08\u7528\u4e8e CI/CD\uff09\ncargo bench -- --test\n\n# \u8fd0\u884c\u7279\u5b9a\u57fa\u51c6\u6d4b\u8bd5\ncargo bench -- \"code_generation/6\"\n\n# \u4fdd\u5b58\u57fa\u7ebf\u4ee5\u4f9b\u6bd4\u8f83\ncargo bench -- --save-baseline my-baseline\n\n# \u4e0e\u57fa\u7ebf\u6bd4\u8f83\ncargo bench -- --baseline my-baseline\n</code></pre>"},{"location":"server/BENCHMARKS/#_3","title":"\u57fa\u51c6\u6d4b\u8bd5\u5957\u4ef6","text":""},{"location":"server/BENCHMARKS/#1-code_generation_benchrs","title":"1. \u4ee3\u7801\u751f\u6210\uff08<code>code_generation_bench.rs</code>\uff09","text":"<ul> <li>\u4e0d\u540c\u957f\u5ea6\u7684\u4ee3\u7801\u751f\u6210\uff084-16 \u4e2a\u5b57\u7b26\uff09</li> <li>\u4e0d\u540c\u7684\u5b57\u7b26\u96c6</li> <li>\u552f\u4e00\u6027\u68c0\u67e5</li> </ul> <p>\u9884\u671f\uff1a\u6bcf\u4e2a\u4ee3\u7801\u7ea6 200-300 \u7eb3\u79d2</p>"},{"location":"server/BENCHMARKS/#2-url-url_validation_benchrs","title":"2. URL \u9a8c\u8bc1\uff08<code>url_validation_bench.rs</code>\uff09","text":"<ul> <li>URL \u683c\u5f0f\u9a8c\u8bc1</li> <li>\u4ee3\u7801\u683c\u5f0f\u9a8c\u8bc1</li> <li>\u5b57\u7b26\u96c6\u521b\u5efa</li> </ul> <p>\u9884\u671f\uff1a\u6bcf\u6b21\u9a8c\u8bc1\u7ea6 50-100 \u7eb3\u79d2</p>"},{"location":"server/BENCHMARKS/#3-database_benchrs","title":"3. \u6570\u636e\u5e93\u64cd\u4f5c\uff08<code>database_bench.rs</code>\uff09","text":"<ul> <li>CRUD \u64cd\u4f5c</li> <li>\u5206\u9875\u548c\u8fc7\u6ee4</li> <li>\u6279\u91cf\u64cd\u4f5c</li> </ul> <p>\u9884\u671f\uff1a\u5927\u591a\u6570\u64cd\u4f5c\u5728\u4e9a\u6beb\u79d2\u7ea7</p>"},{"location":"server/BENCHMARKS/#_4","title":"\u6027\u80fd\u76ee\u6807","text":"<ul> <li>\u4ee3\u7801\u751f\u6210\uff1a&lt; 500 \u7eb3\u79d2</li> <li>URL \u9a8c\u8bc1\uff1a&lt; 200 \u7eb3\u79d2</li> <li>\u6570\u636e\u5e93\u67e5\u8be2\uff1a&lt; 10 \u6beb\u79d2</li> <li>\u7f13\u5b58\u64cd\u4f5c\uff1a&lt; 1 \u6beb\u79d2</li> </ul>"},{"location":"server/BENCHMARKS/#_5","title":"\u67e5\u770b\u7ed3\u679c","text":"<p>\u57fa\u51c6\u6d4b\u8bd5\u7ed3\u679c\u4fdd\u5b58\u5728 <code>target/criterion/</code> \u76ee\u5f55\u4e2d\u3002</p> <p>\u4f7f\u7528\u6d4f\u89c8\u5668\u6253\u5f00 <code>target/criterion/report/index.html</code> \u67e5\u770b\u8be6\u7ec6\u62a5\u544a\u3002</p>"},{"location":"server/CONFIG/","title":"\u914d\u7f6e\u6a21\u5757\u6587\u6863","text":""},{"location":"server/CONFIG/#_2","title":"\u6982\u8ff0","text":"<p>\u914d\u7f6e\u6a21\u5757\u4e3a Shortener \u670d\u52a1\u5668\u63d0\u4f9b\u4e86\u4e00\u79cd\u5065\u58ee\u4e14\u7c7b\u578b\u5b89\u5168\u7684\u65b9\u5f0f\u6765\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u8bbe\u7f6e\u3002\u5b83\u652f\u6301\u4ece TOML \u6587\u4ef6\u548c\u73af\u5883\u53d8\u91cf\u52a0\u8f7d\u914d\u7f6e\uff0c\u5177\u6709\u81ea\u52a8\u9a8c\u8bc1\u548c\u9ed8\u8ba4\u503c\u5904\u7406\u529f\u80fd\u3002</p>"},{"location":"server/CONFIG/#_3","title":"\u7279\u6027","text":"<ul> <li>\u7c7b\u578b\u5b89\u5168\u914d\u7f6e\uff1a\u6240\u6709\u914d\u7f6e\u503c\u90fd\u662f\u5f3a\u7c7b\u578b\u7684</li> <li>\u591a\u6570\u636e\u6e90\uff1a\u4ece TOML \u6587\u4ef6\u548c\u73af\u5883\u53d8\u91cf\u52a0\u8f7d</li> <li>\u9a8c\u8bc1\uff1a\u81ea\u52a8\u9a8c\u8bc1\u5fc5\u9700\u5b57\u6bb5\u548c\u503c\u8303\u56f4</li> <li>\u9ed8\u8ba4\u503c\uff1a\u53ef\u9009\u914d\u7f6e\u7684\u5408\u7406\u9ed8\u8ba4\u503c</li> <li>\u591a\u6570\u636e\u5e93\u652f\u6301\uff1aSQLite\u3001PostgreSQL \u548c MySQL</li> <li>\u591a\u7f13\u5b58\u540e\u7aef\uff1aRedis \u548c Valkey</li> <li>GeoIP \u652f\u6301\uff1aip2region \u96c6\u6210</li> </ul>"},{"location":"server/CONFIG/#_4","title":"\u914d\u7f6e\u7ed3\u6784","text":""},{"location":"server/CONFIG/#_5","title":"\u670d\u52a1\u5668\u914d\u7f6e","text":"<pre><code>[server]\naddress = \":8080\"                          # \u670d\u52a1\u5668\u76d1\u542c\u5730\u5740\ntrusted-platform = \"\"                      # \u53ef\u4fe1\u5e73\u53f0\u5934\uff08\u53ef\u9009\uff09\nsite_url = \"http://localhost:8080\"        # \u516c\u5171\u7ad9\u70b9 URL\napi_key = \"your-secret-api-key\"           # \u7528\u4e8e\u8ba4\u8bc1\u7684 API \u5bc6\u94a5\uff08\u5fc5\u9700\uff09\n</code></pre>"},{"location":"server/CONFIG/#_6","title":"\u77ed\u94fe\u63a5\u914d\u7f6e","text":"<pre><code>[shortener]\ncode_length = 6                           # \u751f\u6210\u7684\u77ed\u4ee3\u7801\u957f\u5ea6\uff084-16\uff09\ncode_charset = \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n</code></pre>"},{"location":"server/CONFIG/#_7","title":"\u7ba1\u7406\u5458\u914d\u7f6e","text":"<pre><code>[admin]\nusername = \"admin\"                        # \u7ba1\u7406\u5458\u7528\u6237\u540d\uff08\u5fc5\u9700\uff09\npassword = \"secure-password\"              # \u7ba1\u7406\u5458\u5bc6\u7801\uff08\u5fc5\u9700\uff09\n</code></pre>"},{"location":"server/CONFIG/#_8","title":"\u6570\u636e\u5e93\u914d\u7f6e","text":""},{"location":"server/CONFIG/#sqlite","title":"SQLite","text":"<pre><code>[database]\ntype = \"sqlite\"\nlog_level = 1                             # 1=\u9759\u9ed8, 2=\u9519\u8bef, 3=\u8b66\u544a, 4=\u4fe1\u606f\n\n[database.sqlite]\npath = \"data/shortener.db\"\n</code></pre>"},{"location":"server/CONFIG/#postgresql","title":"PostgreSQL","text":"<pre><code>[database]\ntype = \"postgres\"\nlog_level = 1\n\n[database.postgres]\nhost = \"localhost\"\nport = 5432\nuser = \"postgres\"\npassword = \"postgres\"\ndatabase = \"shortener\"\nsslmode = \"disable\"\ntimezone = \"Asia/Shanghai\"\n</code></pre>"},{"location":"server/CONFIG/#mysql","title":"MySQL","text":"<pre><code>[database]\ntype = \"mysql\"\nlog_level = 1\n\n[database.mysql]\nhost = \"localhost\"\nport = 3306\nuser = \"root\"\npassword = \"root\"\ndatabase = \"shortener\"\ncharset = \"utf8mb4\"\nparse_time = true\nloc = \"Local\"\n</code></pre>"},{"location":"server/CONFIG/#_9","title":"\u7f13\u5b58\u914d\u7f6e","text":""},{"location":"server/CONFIG/#redis","title":"Redis","text":"<pre><code>[cache]\nenabled = true\ntype = \"redis\"\nexpire = 3600                             # \u7f13\u5b58\u8fc7\u671f\u65f6\u95f4\uff08\u79d2\uff09\nprefix = \"shorten:\"                       # \u7f13\u5b58\u952e\u524d\u7f00\n\n[cache.redis]\nhost = \"localhost\"\nport = 6379\npassword = \"\"\ndb = 0\n</code></pre>"},{"location":"server/CONFIG/#valkey","title":"Valkey","text":"<pre><code>[cache]\nenabled = true\ntype = \"valkey\"\nexpire = 3600\nprefix = \"shorten:\"\n\n[cache.valkey]\nhost = \"localhost\"\nport = 6379\nusername = \"\"\npassword = \"\"\ndb = 0\n</code></pre>"},{"location":"server/CONFIG/#geoip","title":"GeoIP \u914d\u7f6e","text":"<pre><code>[geoip]\nenabled = true\ntype = \"ip2region\"\n\n[geoip.ip2region]\npath = \"data/ip2region.xdb\"\nmode = \"vector\"\nversion = \"4\"                             # \"4\" \u8868\u793a IPv4\uff0c\"6\" \u8868\u793a IPv6\n</code></pre>"},{"location":"server/CONFIG/#_10","title":"\u4f7f\u7528","text":""},{"location":"server/CONFIG/#_11","title":"\u52a0\u8f7d\u914d\u7f6e","text":"<pre><code>use config::Config;\n\n// \u4ece\u9ed8\u8ba4\u4f4d\u7f6e\u52a0\u8f7d\uff08config/config.toml\uff09\nlet config = Config::load()?;\n\n// \u4ece\u6307\u5b9a\u6587\u4ef6\u52a0\u8f7d\nlet config = Config::from_file(\"path/to/config.toml\")?;\n</code></pre>"},{"location":"server/CONFIG/#_12","title":"\u73af\u5883\u53d8\u91cf","text":"<p>\u53ef\u4ee5\u4f7f\u7528\u524d\u7f00\u4e3a <code>SHORTENER__</code> \u7684\u73af\u5883\u53d8\u91cf\u8986\u76d6\u914d\u7f6e\uff1a</p> <pre><code># \u8986\u76d6\u670d\u52a1\u5668\u5730\u5740\nexport SHORTENER__SERVER__ADDRESS=\":9090\"\n\n# \u8986\u76d6\u6570\u636e\u5e93\u7c7b\u578b\nexport SHORTENER__DATABASE__TYPE=\"postgres\"\n\n# \u8986\u76d6\u7f13\u5b58\u542f\u7528\nexport SHORTENER__CACHE__ENABLED=\"true\"\n</code></pre> <p>\u6ce8\u610f\uff1a\u4f7f\u7528\u53cc\u4e0b\u5212\u7ebf\uff08<code>__</code>\uff09\u5206\u9694\u5d4c\u5957\u7684\u914d\u7f6e\u952e\u3002</p>"},{"location":"server/CONFIG/#_13","title":"\u83b7\u53d6\u8fde\u63a5\u5b57\u7b26\u4e32","text":"<pre><code>// \u83b7\u53d6\u6570\u636e\u5e93\u8fde\u63a5 URL\nlet db_url = config.get_database_url();\n// \u8fd4\u56de: \"sqlite://data/shortener.db?mode=rwc\"\n//   \u6216: \"postgres://user:pass@host:port/db?sslmode=disable\"\n//   \u6216: \"mysql://user:pass@host:port/db?charset=utf8mb4\"\n\n// \u83b7\u53d6\u7f13\u5b58\u8fde\u63a5 URL\uff08\u5982\u679c\u542f\u7528\uff09\nif let Some(cache_url) = config.get_cache_url() {\n    // \u8fd4\u56de: \"redis://:password@host:port/db\"\n    //   \u6216: \"redis://username:password@host:port/db\"\n}\n</code></pre>"},{"location":"server/CONFIG/#_14","title":"\u9a8c\u8bc1\u89c4\u5219","text":"<p>\u914d\u7f6e\u6a21\u5757\u81ea\u52a8\u9a8c\u8bc1\uff1a</p> <ol> <li>\u5fc5\u9700\u5b57\u6bb5\uff1a</li> <li><code>server.api_key</code> \u4e0d\u80fd\u4e3a\u7a7a</li> <li><code>admin.username</code> \u4e0d\u80fd\u4e3a\u7a7a</li> <li> <p><code>admin.password</code> \u4e0d\u80fd\u4e3a\u7a7a</p> </li> <li> <p>\u503c\u8303\u56f4\uff1a</p> </li> <li><code>shortener.code_length</code> \u5fc5\u987b\u5728 4 \u5230 16 \u4e4b\u95f4</li> <li> <p><code>shortener.code_charset</code> \u4e0d\u80fd\u4e3a\u7a7a</p> </li> <li> <p>\u6761\u4ef6\u8981\u6c42\uff1a</p> </li> <li>\u5f53 <code>database.type = \"sqlite\"</code> \u65f6\uff0c\u9700\u8981 <code>database.sqlite</code> \u90e8\u5206</li> <li>\u5f53 <code>database.type = \"postgres\"</code> \u65f6\uff0c\u9700\u8981 <code>database.postgres</code> \u90e8\u5206</li> <li>\u5f53 <code>database.type = \"mysql\"</code> \u65f6\uff0c\u9700\u8981 <code>database.mysql</code> \u90e8\u5206</li> <li>\u5f53 <code>cache.enabled = true</code> \u4e14 <code>cache.type = \"redis\"</code> \u65f6\uff0c\u9700\u8981 <code>cache.redis</code> \u90e8\u5206</li> <li>\u5f53 <code>cache.enabled = true</code> \u4e14 <code>cache.type = \"valkey\"</code> \u65f6\uff0c\u9700\u8981 <code>cache.valkey</code> \u90e8\u5206</li> <li>\u5f53 <code>geoip.enabled = true</code> \u65f6\uff0c\u9700\u8981 <code>geoip.ip2region</code> \u90e8\u5206</li> </ol>"},{"location":"server/CONFIG/#_15","title":"\u9ed8\u8ba4\u503c","text":"<p>\u5982\u679c\u672a\u6307\u5b9a\uff0c\u5c06\u5e94\u7528\u4ee5\u4e0b\u9ed8\u8ba4\u503c\uff1a</p> <ul> <li><code>server.address</code>: <code>:8080</code></li> <li><code>server.site_url</code>: <code>http://localhost:8080</code></li> <li><code>shortener.code_length</code>: <code>6</code></li> <li><code>shortener.code_charset</code>: <code>0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ</code></li> <li><code>cache.expire</code>: <code>3600</code></li> <li><code>cache.prefix</code>: <code>shorten:</code></li> <li><code>database.log_level</code>: <code>1</code></li> </ul>"},{"location":"server/CONFIG/#_16","title":"\u9519\u8bef\u5904\u7406","text":"<p>\u914d\u7f6e\u52a0\u8f7d\u53ef\u80fd\u56e0\u591a\u79cd\u539f\u56e0\u5931\u8d25\uff1a</p> <pre><code>match Config::load() {\n    Ok(config) =&gt; {\n        // \u914d\u7f6e\u52a0\u8f7d\u6210\u529f\n    }\n    Err(e) =&gt; {\n        // \u5904\u7406\u9519\u8bef\n        eprintln!(\"\u52a0\u8f7d\u914d\u7f6e\u5931\u8d25: {}\", e);\n\n        // \u5e38\u89c1\u9519\u8bef\uff1a\n        // - \u6587\u4ef6\u672a\u627e\u5230\n        // - \u65e0\u6548\u7684 TOML \u8bed\u6cd5\n        // - \u7f3a\u5c11\u5fc5\u9700\u5b57\u6bb5\n        // - \u65e0\u6548\u7684\u503c\u8303\u56f4\n        // - \u7c7b\u578b\u4e0d\u5339\u914d\n    }\n}\n</code></pre>"},{"location":"server/CONFIG/#_17","title":"\u6d4b\u8bd5","text":"<p>\u914d\u7f6e\u6a21\u5757\u5305\u542b\u5168\u9762\u7684\u5355\u5143\u6d4b\u8bd5\uff0c\u6db5\u76d6\uff1a</p> <ul> <li>\u6709\u6548\u914d\u7f6e\u52a0\u8f7d</li> <li>\u9ed8\u8ba4\u503c\u5e94\u7528</li> <li>\u5fc5\u9700\u5b57\u6bb5\u9a8c\u8bc1</li> <li>\u503c\u8303\u56f4\u9a8c\u8bc1</li> <li>\u6570\u636e\u5e93\u7c7b\u578b\u914d\u7f6e</li> <li>\u7f13\u5b58\u914d\u7f6e</li> <li>GeoIP \u914d\u7f6e</li> <li>\u8fde\u63a5\u5b57\u7b26\u4e32\u751f\u6210</li> <li>\u9519\u8bef\u60c5\u51b5</li> </ul> <p>\u8fd0\u884c\u6d4b\u8bd5\uff1a</p> <pre><code>cargo test -p shortener-server\n</code></pre>"},{"location":"server/CONFIG/#_18","title":"\u793a\u4f8b\u914d\u7f6e\u6587\u4ef6","text":"<p>\u8bf7\u53c2\u9605\u9879\u76ee\u6839\u76ee\u5f55\u4e2d\u7684 <code>config/config.toml</code> \u4ee5\u83b7\u53d6\u5b8c\u6574\u7684\u793a\u4f8b\u914d\u7f6e\u6587\u4ef6\u3002</p>"}]}